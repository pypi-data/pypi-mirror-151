"use strict";(self.webpackChunkrsp_jupyter_extensions=self.webpackChunkrsp_jupyter_extensions||[]).push([[360],{360:(e,o,t)=>{t.r(o),t.d(o,{default:()=>x});var n=t(169),s=t(555),a=t(413),l=t(697),r=t(139),i=t(271),u=t(57);function c(e){return i.createElement(n.TextItem,{source:`${e.source}`,title:`${e.title}`})}class d extends u.VDomRenderer{constructor(e){super(new u.VDomModel),this.props=e}render(){return this.props?i.createElement(c,{source:this.props.source,title:this.props.title}):null}dispose(){super.dispose()}}const g=d,p="rsp-jupyterlab",m=`${p}:plugin`,v=`${p}:displayversion`;n.IStatusBar;var h,y,f=t(433);!function(e){e.rspQueryAPI="rspqueryapi",e.rspQuerySquash="rspquerysquash"}(h||(h={}));class q extends f.Widget{constructor(e){super({node:y.createQueryNode(e)}),this.addClass("rspQuery")}get inputNode(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.inputNode.value}}function S(e,o,t,n){let s="Enter API Query URL";"squash"==n&&(s="Enter Squash CI_ID"),function(e,o){let t={title:"Query ID",body:new q(o),focusNodeSelector:"input",buttons:[u.Dialog.cancelButton(),u.Dialog.okButton({label:"CREATE"})]};return(0,u.showDialog)(t).then((e=>(console.log("Result from queryDialog: ",e),e?e.value?"CREATE"===e.button.label?(console.log("Got result ",e.value," from queryDialog: CREATE"),Promise.resolve(e.value)):(console.log("Did not get queryDialog: CREATE"),null):(console.log("No result.value from queryDialog"),null):(console.log("No result from queryDialog"),null))))}(0,s).then((e=>{if(console.log("queryid is",e),!e)return console.log("queryid was null"),new Promise(((e,o)=>{}));let s=JSON.stringify({query_id:e,query_type:n});return(a=l.PageConfig.getBaseUrl()+"rubin/query",i={method:"POST",body:s},u=t.serverSettings,r.ServerConnection.makeRequest(a,i,u).then((e=>200!==e.status?e.json().then((o=>{throw new r.ServerConnection.ResponseError(e,o.message)})):e.json()))).then((function(e){let t=e.path;o.open(t)})),new Promise(((e,o)=>{}));var a,i,u}))}s.IMainMenu,a.IDocumentManager,function(e){e.createQueryNode=function(e){let o=document.createElement("div"),t=document.createElement("label");t.textContent=e;let n=document.createElement("input");return o.appendChild(t),o.appendChild(n),o}}(y||(y={}));var E,b=t(918);function I(e,o,t,n){D();const s=Promise.resolve(function(e,o,t){let n=[];(0,b.each)(e.shell.widgets("main"),(e=>{if(e){let t=o.contextForWidget(e);t?(console.log("Saving context for widget:",{id:e.id}),n.push(t.save())):console.log("No context for widget:",{id:e.id})}})),console.log("Waiting for all save-document promises to resolve.");let s=Promise.resolve(1);return n&&(Promise.all(n),s=n[0]),s}(e,o));return s.then((o=>C(e,0,0,n))),s.catch((e=>{console.log("saveAll failed: ",e.message)})),console.log("Save and Quit complete."),s}function C(e,o,t,n){D();let s="/";return n&&(s="/logout"),Promise.resolve(function(e){let o=e.serviceManager.serverSettings,t=l.PageConfig.getBaseUrl()+"rubin/hub";return console.log("hubRequest: URL: ",t," | Settings:",o),r.ServerConnection.makeRequest(t,{method:"DELETE"},o)}(e).then((()=>{console.log("Quit complete.")})).then((()=>{window.location.replace(s)})))}function D(){let e={title:"Redirecting to landing page",body:"JupyterLab cleaning up and redirecting to landing page.",buttons:[u.Dialog.okButton({label:"Got it!"})]};return(0,u.showDialog)(e).then((()=>{console.log("Info dialog panel displayed")}))}!function(e){e.saveQuit="savequit:savequit",e.justQuit="justquit:justquit",e.saveLogout="savelogout:savelogout"}(E||(E={})),s.IMainMenu,a.IDocumentManager;const x={activate:function(e,o,t,n){console.log("rsp-lab-extension: loading..."),console.log("...activating displayversion extension..."),function(e,o){console.log("RSP DisplayVersion extension: loading...");let t=e.serviceManager;var n,s;(n=l.PageConfig.getBaseUrl()+"rubin/environment",s=t.serverSettings,r.ServerConnection.makeRequest(n,{method:"GET"},s).then((e=>200!==e.status?e.json().then((o=>{throw new r.ServerConnection.ResponseError(e,o.message)})):e.json()))).then((e=>{let t=e.IMAGE_DESCRIPTION||"",n=e.IMAGE_DIGEST,s=e.JUPYTER_IMAGE_SPEC,a=" "+new URL(e.EXTERNAL_INSTANCE_URL||"").hostname,l="";n&&(l=" ["+n.substring(0,8)+"...]");let r="";if(s){let e=s.split("/");r=" ("+e[e.length-1]+")"}const i=new g({source:t+l+r+a,title:t});o.registerStatusItem(v,{item:i,align:"left",rank:80,isActive:()=>!0})})),console.log("RSP DisplayVersion extension: ... loaded")}(e,n),console.log("...activated..."),console.log("...activating query extension..."),function(e,o,t){console.log("rsp-queryextension: loading...");let n=e.serviceManager;e.commands.addCommand(h.rspQueryAPI,{label:"Open from Query URL...",caption:"Open notebook from supplied API query URL",execute:()=>{S(0,t,n,"api")}}),e.commands.addCommand(h.rspQuerySquash,{label:"Open from CI ID...",caption:"Open notebook from supplied Squash CI ID",execute:()=>{S(0,t,n,"squash")}});const s=new f.Menu({commands:e.commands});s.addItem({command:h.rspQueryAPI}),s.addItem({command:h.rspQuerySquash}),s.title.label="RSP",o.addMenu(s,{rank:420}),console.log("rsp-queryextension: ...loaded")}(e,o,t),console.log("...activated..."),console.log("...activating savequit extension..."),function(e,o,t){console.log("rsp-savequit: loading...");e.serviceManager;const{commands:n}=e;n.addCommand(E.justQuit,{label:"Exit Without Saving",caption:"Destroy container",execute:()=>{C(e,0,0,!1)}}),n.addCommand(E.saveQuit,{label:"Save All and Exit",caption:"Save open notebooks and destroy container",execute:()=>{I(e,t,0,!1)}}),n.addCommand(E.saveLogout,{label:"Save All and Log Out",caption:"Save open notebooks, destroy container, and log out",execute:()=>{I(e,t,0,!0)}});let s=[{command:E.justQuit},{command:E.saveQuit},{command:E.saveLogout}];o.fileMenu.addGroup(s,150),console.log("rsp-savequit: ...loaded.")}(e,o,t),console.log("...activated..."),console.log("...loaded rsp-lab-extension.")},id:m,requires:[s.IMainMenu,a.IDocumentManager,n.IStatusBar],autoStart:!0}}}]);