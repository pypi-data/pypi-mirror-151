"use strict";(self.webpackChunkqslwidgets=self.webpackChunkqslwidgets||[]).push([[639],{4458:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultWidgetState=t.CommonWidget=void 0;const l=n(a(6271)),i=a(8564),o=a(4741),s=n(a(544));t.defaultWidgetState={states:[],urls:[],type:"image",message:"",config:{image:[],regions:[]},labels:{image:{},polygons:[],masks:[],boxes:[]},action:"",preload:[],maxCanvasSize:512,maxViewHeight:512,idx:0,viewState:"labeling",sortedIdxs:[],mediaIndex:{rows:[],columns:[]},buttons:{next:!0,prev:!0,save:!0,config:!0,delete:!0,ignore:!0,unignore:!0},base:{serverRoot:"",url:""},progress:-1,mode:"light"};const r=({extract:e})=>{var t,a;const{setToast:n}=l.default.useContext(s.default),r=e("config"),d=e("states"),u=e("urls"),c=e("type"),m=e("labels"),f=e("action"),g=e("progress"),p=e("mode"),b=e("buttons"),h=e("preload"),v=e("maxCanvasSize"),y=e("maxViewHeight"),x=e("viewState"),w=e("mediaIndex"),O=e("idx"),E=e("message"),j=e("sortedIdxs");l.default.useEffect((()=>{""!==E.value&&(n(E.value),E.set(""))}),[E.value,n]);const k={config:{image:(null===(t=r.value)||void 0===t?void 0:t.image)||[],regions:(null===(a=r.value)||void 0===a?void 0:a.regions)||[]},preload:h.value,options:{progress:g.value,maxCanvasSize:v.value,showNavigation:!0},callbacks:{onSave:b.value.save?e=>{m.set(e),f.set("save")}:void 0,onSaveConfig:b.value.config?r.set:void 0,onNext:b.value.next?()=>f.set("next"):void 0,onPrev:b.value.prev?()=>f.set("prev"):void 0,onDelete:b.value.delete?()=>f.set("delete"):void 0,onIgnore:b.value.ignore?()=>f.set("ignore"):void 0,onUnignore:b.value.unignore?()=>f.set("unignore"):void 0,onShowIndex:()=>f.set("index")}};return l.default.createElement(i.ThemeProvider,{theme:i.createTheme({palette:{mode:p.value||"light"}})},l.default.createElement(i.ScopedCssBaseline,null,l.default.createElement(i.Box,{style:{padding:16}},l.default.createElement(i.Box,{hidden:"index"!==x.value},l.default.createElement(o.MediaIndex,{grid:w.value,setSortedIdxs:j.set,rowKey:"qslId",idx:O.value,visible:"index"===x.value,sortedIdxs:j.value,label:e=>{O.set(e),f.set("label")},viewHeight:y.value})),0===d.value.length||"index"===x.value?null:1==d.value.length?"image"===c.value?l.default.createElement(o.ImageLabeler,Object.assign({},k,{maxViewHeight:y.value,labels:m.value||{},target:"transitioning"===x.value?void 0:u.value[0],metadata:"transitioning"===x.value?{}:d.value[0].metadata})):l.default.createElement(o.VideoLabeler,Object.assign({},k,{maxViewHeight:y.value,labels:Array.isArray(m.value)?m.value:[],target:u.value[0],metadata:"transitioning"===x.value?{}:d.value[0].metadata})):l.default.createElement(o.BatchImageLabeler,Object.assign({},k,{labels:m.value||{},target:u.value,states:"transitioning"===x.value?[]:d.value,setStates:e=>d.set(e)})))))};t.CommonWidget=e=>l.default.createElement(o.Labeler,null,l.default.createElement(r,Object.assign({},e)))},2639:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaLabelerView=t.MediaLabelerModel=void 0;const l=n(a(6271)),i=n(a(4456)),o=a(5294),s=a(2565),r=a(7295),d=a(4458),u=a(8657),c=({model:e})=>{const t=r.useModelStateExtractor(e),a=t("base");return l.default.useEffect((()=>{a.set({serverRoot:o.PageConfig.getOption("serverRoot"),url:o.PageConfig.getBaseUrl()})})),l.default.createElement(d.CommonWidget,{extract:t})};class m extends s.DOMWidgetModel{defaults(){return Object.assign(Object.assign(Object.assign({},super.defaults()),{_model_name:m.model_name,_model_module:m.model_module,_model_module_version:m.model_module_version,_view_name:m.view_name,_view_module:m.view_module,_view_module_version:m.view_module_version}),d.defaultWidgetState)}}t.MediaLabelerModel=m,m.serializers=Object.assign({},s.DOMWidgetModel.serializers),m.model_name="MediaLabelerModel",m.model_module=u.MODULE_NAME,m.model_module_version=u.MODULE_VERSION,m.view_name="MediaLabelerView",m.view_module=u.MODULE_NAME,m.view_module_version=u.MODULE_VERSION;class f extends s.DOMWidgetView{render(){this.el.classList.add("qsl-image-labeler-widget");const e=l.default.createElement(c,{model:this.model});i.default.render(e,this.el)}}t.MediaLabelerView=f},7295:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useModelEvent=t.useModelState=t.useModelStateExtractor=void 0;const l=n(a(6271)),i=(e,t)=>{const[a,n]=l.default.useState(null==t?void 0:t.get(e));return o(t,`change:${e}`,(t=>{n(t.get(e))}),[e]),{value:a,set:function(a,n){null==t||t.set(e,a,n),null==t||t.save_changes()}}};t.useModelState=i,t.useModelStateExtractor=e=>t=>i(t,e);const o=(e,t,a,n)=>{l.default.useEffect((()=>{const n=t=>e&&a(e,t);return null==e||e.on(t,n),()=>{null==e||e.unbind(t,n)}}),(n||[]).concat([e]))};t.useModelEvent=o},2428:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=a(8564),i=a(7359),o=n(a(6271)),s=n(a(4591)),r=n(a(3742)),d=n(a(544)),u=n(a(2762)),c=n(a(7428)),m=a(5610),f=a(969),g=l.styled(l.ImageList)`
  & .MuiImageListItem-root {
    width: 100%;

    & img {
      transition: opacity 1s;
      z-index: 0;
      opacity: 1;
    }

    &.active,
    &:active img {
      transition: opacity 1s;
      opacity: 0.25;
    }
  }
  & .MuiImageListItemBar-titleWrap {
    padding: 8px;
  }
  & .MuiImageListItemBar-root {
    z-index: 1;
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.7) 0%,
      rgba(0, 0, 0, 0.3) 70%,
      rgba(0, 0, 0, 0) 100%
    );
  }
`;t.default=({target:e=[],labels:t={image:{}},options:a,callbacks:n,setStates:p,states:b,config:h={image:[],regions:[]},columns:v=3})=>{const y=f.useMediaLarge(),x=o.default.useCallback((e=>p(b.slice(0,e).concat([Object.assign(Object.assign({},b[e]),{selected:!b[e].selected})]).concat(b.slice(e+1)))),[p,b]),{setToast:w}=o.default.useContext(d.default),{draft:O,setDraft:E,resetDraft:j}=f.useDraftLabelState(t,[e]),k=o.default.useCallback((()=>(null==n?void 0:n.onSave)?n.onSave(Object.assign({},m.draft2labels(O.labels))):void 0),[O,null==n?void 0:n.onSave]);return o.default.useEffect((()=>{b&&b.some((e=>["boxes","masks","polygons"].some((t=>e.labels&&e.labels[t||"masks"]&&e.labels[t||"masks"].length>0))))&&w("Warning: One of these items has region labels that will be overwritten upon saving.")}),[b]),o.default.createElement(r.default,{layout:y?"horizontal":"vertical",progress:null==a?void 0:a.progress,control:o.default.createElement(u.default,{disabled:!1,direction:"column",showNavigation:null==a?void 0:a.showNavigation,config:{image:null==h?void 0:h.image,regions:void 0},draft:O,setDraft:E,callbacks:Object.assign(Object.assign({},n),{onSave:(null==n?void 0:n.onSave)?k:void 0,onReset:j,onSelectAll:b.some((e=>e.visible&&!e.selected))?()=>p(b.map((e=>Object.assign(Object.assign({},e),{selected:e.visible})))):void 0,onSelectNone:b.some((e=>e.visible&&e.selected))?()=>p(b.map((e=>Object.assign(Object.assign({},e),{selected:!1})))):void 0})}),content:o.default.createElement(l.Box,null,o.default.createElement(c.default,null),o.default.createElement(g,{cols:v,sx:{mt:0},variant:"masonry"},b.map(((t,a)=>{var n;return t.visible?o.default.createElement(l.ImageListItem,{key:a,"data-index":a,onClick:()=>x(a),tabIndex:0,className:"batch-image-list-item"},o.default.createElement(l.ImageListItemBar,{position:"top",title:o.default.createElement(l.Box,{sx:{height:25}},t.ignored?o.default.createElement(l.Box,{title:"ignored",flexDirection:"row-reverse",alignItems:"center",display:"flex"},o.default.createElement(i.VisibilityOff,null)):t.labeled?o.default.createElement(l.Box,{title:"labeled",flexDirection:"row-reverse",alignItems:"center",display:"flex"},o.default.createElement(i.TurnedIn,null)):null),actionIcon:o.default.createElement(l.IconButton,{sx:{color:"white"},"aria-label":`selected ${a}`},t.selected?o.default.createElement(i.CheckCircle,null):o.default.createElement(i.Circle,null)),actionPosition:"left"}),e[a]?o.default.createElement("img",{src:e[a]}):o.default.createElement(l.Box,{sx:{mb:5}}),t.metadata?o.default.createElement(s.default,{data:Object.fromEntries(Object.entries(t.metadata||{}).concat((null===(n=t.labels)||void 0===n?void 0:n.image)?(h.image||[]).map((e=>[e.displayName||e.name,t.labels.image[e.name]?e.multiple?t.labels.image[e.name].join(", "):t.labels.image[e.name][0]:void 0])).filter((([e,t])=>void 0!==t)):[]))}):null):null}))))})}},6951:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(969),o=a(8564),s=a(5610);t.default=({children:e,steps:t})=>{const a=l.default.useRef(null),n=o.useTheme(),[r,d]=l.default.useState(0),[u,c]=l.default.useState({text:"",show:!1,position:{x:.5,y:.5}});return l.default.useEffect((()=>{a&&(()=>{const e=t[r],n=r+1<t.length?r+1:0;if(!a.current)return;const l=a.current.querySelector(e.target);if(!l)return console.error("Failed to find target",e.target),void d(n);const o=e.offset?{x:e.offset.x*l.clientWidth,y:e.offset.y*l.clientHeight}:void 0,s=((e,t,a)=>{const n=e.getBoundingClientRect(),l=t.getBoundingClientRect(),i=n.x+(a?a.x:n.width/2),o=n.y+(a?a.y:n.height/2);return{x:(i-l.x)/l.width,y:(o-l.y)/l.height}})(l,a.current,o);c({text:e.text,show:!0,position:s}),i.delay(1500).then((()=>c({show:!1,position:s,text:e.text}))).then((()=>i.delay(250))).then((()=>d(n)))})()}),[a,r]),l.default.createElement("div",{ref:a,style:{position:"relative"}},e,l.default.createElement(o.Box,{sx:{position:"absolute",left:s.pct2css(u.position.x),top:s.pct2css(u.position.y),width:250,bgcolor:n.palette.primary.main,color:n.palette.primary.contrastText,border:"2px solid #000",boxShadow:36,transition:"opacity 125ms",p:2,zIndex:100,opacity:u.show?1:0}},l.default.createElement(o.Typography,null,u.text)))}},284:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=n(a(2176)),s=n(a(2762)),r=n(a(649)),d=n(a(9035)),u=n(a(3742)),c=a(969),m=a(5610);t.default=({target:e,labels:t={image:{}},options:a,callbacks:n,metadata:f,preload:g,config:p={image:[],regions:[]},maxViewHeight:b})=>{const{draft:h,setDraft:v,resetDraft:y}=c.useDraftLabelState(t,[e]),x={viewer:l.default.useRef(null),source:l.default.useRef(null),canvas:l.default.useRef(null)},{loader:w,disableControls:O,disableContents:E,visibleSource:j,mediaState:k}=c.useLoader(l.default.useCallback((e=>new Promise(((e,t)=>{if(x.source.current){const t={width:x.source.current.naturalWidth,height:x.source.current.naturalHeight};e({size:t,layout:t.height>t.width?"horizontal":"vertical"})}else t("Did not find source ref.")}))),[x.source,e]),e),_=l.default.useCallback((()=>(null==n?void 0:n.onSave)?n.onSave(Object.assign(Object.assign({},m.draft2labels(h.labels)),{dimensions:null==k?void 0:k.size})):void 0),[h,k,null==n?void 0:n.onSave]),M=c.useMediaMouseCallbacks(h,v,x,!!(p.regions&&p.regions.length>0),null==a?void 0:a.maxCanvasSize);return l.default.createElement(u.default,{metadata:f,progress:null==a?void 0:a.progress,layout:(null==k?void 0:k.layout)||"horizontal",control:l.default.createElement(s.default,{config:p,disabled:O,direction:"horizontal"===((null==k?void 0:k.layout)||"horizontal")?"column":"row",draft:h,showNavigation:null==a?void 0:a.showNavigation,setDraft:v,callbacks:Object.assign(Object.assign({},n),{onSave:(null==n?void 0:n.onSave)?_:void 0,onReset:y})}),content:e?l.default.createElement(i.Box,null,l.default.createElement(i.Box,null,l.default.createElement(o.default,{size:null==k?void 0:k.size,maxViewHeight:b,media:{main:l.default.createElement("img",Object.assign({},M,{ref:x.source,onLoad:w,src:j,style:{cursor:p.regions&&p.regions.length>0?"none":void 0}})),mini:l.default.createElement("img",{src:j})},loading:E,onMouseLeave:()=>v(Object.assign(Object.assign({},h),{cursor:Object.assign(Object.assign({},h.cursor),{coords:void 0})}))},l.default.createElement(d.default,{config:p,draft:h,callbacks:M}))),l.default.createElement("canvas",{style:{display:"none"},ref:x.canvas}),!E&&g?l.default.createElement(r.default,{images:g}):null):null})}},8800:function(e,t,a){var n=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6271)),o=a(8564),s=l(a(9771)),r=l(a(544)),d=a(969);t.default=e=>{var{children:t}=e,a=n(e,["children"]);const l={hidden:i.default.useRef(null),container:i.default.useRef(null)},[u,c]=i.default.useState(""),[m,f]=i.default.useState(!1),g=i.default.useCallback((()=>{l.hidden.current&&l.hidden.current.focus({preventScroll:!0})}),[l.hidden]);return d.useInterval((()=>{const e=!(!l.container.current||!l.container.current.contains(document.activeElement));e!==m&&f(e)}),100,!0,[l,m]),i.default.createElement(r.default.Provider,{value:{container:l.container,setToast:c,setFocus:g,hasFocus:m}},i.default.createElement(o.Box,{className:"react-image-labeler",ref:l.container},i.default.createElement(o.Box,Object.assign({},a),t,i.default.createElement(s.default,{ref:l.hidden}),i.default.createElement(o.Snackbar,{open:""!==u,autoHideDuration:3e3,onClose:()=>c(""),message:u}))))}},8847:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=a(5228),s=a(7359),r=n(a(544)),d=a(969),u=i.styled(o.DataGrid)`
  & .MuiDataGrid-cell:focus {
    outline: none;
  }
`;t.default=e=>{const{idx:t,grid:a,label:n,rowKey:o,visible:c,viewHeight:m,sortedIdxs:f,setSortedIdxs:g}=e,p=Math.floor(m/60),b=l.default.useRef(null),[h,v]=l.default.useState(0),[y,x]=l.default.useState([]),{setFocus:w}=l.default.useContext(r.default);l.default.useEffect((()=>{if(y.length>0){const e=y[0].field;if("mediaIndexSortState"===e)return;const t=y[0].sort;g(a.rows.slice().sort(((a,n)=>{const l=a[e],i=n[e],o="asc"===t?1:-1;return l==i?0:l>i?o:-o})).map((e=>e[o])))}else g(a.rows.map((e=>e[o])))}),[y]),l.default.useEffect((()=>{c&&x([{field:"mediaIndexSortState",sort:"asc"}])}),[c]);const O=l.default.useCallback((()=>{if(!c)return;const e=f.findIndex((e=>e===t));v(Math.floor(e/p))}),[t,y,c]);d.useKeyboardEvent((e=>{if(!b.current||!c)return;let t;switch(e.key){case"ArrowRight":t=".MuiTablePagination-actions button:nth-of-type(2)";break;case"ArrowLeft":t=".MuiTablePagination-actions button:nth-of-type(1)";break;default:return}if(!t)return;const a=b.current.querySelector(t);a&&(d.simulateClick(a),w())}),[h,b,c]),l.default.useEffect(O,[t,c]);const E=l.default.useMemo((()=>a.rows.map((e=>Object.assign(Object.assign({},e),{mediaIndexSortState:f.indexOf(e[o])})))),[f,a.rows]);return l.default.createElement(i.Box,{onClick:w},l.default.createElement(i.Box,{style:{height:m,width:"100%"},ref:b},l.default.createElement(u,{disableColumnFilter:!0,rows:E,columns:a.columns.concat({field:"mediaIndexSortState",hide:!0}),pageSize:p,rowsPerPageOptions:[p],disableSelectionOnClick:!0,onRowClick:e=>{n(e.id)},selectionModel:[t],page:h,onPageChange:v,sortModel:y,onSortModelChange:x,hideFooterSelectedRowCount:!0,getRowId:e=>e[o]})),l.default.createElement(i.ButtonGroup,{sx:{mt:2},fullWidth:!0,size:"small","aria-label":"index control menu"},l.default.createElement(i.Button,{onClick:()=>n(t),startIcon:l.default.createElement(s.ArrowBack,null)},"Back to Labeling")))}},3673:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=a(969),s=n(a(2176)),r=n(a(3742)),d=n(a(2762)),u=n(a(1609)),c=n(a(9035)),m=n(a(544)),f=a(7359),g=a(5610);t.default=({target:e,config:t={image:[],regions:[]},labels:a=[],metadata:n,options:p,callbacks:b,maxViewHeight:h})=>{const v={mini:l.default.useRef(null),main:l.default.useRef(null),secondaryThumbnail:l.default.useRef(null),viewer:l.default.useRef(null),canvas:l.default.useRef(null),playpause:l.default.useRef(null),fastforward:l.default.useRef(null),mute:l.default.useRef(null)},{setFocus:y}=l.default.useContext(m.default),x=l.default.useMemo((()=>a||[]),[a]),{playbackState:w,setPlaybackState:O,toggleMute:E}=o.usePlaybackState(v,x),{draft:j,setDraft:k,resetDraft:_}=o.useDraftLabelState(w.labels,[w.timestamp]);o.useKeyboardEvent((e=>{let t;switch(e.key){case"Spacebar":case" ":t=j.dirty?null:"playpause";break;case"ArrowRight":t=e.altKey&&!j.dirty?"fastforward":null;break;case"m":t=e.altKey?"mute":null;default:return}t&&v[t].current&&(o.simulateClick(v[t].current).then(y),e.preventDefault(),e.stopPropagation())}),[v]);const{loader:M,visibleSource:S,disableContents:C,disableControls:I,mediaState:P}=o.useLoader((e=>new Promise(((e,t)=>{if(v.main.current){const t={width:v.main.current.videoWidth,height:v.main.current.videoHeight};e({duration:v.main.current.duration,layout:t.height>t.width?"horizontal":"vertical",size:t})}else t("Could not handle loading because video element was missing.")}))),e),B=o.useMediaMouseCallbacks(j,k,{source:v.main,canvas:v.canvas},!!(t.regions&&t.regions.length>0),null==p?void 0:p.maxCanvasSize),D=[{icon:w.paused?f.PlayArrow:f.Pause,label:w.paused?"play (spacebar)":"pause (spacebar)",className:"playpause",disabled:w.paused&&j.dirty,ref:v.playpause,callbacks:{onClick:()=>O(w.paused?1:0)}},{icon:f.FastForward,label:"forward (alt→)",className:"fastforward",ref:v.fastforward,disabled:w.paused&&j.dirty,callbacks:{onClick:()=>O(w.playbackRate+1)}},{icon:w.muted?f.VolumeMute:f.VolumeUp,label:"mute/unmute forward (alt+m)",className:"mute",ref:v.mute,disabled:!w.paused,callbacks:{onClick:E}}];return l.default.createElement(r.default,{metadata:n,layout:(null==P?void 0:P.layout)||"horizontal",progress:null==p?void 0:p.progress,control:l.default.createElement(d.default,{config:t,disabled:I||!w.paused,direction:"horizontal"===((null==P?void 0:P.layout)||"horizontal")?"column":"row",draft:j,showNavigation:null==p?void 0:p.showNavigation,setDraft:k,callbacks:Object.assign(Object.assign({},b),{onSave:()=>(null==b?void 0:b.onSave)?b.onSave(g.insertOrAppendByTimestamp({labels:g.draft2labels(j.labels),timestamp:w.timestamp,end:w.end},a||[])):void 0,onReset:_})}),content:l.default.createElement(i.Box,null,l.default.createElement(s.default,{maxViewHeight:h,size:null==P?void 0:P.size,loading:C,onMouseLeave:()=>k(Object.assign(Object.assign({},j),{cursor:Object.assign(Object.assign({},j.cursor),{coords:void 0})})),media:{main:l.default.createElement("video",Object.assign({disablePictureInPicture:!0,onLoadedMetadata:M},B,{ref:v.main,src:S,style:{cursor:t.regions&&t.regions.length>0?"none":void 0}})),mini:l.default.createElement("video",{src:e,ref:v.mini})},controls:l.default.createElement(i.Stack,{direction:"row",alignItems:"center",spacing:2},l.default.createElement(i.Stack,{direction:"row",alignItems:"center",spacing:0},D.map((e=>l.default.createElement(i.IconButton,Object.assign({},e.callbacks,{disabled:e.disabled,className:e.className,ref:e.ref,key:e.label,"aria-label":e.label,title:e.label,size:"small"}),l.default.createElement(e.icon,{fontSize:"small"}))))),l.default.createElement(u.default,{marks:(a||[]).map((e=>e.timestamp)),timestamp:w.timestamp,duration:null==P?void 0:P.duration,secondary:w.end,secondaryThumbnail:l.default.createElement("video",{src:e,ref:v.secondaryThumbnail}),setSecondary:e=>O(0,void 0,e),setTimestamp:e=>j.dirty?void 0:O(0,e)}))},l.default.createElement(c.default,{config:t,draft:j,callbacks:B})),l.default.createElement("canvas",{style:{display:"none"},ref:v.canvas}))})}},955:function(e,t,a){var n=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6271)),o=a(5610);t.default=e=>{var{box:t,color:a,candidate:l}=e,s=n(e,["box","color","candidate"]);const r=t.pt1,d=t.pt2||l;if(!d)return null;const[u,c,m,f]=[Math.min,Math.max].map((e=>["x","y"].map((t=>e.apply(Math,[r,d].map((e=>e[t]))))))).flat(),g=Math.max(m-u,o.epsilon),p=Math.max(f-c,o.epsilon);return i.default.createElement("svg",Object.assign({className:"region box",width:o.pct2css(g),height:o.pct2css(p)},s,{style:Object.assign({position:"absolute",left:o.pct2css(u),top:o.pct2css(c),height:o.pct2css(p),overflow:"visible"},s.style||{})}),i.default.createElement("text",{fill:a,className:"box-text",x:5,y:5,z:0,fontSize:"8pt",fontFamily:"Roboto,Helvetica,Arial,sans-serif",dominantBaseline:"hanging"},o.labels2string(t.labels)),i.default.createElement("rect",Object.assign({},s,{x:0,y:0,fill:"none",width:"100%",height:"100%",stroke:a,strokeWidth:2,z:1})))}},7428:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=n(a(544));t.default=()=>{const e=l.default.useContext(o.default);return l.default.createElement(i.Box,{style:{width:"100%",height:"100%",position:"absolute",top:0},onClick:e.setFocus})}},3120:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=n(a(6369));t.default=({open:e,existing:t,onSave:a,onClose:n})=>{const s={properties:[],displayName:"",name:"",level:"image",options:[],mockSelected:[]},[r,d]=l.default.useState(s);l.default.useEffect((()=>{var e,a,n;t&&d(Object.assign(Object.assign({},s),{properties:[].concat((null===(e=null==t?void 0:t.config)||void 0===e?void 0:e.freeform)?["freeform"]:[]).concat((null===(a=null==t?void 0:t.config)||void 0===a?void 0:a.multiple)?["multiple"]:[]),displayName:t.config.displayName||"",name:t.config.name||"",level:t.level||"image",options:(null===(n=null==t?void 0:t.config.options)||void 0===n?void 0:n.map((e=>e.displayName||e.name)))||[]}))}),[t]);const u=l.default.useMemo((()=>r.name&&(r.properties.indexOf("freeform")>-1||r.options.length>0)),[r]),c=l.default.useMemo((()=>r.options.length>0?r.options.map((e=>Object.assign({name:e},(null==t?void 0:t.config.options)&&t.config.options.find((t=>(t.displayName||t.name)===e))||{}))):void 0),[r,t]);return l.default.createElement(i.Modal,{open:e,"aria-describedby":"add-or-update-new-label-entry-description"},l.default.createElement(i.Box,{sx:{p:2,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",color:"text.secondary",border:"2px solid #000",boxShadow:24}},l.default.createElement(i.Typography,{id:"add-or-update-new-label-entry-description",sx:{mb:1}},t?"Edit Label Configuration":"Add New Label Configuration"),l.default.createElement(i.Box,{ml:-3,mr:-3},l.default.createElement(o.default,{setSelected:([e])=>d(Object.assign(Object.assign({},r),{name:e})),selected:[r.name],disabled:!!t,config:{multiple:!1,freeform:!0,name:"Name"}}),l.default.createElement(o.default,{setSelected:([e])=>d(Object.assign(Object.assign({},r),{displayName:e})),selected:[r.displayName],disabled:!!t,config:{multiple:!1,freeform:!0,name:"Display Name"}}),l.default.createElement(i.Divider,{sx:{mb:2}}),l.default.createElement(o.default,{disabled:!!t,setSelected:([e])=>d(Object.assign(Object.assign({},r),{level:e||r.level})),selected:[r.level],config:{options:[{name:"image",displayName:"Image"},{name:"regions",displayName:"Regions"}],multiple:!1,freeform:!1,name:"Level"}}),l.default.createElement(o.default,{setSelected:e=>d(Object.assign(Object.assign({},r),{properties:e})),selected:r.properties,config:{options:[{name:"freeform",displayName:"Freeform"},{name:"multiple",displayName:"Multiple"}],multiple:!0,freeform:!1,name:"Type"}}),l.default.createElement(o.default,{setSelected:e=>d(Object.assign(Object.assign({},r),{options:e})),selected:r.options,config:{options:[],multiple:!0,freeform:!0,name:"Options"}})),l.default.createElement(i.ButtonGroup,{size:"small","aria-label":"label editing control menu"},l.default.createElement(i.Button,{disabled:!u,onClick:()=>{a({name:r.name,displayName:r.displayName,multiple:r.properties.indexOf("multiple")>-1,freeform:r.properties.indexOf("freeform")>-1,options:c},r.level),d(s)}},"Save"),l.default.createElement(i.Button,{onClick:()=>{n(),d(s)}},"Cancel")),u?l.default.createElement(i.Box,null,l.default.createElement(i.Divider,{sx:{mt:2,mb:2}}),l.default.createElement(i.Typography,null,"Your new label configuration will look like the following."),l.default.createElement(i.Box,{sx:{ml:-3,mr:-3,mt:1,mb:-3}},l.default.createElement(o.default,{selected:r.mockSelected,setSelected:e=>d(Object.assign(Object.assign({},r),{mockSelected:e})),config:{name:r.name,displayName:r.displayName,options:c,multiple:r.properties.indexOf("multiple")>-1,freeform:r.properties.indexOf("freeform")>-1}}))):null))}},2762:function(e,t,a){var n=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6271)),o=a(8564),s=a(7359),r=l(a(9850)),d=l(a(8347)),u=l(a(3120)),c=l(a(7428)),m=l(a(544)),f=l(a(4591)),g=a(5610),p=a(969);t.default=e=>{var t,a,l,{draft:b,disabled:h,callbacks:v,showNavigation:y,setDraft:x}=e,w=n(e,["draft","disabled","callbacks","showNavigation","setDraft"]);const O=o.useTheme(),E=Object.fromEntries(["next","prev","save","finishRegion","clearRegion","delete","ignore","selectAll","selectNone"].map((e=>[e,i.default.useRef(null)]))),j=p.useMediaLarge(),k={image:g.shortcutify((null===(t=w.config)||void 0===t?void 0:t.image)||[]),regions:g.shortcutify((null===(a=w.config)||void 0===a?void 0:a.regions)||[])},_=j?w.direction:"column",[M,S]=i.default.useState({configEditorOpen:!1,index:null}),[C,I]=i.default.useState(""),{setFocus:P,hasFocus:B}=i.default.useContext(m.default),D=i.default.useCallback((e=>x(Object.assign(Object.assign({},b),{dirty:!0,labels:Object.assign(Object.assign({},b.labels),{[b.drawing.mode]:b.drawing.active?g.insertOrAppend(b.labels[b.drawing.mode],b.drawing.active.region,b.drawing.active.idx,e):b.labels[b.drawing.mode]}),drawing:Object.assign(Object.assign({},b.drawing),{active:void 0})}))),[b]);p.useKeyboardEvent((e=>{let t;if((null==v?void 0:v.onKeyboardEvent)&&v.onKeyboardEvent(e),!e.altKey){switch(e.key){case"A":t=e.ctrlKey&&e.shiftKey?"selectNone":null;break;case"a":t=e.ctrlKey&&!e.shiftKey?"selectAll":null;break;case"ArrowRight":t=e.ctrlKey||e.shiftKey?null:"next",b.dirty&&v.onNext&&I("Please save or reset your changes before advancing to next image.");break;case"ArrowLeft":t="prev",b.dirty&&v.onPrev&&I("Please save or reset your changes before returning to previous image.");break;case"Enter":t=e.ctrlKey||e.shiftKey?null:b.drawing.active?"finishRegion":"save";break;case"Backspace":case"Delete":t=e.ctrlKey||e.shiftKey?null:b.drawing.active?"clearRegion":"delete";break;default:return}t&&E[t].current&&(p.simulateClick(E[t].current).then(P),e.preventDefault(),e.stopPropagation())}}),[v,M,b,E,P]);const N=b.drawing.active?"regions":"image",L=k[N]||[],z=(null==k?void 0:k.regions)&&k.regions.length>0;return i.default.createElement(o.Box,null,i.default.createElement(c.default,null),i.default.createElement(o.Snackbar,{open:""!==C,autoHideDuration:3e3,onClose:()=>I(""),message:C}),i.default.createElement(d.default,{config:L,disabled:h||void 0!==b.drawing.active&&!0===b.drawing.active.region.readonly,editConfig:(null==v?void 0:v.onSaveConfig)?e=>S({configEditorOpen:!0,index:e}):void 0,labels:b.drawing.active?b.drawing.active.region.labels:b.labels.image,setLabels:e=>{x(Object.assign(Object.assign({},b),{dirty:!0,labels:b.drawing.active?b.labels:Object.assign(Object.assign({},b.labels),{image:e}),drawing:b.drawing.active?Object.assign(Object.assign({},b.drawing),{active:Object.assign(Object.assign({},b.drawing.active),{region:Object.assign(Object.assign({},b.drawing.active.region),{labels:e})})}):b.drawing}))}}),b.drawing&&(null===(l=b.drawing.active)||void 0===l?void 0:l.region.metadata)?i.default.createElement(o.Box,{sx:{position:"relative",zIndex:1}},i.default.createElement(f.default,{data:b.drawing.active.region.metadata})):null,Object.keys((b.drawing.active?k.regions:k.image)||[]).length>0?i.default.createElement(o.Divider,{sx:{mb:3}}):null,z?i.default.createElement(o.Box,null,i.default.createElement(o.Stack,{alignContent:"center",direction:_,spacing:2},i.default.createElement(o.Box,{sx:{borderRight:"masks"===b.drawing.mode?`solid 1px ${O.palette.divider}`:void 0}},i.default.createElement(o.FormControl,null,i.default.createElement(o.FormLabel,null,"Drawing Mode"),i.default.createElement(o.RadioGroup,{row:!0,className:"drawing-mode-select",onChange:e=>x(Object.assign(Object.assign({},b),{drawing:"masks"===e.target.value?{flood:!1,mode:"masks"}:{mode:e.target.value}})),value:b.drawing.mode},[["boxes","Box"],["polygons","Polygon"],["masks","Mask"]].map((([e,t],a)=>i.default.createElement(o.FormControlLabel,{key:a,value:e,control:i.default.createElement(o.Radio,{className:"drawing-mode-option",size:"small"}),label:t,disabled:!!b.drawing.active||h})))))),"masks"===b.drawing.mode?i.default.createElement(o.Box,{style:{display:"grid",gridTemplateColumns:"row"==_?"100px 200px 200px":"100px 200px",gridTemplateAreas:"row"==_?'"toggle threshold size"':'"toggle threshold" "size size"',gridTemplateRows:"auto",columnGap:25}},i.default.createElement(o.FormControlLabel,{style:{gridArea:"toggle"},control:i.default.createElement(o.Checkbox,{checked:b.drawing.flood,onChange:(e,t)=>x(Object.assign(Object.assign({},b),{drawing:"masks"===b.drawing.mode?Object.assign(Object.assign({},b.drawing),{flood:t}):b.drawing}))}),label:"Flood"}),i.default.createElement(o.Box,{style:{gridArea:"threshold",display:"inline-flex"}},i.default.createElement(r.default,{name:"Flood Threshold",value:b.cursor.threshold,min:0,disabled:!b.drawing.flood,max:20,width:"100%","aria-label":"segmentation mask flood threshold",onValueChange:e=>x(Object.assign(Object.assign({},b),{cursor:Object.assign(Object.assign({},b.cursor),{threshold:e})}))})),i.default.createElement(o.Box,{style:{gridArea:"size",display:"inline-flex"}},i.default.createElement(r.default,{name:"Cursor Size",value:b.cursor.radius,min:1,max:50,width:"100%","aria-label":"segmentation mask labeling radius",onValueChange:e=>x(Object.assign(Object.assign({},b),{cursor:Object.assign(Object.assign({},b.cursor),{radius:e})}))}))):null),i.default.createElement(o.Divider,{sx:{mb:2,mt:2}})):null,i.default.createElement(o.Stack,{direction:_,spacing:2},b.drawing.active?i.default.createElement(o.ButtonGroup,{fullWidth:!0,size:"small","aria-label":"region control menu"},i.default.createElement(o.Button,{ref:E.finishRegion,onClick:()=>D(!0),startIcon:"⏎",className:"finish-region"},b.drawing.active.region.readonly?"Deselect":"Finish"),i.default.createElement(o.Button,{startIcon:"⌫",disabled:b.drawing.active.region.readonly,onClick:()=>D(!1),ref:E.clearRegion},"Delete")):i.default.createElement(o.Stack,{direction:_,spacing:2,style:{width:"100%"}},(null==v?void 0:v.onSelectAll)||(null==v?void 0:v.onSelectNone)?i.default.createElement(o.ButtonGroup,{fullWidth:!0,size:"small","aria-label":"selection control menu",className:"selection-control"},(null==v?void 0:v.onSelectAll)?i.default.createElement(o.Button,{disabled:!(null==v?void 0:v.onSelectAll)||h,onClick:null==v?void 0:v.onSelectAll,startIcon:"⌃A",ref:E.selectAll,className:"select-all"},"Select All"):null,(null==v?void 0:v.onSelectNone)?i.default.createElement(o.Button,{disabled:!(null==v?void 0:v.onSelectNone)||h,onClick:null==v?void 0:v.onSelectNone,startIcon:"⌃⇧A",ref:E.selectNone,className:"select-none"},"Select None"):null):null,i.default.createElement(o.ButtonGroup,{fullWidth:!0,size:"small","aria-label":"label control menu"},i.default.createElement(o.Button,{ref:E.save,disabled:!(null==v?void 0:v.onSave)||h,onClick:null==v?void 0:v.onSave,startIcon:"⏎",className:"save"},"Save"),(null==v?void 0:v.onIgnore)||(null==v?void 0:v.onUnignore)?i.default.createElement(o.Button,{ref:E.ignore,disabled:h,onClick:(null==v?void 0:v.onIgnore)||(null==v?void 0:v.onUnignore)},(null==v?void 0:v.onIgnore)?"Ignore":"Unignore"):null,(null==v?void 0:v.onDelete)?i.default.createElement(o.Button,{startIcon:"⌫",ref:E.delete,disabled:h,onClick:v.onDelete},"Delete"):null,i.default.createElement(o.Button,{disabled:h||!b.dirty,onClick:null==v?void 0:v.onReset},"Reset")),(null==v?void 0:v.onPrev)||(null==v?void 0:v.onNext)||y?i.default.createElement(o.ButtonGroup,{size:"small",fullWidth:!0,"aria-label":"navigation control menu"},i.default.createElement(o.Button,{startIcon:i.default.createElement(s.KeyboardArrowLeft,null),ref:E.prev,disabled:!(null==v?void 0:v.onPrev)||b.dirty,onClick:v.onPrev},"Previous"),i.default.createElement(o.Button,{startIcon:i.default.createElement(s.KeyboardArrowRight,null),ref:E.next,disabled:!(null==v?void 0:v.onNext)||b.dirty,onClick:v.onNext},"Next")):null,(null==v?void 0:v.onSaveConfig)||(null==v?void 0:v.onShowIndex)?i.default.createElement(o.ButtonGroup,{size:"small","aria-label":"add new configuration menu",fullWidth:!0},(null==v?void 0:v.onSaveConfig)?i.default.createElement(o.Button,{startIcon:i.default.createElement(s.Add,null),className:"add-new-label",onClick:()=>S({index:null,configEditorOpen:!0})},"Add Type"):null,(null==v?void 0:v.onShowIndex)?i.default.createElement(o.Button,{startIcon:i.default.createElement(s.List,null),className:"show-data-index",disabled:h,onClick:v.onShowIndex},"View Index"):null):null),i.default.createElement(o.Box,{title:B?"Listening for keyboard shortcuts.":"Keyboard shortcuts disabled. Click inside the widget to enable.",onClick:P,style:{zIndex:1}},i.default.createElement(s.Keyboard,{color:B?"primary":"warning",fontSize:"large"}))),v&&v.onSaveConfig?i.default.createElement(u.default,{open:M.configEditorOpen,onClose:()=>S(Object.assign(Object.assign({},M),{configEditorOpen:!1})),existing:null!==M.index?{config:L[M.index],level:N}:void 0,onSave:(e,t)=>{if(null===M.index&&(k[t]||[]).find((t=>t.name===e.name)))throw"User attempted to add a config with the name of an existing config.";const a=k[t]||[],n=null===M.index?a.length:M.index;v.onSaveConfig(Object.assign(Object.assign({},k),{[t]:a.slice(0,n).concat([e]).concat(a.slice(n+1))})),S({index:null,configEditorOpen:!1})}}):null)}},544:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)).default.createContext({});t.default=l},9771:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=l.default.forwardRef(((e,t)=>l.default.createElement("div",{style:{width:0,height:0,overflow:"hidden"}},l.default.createElement("input",{ref:t,className:"react-image-labeler-input-target"}))));t.default=i},649:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271));t.default=({images:e})=>{const[t,a]=l.default.useState(0);return l.default.useEffect((()=>a(0)),[e]),l.default.createElement("div",{style:{width:0,height:0,overflow:"hidden"}},e.map(((e,n)=>n<=t?l.default.createElement("img",{src:e,key:n,onLoad:()=>a(n+1)}):null)))}},8347:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=n(a(6369));t.default=({config:e,labels:t,setLabels:a,disabled:n,editConfig:s})=>l.default.createElement(i.Box,{ml:-3,mr:-3},e.map(((e,i)=>l.default.createElement(o.default,{key:e.name,config:e,disabled:n,editConfig:s?()=>s(i):void 0,selected:t[e.name],setSelected:n=>a(Object.assign(Object.assign({},t),{[e.name]:n}))}))))},6369:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=a(7359),s=n(a(544)),r=a(969),d=i.styled(i.Box)`
  & label.label-panel-entry-option-label {
    margin-bottom: 0;
  }

  & legend.label-panel-entry-label {
    margin-bottom: 0;
    border-bottom: none;
  }
`;t.default=({config:e,selected:t,setSelected:a,disabled:n,editConfig:u})=>{const c=l.default.useMemo((()=>e.options||e.multiple&&e.freeform?((e,t)=>t.concat(e?e.filter((e=>-1==(t||[]).findIndex((t=>t.name===e)))).map((e=>({name:e,shortcut:""}))):[]))(t||[],e.options||[]):void 0),[e.options,t]),m=l.default.useRef(null),{setFocus:f}=l.default.useContext(s.default),g=l.default.useMemo((()=>c?c.reduce(((e,t,a)=>t.shortcut?Object.assign(Object.assign({},e),{[t.shortcut]:a}):e),{}):{}),[c]),p=l.default.useCallback((n=>a(((e,t,a)=>t&&t.indexOf(e)>-1?a?t.filter((t=>t!=e)):[]:a?(t||[]).concat([e]):[e])(n,t,e.multiple))),[t,e,a]);r.useKeyboardEvent((e=>{if(e.ctrlKey||e.shiftKey||!g)return;const t=g[e.key];if(t>-1&&m.current){const a=m.current.querySelector(`.react-image-labeler-input-target[data-index='${t}'] input`);r.simulateClick(a),e.preventDefault(),e.stopPropagation(),f()}}),[g,m,f]);const[b,h]=l.default.useState({freeform:c||e.multiple||!e.freeform||!t?"":t[0]});return l.default.useEffect((()=>h({freeform:c||e.multiple||!e.freeform||!t?"":t[0]})),[t]),l.default.createElement(d,{display:"inline"},l.default.createElement(i.FormControl,{sx:{ml:3,mr:3,mt:0,mb:3},component:"fieldset",variant:"standard",className:"label-panel-entry",disabled:!!n,name:e.name},l.default.createElement(i.FormLabel,{component:"legend",className:"label-panel-entry-label"},e.displayName||e.name," ",u?l.default.createElement(i.IconButton,{"aria-label":`edit ${e.name}`,className:"edit-label-entry",onClick:u},l.default.createElement(o.Edit,null)):null),l.default.createElement(i.FormGroup,{ref:m},(c||[]).map(((a,n)=>{const o={checked:!!(t&&t.indexOf(a.name)>-1),onChange:()=>p(a.name),name:a.name,className:"react-image-labeler-input-target"},s=`${a.displayName||a.name} ${a.shortcut?`(${a.shortcut})`:""}`;return l.default.createElement(i.FormControlLabel,{className:"label-panel-entry-option-label",key:n,control:e.multiple?l.default.createElement(i.Checkbox,Object.assign({},o,{"data-index":n})):l.default.createElement(i.Radio,Object.assign({},o,{"data-index":n,onClick:o.onChange})),color:"primary",label:s})}))),e.freeform?l.default.createElement(i.Input,{value:b.freeform,name:`${e.name}-freeform`,placeholder:e.multiple?"Add new option":void 0,onKeyPress:t=>{"Enter"===t.key&&(e.multiple||c?(p(b.freeform),h({freeform:""})):f(),t.preventDefault())},onChange:t=>{h(Object.assign(Object.assign({},b),{freeform:t.target.value})),e.multiple||c||p(t.target.value),t.preventDefault(),t.stopPropagation()}}):null))}},3742:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=n(a(7428)),s=n(a(4591)),r=n(a(5599)),d=a(969);t.default=({layout:e="horizontal",control:t,content:a,metadata:n,progress:u})=>{const c=d.useMediaLarge();return l.default.createElement(i.Box,null,void 0!==u&&u>=0?l.default.createElement(i.Box,{sx:{mb:1}},l.default.createElement(r.default,{progress:u})):null,l.default.createElement(i.Box,{style:{display:"grid",gridTemplateColumns:(a||n)&&"horizontal"===e&&c?"315px 1fr":"1fr",gridTemplateRows:"auto",gridTemplateAreas:a||n?"horizontal"===e&&c?'"control-panel image-target"':'"image-target" "control-panel"':'"control-panel"',gridColumnGap:a||n?20:0,rowGap:a||n?20:0,position:"relative"}},l.default.createElement(i.Box,{style:{position:"relative",gridArea:"control-panel"}},l.default.createElement(o.default,null),t),l.default.createElement(i.Box,{style:{position:"relative",gridArea:"image-target"}},l.default.createElement(o.default,null),l.default.createElement(i.Stack,{rowGap:1},a,n?l.default.createElement(i.Box,{sx:{position:"relative",zIndex:1}},l.default.createElement(s.default,{data:n})):null))))}},6150:function(e,t,a){var n=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6271));t.default=e=>{var{bitmap:t,color:a}=e,l=n(e,["bitmap","color"]);const o=i.default.useRef(null);return i.default.useEffect((()=>{if(t&&o.current){const e=o.current.getContext("2d");if(!e)throw"Failed to find canvas context.";o.current.width=t.dimensions.width,o.current.height=t.dimensions.height;const n=e.createImageData(t.dimensions.width,t.dimensions.height),l="red"===a?[255,0,0,127]:"blue"===a?[0,0,255,127]:[255,255,0,127];Uint8ClampedArray.from(Array.from(t.values).map((e=>255===e?l:[0,0,0,0])).flat()).forEach(((e,t)=>n.data[t]=e)),e.putImageData(n,0,0)}}),[t,a,o]),i.default.createElement("canvas",Object.assign({},l,{className:"region mask",style:Object.assign(Object.assign({},l.style||{}),{imageRendering:"pixelated",position:"absolute",width:"100%",height:"100%",top:0}),ref:o}))}},2176:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=n(a(9850)),s=n(a(544)),r=n(a(7428)),d=a(5610),u=a(969),c=i.styled(i.Box)`
  & .minimap .mask-cursor {
    display: none;
  }

  & .minimap .box-text {
    visibility: hidden;
  }

  & .viewport .media img,
  .viewport .media video {
    vertical-align: bottom;
  }

  & .viewport .loading-placeholder .region {
    visibility: hidden;
  }

  & img,
  & video {
    width: 100%;
    height: 100%;
    max-width: none;
    max-height: none;
    image-rendering: pixelated;
  }
`;t.default=({children:e,media:t,size:a,controls:n,loading:m,onMouseLeave:f,maxViewHeight:g=512})=>{const{setFocus:p}=l.default.useContext(s.default),b={viewport:l.default.useRef(null),minimap:l.default.useRef(null),media:l.default.useRef(null)},[h,v]=l.default.useState({zoom:100,pos:{x:0,y:0},viewportSize:void 0});l.default.useEffect((()=>v(Object.assign(Object.assign({},h),{pos:{x:0,y:0}}))),[m]),u.useInterval((()=>{!b.viewport.current||h.viewportSize&&b.viewport.current.clientHeight===h.viewportSize.height&&b.viewport.current.clientWidth===h.viewportSize.width||v(Object.assign(Object.assign({},h),{viewportSize:{width:b.viewport.current.clientWidth,height:b.viewport.current.clientHeight}}))}),100,!0),l.default.useEffect((()=>{var e;a&&v(Object.assign(Object.assign({},h),{zoom:100*Math.min(((null===(e=b.viewport.current)||void 0===e?void 0:e.clientWidth)||g)/a.width,g/a.height)}))}),[a]);const y=l.default.useMemo((()=>a?{width:a.width*h.zoom/100,height:a.height*h.zoom/100}:void 0),[h.zoom,a]),x=l.default.useMemo((()=>{if(!y)return null;const e=96/Math.max(y.width,y.height);return{width:e*y.width,height:e*y.height}}),[y]),w=l.default.useMemo((()=>h.viewportSize&&y?{x:Math.min(h.viewportSize.width,y.width)/y.width/2,y:Math.min(h.viewportSize.height,y.height)/y.height/2}:{x:0,y:0}),[h]),O=l.default.useMemo((()=>({left:h.pos.x*((null==y?void 0:y.width)||0),top:h.pos.y*((null==y?void 0:y.height)||0)})),[h.pos,y]),E=l.default.useCallback((e=>{w?v(Object.assign(Object.assign({},h),{pos:{x:Math.min(Math.max(e.x,0),Math.max(0,1-2*w.x)),y:Math.min(Math.max(e.y,0),Math.max(0,1-2*w.y))}})):console.error("Tried to set position without available data.")}),[h,w]);l.default.useEffect((()=>{const e=Math.min(1-(h.pos.x+2*w.x),0),t=Math.min(1-(h.pos.y+2*w.y),0);(e||t)&&E({x:h.pos.x+e,y:h.pos.y+t})}),[w]);const j=u.useMediaEvent((e=>{p(),E({x:e.x-w.x,y:e.y-w.y})}),b.minimap,[E,w,p]),k=l.default.useCallback((e=>{if(y)return e.preventDefault(),e.stopPropagation(),e.ctrlKey?v(Object.assign(Object.assign({},h),{zoom:h.zoom-e.deltaY})):E({x:h.pos.x+e.deltaX/y.width,y:h.pos.y+e.deltaY/y.height}),!1}),[h,y]);return l.default.useEffect((()=>{if(b.media.current)return b.media.current.addEventListener("wheel",k,{passive:!1}),()=>{b.media.current&&b.media.current.removeEventListener("wheel",k)}}),[b.media,k]),l.default.createElement(c,{className:"media-viewer"},l.default.createElement(i.Box,{sx:{mb:2}},l.default.createElement(i.Box,{className:"viewport",style:{position:"relative",overflow:"hidden",height:Math.min(g,y?y.height:g)},ref:b.viewport},l.default.createElement(r.default,null),l.default.createElement(i.Box,null,m?l.default.createElement(i.CircularProgress,{style:{position:"absolute",left:"50%",right:"50%",top:"50%",bottom:"50%"}}):null,l.default.createElement(i.Box,{className:"media",onMouseLeave:m?void 0:f,ref:b.media,style:{position:"absolute",overflow:"hidden",clip:`rect(${O.top}px, auto, auto, ${O.left}px)`,left:-O.left+"px",top:-O.top+"px"}},l.default.createElement(i.Box,{className:"raw",style:m?{width:0,height:0,overflow:"hidden"}:y||{width:0,height:0}},e,t.main)))),n||null),!m&&h.viewportSize&&y?l.default.createElement(i.Box,{className:"controls",style:{display:"grid",gridTemplateColumns:`${(null==x?void 0:x.width)||96}px 1fr`,gridTemplateRows:"auto",gridTemplateAreas:'"minimap zoom"',gridColumnGap:10}},l.default.createElement(i.Paper,{className:"minimap",style:Object.assign(Object.assign({},x),{position:"relative"}),onClick:j},e,t.mini,l.default.createElement("div",{style:{outline:"2px solid red",outlineOffset:"-1px",position:"absolute",left:d.pct2css(h.pos.x),top:d.pct2css(h.pos.y),width:d.pct2css(Math.min(1-h.pos.x,h.viewportSize.width/y.width)),height:d.pct2css(Math.min(1-h.pos.y,h.viewportSize.height/y.height))}}),l.default.createElement("div",{ref:b.minimap,className:"hover-target",style:Object.assign(Object.assign({position:"absolute",top:0},x),{display:"block"})})),l.default.createElement(o.default,{name:"Zoom",className:"zoom",min:1,max:Math.max(500,h.zoom),width:"100%",value:h.zoom,onValueChange:e=>v(Object.assign(Object.assign({},h),{zoom:e}))})):l.default.createElement(i.Box,{sx:{height:(null==x?void 0:x.height)||96}}))}},4591:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564);t.default=({data:e})=>l.default.createElement(i.TableContainer,{tabIndex:0,component:i.Paper,sx:{mb:0,mt:0}},l.default.createElement(i.Table,{"aria-label":"metadata table"},l.default.createElement(i.TableBody,null,Object.entries(e).map((([e,t],a)=>l.default.createElement(i.TableRow,{key:a,sx:{"&:last-child td, &:last-child th":{border:0}}},l.default.createElement(i.TableCell,{align:"right",component:"th",scope:"row"},l.default.createElement("b",null,e)),l.default.createElement(i.TableCell,null,t)))))))},1609:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=a(5610),s=e=>void 0===e||isNaN(e)?"00:00":`${Math.floor(e/60).toString().padStart(2,"0")}:${Math.round(e%60).toString().padStart(2,"0")}`;t.default=({timestamp:e,secondary:t,duration:a,marks:n,setTimestamp:r,setSecondary:d,secondaryThumbnail:u})=>l.default.createElement(i.Box,{sx:{width:"100%"},className:"playbar"},l.default.createElement(i.Stack,{direction:"row",alignItems:"center",spacing:2},l.default.createElement(i.Typography,{fontSize:"small"},s(e),"/",s(a)),l.default.createElement(i.Box,{style:{width:"100%",display:"inherit",position:"relative"}},void 0!==t&&void 0!==a?l.default.createElement(i.Box,{style:{position:"absolute",maxWidth:100,maxHeight:100,left:o.pct2css(t/a),bottom:"60%"}},u):null,l.default.createElement(i.Slider,{size:"small",min:0,step:.01,classes:{thumb:"slider-thumb"},componentsProps:{markLabel:{onClick:e=>{const t=e.currentTarget.getAttribute("data-index");t&&r(n[parseInt(t)])}}},max:a||10,valueLabelDisplay:"auto",marks:n.map((e=>({value:e,label:e}))),value:[e].concat(void 0!==t?[t]:[]),onChange:(e,t,a)=>{const n=t,l=e.altKey;l&&(1==n.length||n[a]>=n[1-a])?d(n[a]):l||r(n[a])}}))))},2834:function(e,t,a){var n=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6271)),o=a(5610);t.default=e=>{var{polygon:t,color:a,candidate:l}=e,s=n(e,["polygon","color","candidate"]);const{points:r,xmin:d,ymin:u,xmax:c,ymax:m}=((e,t)=>{const a=t?e.concat([t]):e,[n,l,i,o]=[Math.min,Math.max].map((e=>["x","y"].map((t=>e.apply(Math,a.map((e=>e[t]))))))).flat();return{points:a,xmin:n,ymin:l,xmax:i,ymax:o}})(t.points,l),f=Math.max(c-d,o.epsilon),g=Math.max(m-u,o.epsilon);return i.default.createElement("svg",Object.assign({className:"region polygon",width:o.pct2css(f),height:o.pct2css(g)},s,{style:Object.assign({position:"absolute",left:o.pct2css(d),top:o.pct2css(u),overflow:"visible"},s.style||{})}),i.default.createElement("text",Object.assign({x:5,y:5,fill:a},s,{className:"box-text",fontFamily:"Roboto,Helvetica,Arial,sans-serif",alignmentBaseline:"hanging",style:Object.assign(Object.assign({},s.style||{}),{pointerEvents:"none"})}),o.labels2string(t.labels)),i.default.createElement("svg",Object.assign({},s),Array.from(Array(r.length-1).keys()).map((e=>i.default.createElement("line",{key:e,stroke:a,strokeWidth:2,x1:o.pct2css((r[e].x-d)/f),y1:o.pct2css((r[e].y-u)/g),x2:o.pct2css((r[e+1].x-d)/f),y2:o.pct2css((r[e+1].y-u)/g)})))))}},5599:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=a(8564),i=n(a(6271));t.default=e=>i.default.createElement(l.Box,{sx:{display:"flex",alignItems:"center"}},i.default.createElement(l.Box,{sx:{width:"100%",mr:1}},i.default.createElement(l.LinearProgress,{variant:"determinate",value:e.progress})),i.default.createElement(l.Box,{sx:{minWidth:20,textAlign:"right"}},i.default.createElement(l.Typography,{variant:"body2",color:"text.secondary"},`${Math.round(e.progress)}%`)))},9850:function(e,t,a){var n=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6271)),o=a(8564);t.default=e=>{var{name:t,value:a,onValueChange:l,min:s,max:r,width:d,disabled:u}=e,c=n(e,["name","value","onValueChange","min","max","width","disabled"]);return i.default.createElement(o.Stack,{direction:"row",alignItems:"center",spacing:2,style:d?{width:d}:{}},i.default.createElement(o.Typography,{fontSize:"small"},t),i.default.createElement(o.Slider,Object.assign({},c,{size:"small",value:a,style:d?{width:d}:{},min:s,classes:{thumb:"slider-thumb"},max:r,disabled:u,valueLabelDisplay:"on",valueLabelFormat:Math.round,onChange:(e,t)=>l(t)})))}},1825:function(e,t,a){var n=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6271)),o=a(5610);t.default=e=>{var{radius:t,round:a,x:l,y:s,crosshair:r}=e,d=n(e,["radius","round","x","y","crosshair"]);return i.default.createElement("div",Object.assign({},d,{className:"mask-cursor",style:Object.assign(Object.assign({},d.style||{}),{height:2*t+"px",width:2*t+"px",borderRadius:a?`${t}px`:void 0,transform:`translate(${-t}px, ${-t}px)`,left:o.pct2css(l),top:o.pct2css(s),position:"absolute",outline:"2px solid red",cursor:"none",overflow:"visible",pointerEvents:"none"})}),r?i.default.createElement("svg",{style:{position:"absolute",left:0,top:0,height:"100%",width:"100%",overflow:"visible",pointerEvents:"none"}},i.default.createElement("line",{x1:"50%",x2:"50%",y1:"0%",y2:"100%",stroke:"red",strokeWidth:"2px"}),i.default.createElement("line",{y1:"50%",y2:"50%",x1:"0%",x2:"100%",stroke:"red",strokeWidth:"2px"})):null)}},9035:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(a(6271)),i=a(8564),o=n(a(2834)),s=n(a(955)),r=n(a(1825)),d=n(a(6150)),u=a(2493);t.default=({config:e,draft:t,callbacks:a})=>{var n,c;const m=(null==e?void 0:e.regions)&&e.regions.length>0?"none":void 0;return l.default.createElement(i.Box,null,t.labels.masks.map(((e,n)=>{var i;return"masks"!==t.drawing.mode||(null===(i=t.drawing.active)||void 0===i?void 0:i.idx)!==n?l.default.createElement(d.default,Object.assign({color:e.readonly?"yellow":"blue",key:n,bitmap:e.map,style:{cursor:m,pointerEvents:"masks"===t.drawing.mode?void 0:"none"}},a)):null})),t.labels.polygons.map(((e,n)=>{var i;return"polygons"!==t.drawing.mode||(null===(i=t.drawing.active)||void 0===i?void 0:i.idx)!==n?l.default.createElement(o.default,Object.assign({polygon:e,style:{cursor:m,pointerEvents:"polygons"===t.drawing.mode?void 0:"none"},key:n,color:e.readonly?"yellow":"blue"},a,{onClick:t=>a.onClick(t,e,n)})):null})),t.labels.boxes.map(((e,n)=>{var i;return"boxes"!==t.drawing.mode||(null===(i=t.drawing.active)||void 0===i?void 0:i.idx)!==n?l.default.createElement(s.default,Object.assign({color:e.readonly?"yellow":"blue",box:e,key:n,style:{cursor:m,pointerEvents:"boxes"===t.drawing.mode?void 0:"none"}},a,{onClick:t=>a.onClick(t,e,n)})):null})),t.drawing.active?"polygons"===t.drawing.mode?l.default.createElement(o.default,Object.assign({color:"red",polygon:t.drawing.active.region},a,{candidate:t.drawing.active.idx>-1?void 0:t.cursor.coords,style:{cursor:m}})):"boxes"===t.drawing.mode?l.default.createElement(s.default,Object.assign({color:"red",box:t.drawing.active.region,candidate:t.drawing.active.idx>-1?void 0:t.cursor.coords,style:{cursor:m}},a)):"masks"===t.drawing.mode?l.default.createElement(d.default,Object.assign({color:"red"},a,{bitmap:t.drawing.active.region.map,style:{cursor:m}})):null:null,t.cursor.coords&&void 0!==m?l.default.createElement(r.default,Object.assign({},a,{radius:"masks"===t.drawing.mode?t.cursor.radius:5,x:t.cursor.coords.x,y:t.cursor.coords.y,crosshair:"masks"!==t.drawing.mode&&("boxes"===t.drawing.mode||!u.isPolygonClosed(t.cursor.coords,null===(c=null===(n=t.drawing.active)||void 0===n?void 0:n.region)||void 0===c?void 0:c.points)),round:"masks"!==t.drawing.mode})):null)}},109:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unfill=t.fillHsv=t.img2hsv=t.findMaskByPoint=t.values2counts=t.counts2values=t.findLastIndex=void 0;const a=255,n=[{dx:0,dy:-1},{dx:-1,dy:0},{dx:0,dy:1},{dx:1,dy:0}];function l(e,t){let a=e.length;for(;a--;)if(t(e[a],a,e))return a;return-1}t.findLastIndex=l;const i=(e,t)=>Object.assign(Object.assign({},e),{x:e.x+t.dx,y:e.y+t.dy});t.img2hsv=(e,t,a)=>{const n=t.getContext("2d"),l={width:"VIDEO"===(i=e).nodeName?i.videoWidth:i.naturalWidth,height:"VIDEO"===i.nodeName?i.videoHeight:i.naturalHeight};var i;if(!n)throw Error("Failed to get a drawing context.");const o=a/Math.max(l.width,l.height);t.width=Math.round(o*l.width),t.height=Math.round(o*l.height),n.drawImage(e,0,0,l.width,l.height,0,0,t.width,t.height);try{const e=Array.from(n.getImageData(0,0,t.width,t.height).data);return{hsv:new Uint8ClampedArray(Array.from(Array(t.width*t.height).keys()).map((t=>((...e)=>{const[t,a,n]=e,l=Math.max(t,a,n),i=Math.min(t,a,n),o=l-i,s=0===l?0:o/l,r=l/255,d=6*o;let u;switch(l){case i:u=0;break;case t:u=(a-n+o*(a<n?6:0))/d;break;case a:u=(n-t+2*o)/d;break;case n:u=(t-a+4*o)/d;break;default:throw"Failed to select appropriate value for h."}return[u,s,r].map((e=>Math.min(Math.round(255*e),255)))})(...e.slice(4*t,4*t+3)))).flat()),width:t.width,height:t.height}}catch(e){return console.error("Failed to load image, likely due to CORS issues."),{width:t.width,height:t.height}}};const o=(e,t)=>e.y*t+e.x,s=(e,t)=>({x:Math.round(e.x*t.sx),y:Math.round(e.y*t.sy)}),r=(e,t,a)=>{const n={x:Math.max(0,Math.round((e.x-t.dx)*a.width)),y:Math.max(0,Math.round((e.y-t.dy)*a.height))};return{point:n,kernel:{dx:Math.min(Math.round((2*t.dx+Math.min(0,e.x-t.dx))*a.width),a.width-n.x),dy:Math.min(Math.round((2*t.dy+Math.min(0,e.y-t.dy))*a.height),a.height-n.y)}}},d=(e,t,a,n)=>{if(t.x<0||t.y<0||t.x+a.dx>e.dimensions.width||t.y+a.dy>e.dimensions.height)throw`Detected invalid block fill point/parameters. kernel: (${a.dx}, ${a.dy}), point: (${t.x}, ${t.y}), dimensions: (${e.dimensions.width}, ${e.dimensions.height})`;const l=Array(a.dx).fill(n);Array.from(Array(a.dy).keys()).forEach((a=>{e.values.set(l,(t.y+a)*e.dimensions.width+t.x)}))};t.unfill=(e,t,a)=>{const n=r(e,a,t.dimensions);return d(t,n.point,n.kernel,0),t.values},t.fillHsv=(e,t,l)=>{const u=Math.pow(l.threshold,2);if(l.previous&&t.width*t.height!==l.previous.values.length)throw`Incompatible dimensions for mask (${l.previous.values.length}) and canvas (${t.width}x${t.height}).`;const c={values:new Uint8ClampedArray(l.previous?l.previous.dimensions.width*l.previous.dimensions.height:t.width*t.height),dimensions:l.previous?l.previous.dimensions:{height:t.height,width:t.width}},m={sx:c.dimensions.width/t.width,sy:c.dimensions.height/t.height},f={equals:(e,t)=>((e,t,a)=>{if(3!==e.length||3!==t.length)throw"These points do not have the same number of color values.";const[n,l,i]=e,[o,s,r]=t,d=2*Math.min(Math.abs(o-n),255-Math.abs(o-n)),u=Math.abs(s-l),c=Math.abs(r-i);return d*d+u*u+c*c<=a})(Array.from(e),Array.from(t),u),isInBounds:e=>e.x<t.width&&e.y<t.height&&e.x>=0&&e.y>=0,getImageValue:e=>{var a;const n=3*o(e,t.width);return null===(a=t.hsv)||void 0===a?void 0:a.slice(n,n+3)},getMatchValue:e=>{const t=o(s(e,m),c.dimensions.width),l=c.values[t];switch(l){case 0:return"unknown";case a:return"matched";default:return e.direction<0||"0"===l.toString(2).padStart(n.length,"0")[e.direction]?"unknown":"visited"}},setMatchValue:(e,t)=>{const l=o(s(e,m),c.dimensions.width);switch(t){case"matched":c.values[l]=a;break;case"visited":const i=c.values[l].toString(2).padStart(n.length,"0"),o=parseInt(i.substring(0,e.direction)+1+i.substring(e.direction+1),2);c.values[l]=o;break;default:throw`Unsupported flood map setting passed: ${t}`}}},g=r(e,l.radius,c.dimensions),p=r(e,l.radius,t);return d(c,g.point,g.kernel,a),((e,t,a)=>{const l=e.filter((e=>t.isInBounds(e)));let o=0;if(a)for(;l.length>0&&o<a;){const e=l.shift(),a=n.map(((t,a)=>Object.assign(Object.assign({},i(e,t)),{origin:e,direction:a}))).filter(t.isInBounds).filter((e=>"unknown"==t.getMatchValue(e))),s=a.filter((e=>{const a=t.getImageValue(e),n=t.getImageValue(e.origin);return void 0!==n&&void 0!==a&&t.equals(n,a)}));a.forEach((e=>t.setMatchValue(e,"visited"))),s.forEach((e=>t.setMatchValue(e,"matched"))),l.push(...s),o+=1}})(((e,t)=>[Array.from(Array(t.dx).keys()).map((a=>[{x:a+e.x,y:e.y},{x:a+e.x,y:e.y+t.dy}])),Array.from(Array(t.dy).keys()).map((a=>[{y:a+e.y,x:e.x},{y:a+e.y,x:e.x+t.dx}]))].flat(2).map((t=>Object.assign(Object.assign({},t),{origin:e,direction:-1}))))(p.point,p.kernel),f,t.hsv?1e6:0),l.previous&&l.previous.values.forEach(((e,t)=>{e===a&&(c.values[t]=e)})),l.radius&&t.hsv&&((e,t)=>{for(let n=0;n<=e.dimensions.height-t.dy;n++){let l=0;for(;l<=e.dimensions.width-t.dx;)[{dx:0,dy:0},{dx:t.dx,dy:0},t,{dx:0,dy:t.dy}].map((t=>(n+t.dy)*e.dimensions.width+l+t.dx)).every((t=>e.values[t]===a))?(d(e,{x:l,y:n},t,a),l+=t.dx):l+=1}})(c,{dx:Math.round(l.radius.dx*c.dimensions.width),dy:Math.round(l.radius.dy*c.dimensions.height)}),c.values},t.counts2values=e=>new Uint8ClampedArray(e.map(((e,t)=>Array.from(Array(e).keys()).map((()=>t%2==0?a:0)))).flat()),t.values2counts=e=>e.reduce(((e,t)=>((e.length-1)%2==0==(t==a)?e[e.length-1]+=1:e.push(1),e)),[0]),t.findMaskByPoint=(e,t)=>l(t,(t=>t.map.values[Math.round(e.y*t.map.dimensions.height)*t.map.dimensions.width+Math.round(e.x*t.map.dimensions.width)]===a))},2493:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.snapPolygonCoords=t.isPolygonClosed=t.computeDistance=void 0,t.computeDistance=(e,t,a)=>Math.pow((e.x-t.x)*(a?a.width:1),2)+Math.pow((e.y-t.y)*(a?a.height:1),2),t.isPolygonClosed=(e,t)=>{if(!t||0===t.length)return!1;const a=t[0];return e.x===a.x&&e.y===a.y},t.snapPolygonCoords=(e,a,n)=>{if(!a.active||"polygons"!==a.mode||0==a.active.region.points.length)return e;const l=a.active.region.points[0];return Math.sqrt(t.computeDistance(l,e.coords,n))>10?e:Object.assign(Object.assign({},e),{coords:l})}},1599:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handleMediaClick=void 0;const n=a(109),l=a(2493),i=a(5610);t.handleMediaClick=(e,t,a,o,s,r,d)=>{let u=e.drawing;if(!a.source.current)throw"Did not find relevant media elements.";if(u.active&&u.active.idx>-1)return Object.assign(Object.assign({},e),{drawing:Object.assign(Object.assign({},u),{active:void 0}),labels:Object.assign(Object.assign({},e.labels),{[u.mode]:u.active?i.insertOrAppend(e.labels[u.mode],e.drawing.active.region,e.drawing.active.idx,!0):e.labels[u.mode]})});if("masks"==u.mode){if(!a.canvas.current)throw"Did not find necessary canvas element.";const l=e.canvas||n.img2hsv(a.source.current,a.canvas.current,r||512),i=Object.assign(Object.assign({},l),{hsv:u.flood?l.hsv:void 0});if("masks"===u.mode&&u.flood&&!i.hsv)throw"Flood fill failed due to cross-origin media. Please disable flood fill.";const s={previous:u.active?u.active.region.map:void 0,radius:{dx:e.cursor.radius/a.source.current.clientWidth,dy:e.cursor.radius/a.source.current.clientHeight},threshold:e.cursor.threshold};if(u.active)u.active=Object.assign(Object.assign({},u.active),{region:Object.assign(Object.assign({},u.active.region),{map:Object.assign(Object.assign({},u.active.region.map),{values:o&&s.previous?n.unfill(t,s.previous,s.radius):n.fillHsv(t,i,s)})})});else{const a=n.findMaskByPoint(t,e.labels.masks);u.active=-1===a||o?{idx:-1,region:{map:{dimensions:{width:l.width,height:l.height},values:n.fillHsv(t,i,s)},labels:{}}}:{idx:a,region:e.labels.masks[a]}}return Object.assign(Object.assign({},e),{canvas:l,drawing:u})}if("polygons"===u.mode)return u.active?u.active=Object.assign(Object.assign({},u.active),{region:Object.assign(Object.assign({},u.active.region),{points:u.active.region.points.concat([l.snapPolygonCoords(Object.assign(Object.assign({},e.cursor),{coords:t}),u,{width:a.source.current.clientWidth,height:a.source.current.clientHeight}).coords])})}):u.active=s&&!o&&void 0!==d?{region:s,idx:d}:{region:{points:[t],labels:{}},idx:-1},Object.assign(Object.assign({},e),{drawing:u});if("boxes"===u.mode){if(u.active){let e,a;u.active.region.pt2&&l.computeDistance(t,u.active.region.pt1)<l.computeDistance(t,u.active.region.pt2)?(e=t,a=u.active.region.pt2):(e=u.active.region.pt1,a=t),u.active=Object.assign(Object.assign({},u.active),{region:Object.assign(Object.assign({},u.active.region),{pt1:e,pt2:a})})}else u.active=s&&!o&&void 0!==d?{region:s,idx:d}:{region:{pt1:t,labels:{}},idx:-1};return Object.assign(Object.assign({},e),{drawing:u})}throw"Failed to handle media click operation."}},969:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(l,i){function o(e){try{r(n.next(e))}catch(e){i(e)}}function s(e){try{r(n.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}r((n=n.apply(e,t||[])).next())}))},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usePlaybackState=t.useMediaMouseCallbacks=t.useDraftLabelState=t.useLoader=t.useInterval=t.simulateHover=t.simulateScroll=t.simulateClick=t.delay=t.useKeyboardEvent=t.useMediaEvent=t.useMediaLarge=t.convertCoordinates=void 0;const i=l(a(6271)),o=l(a(328)),s=a(8564),r=a(5610),d=a(1599),u=a(2493),c=l(a(544));t.convertCoordinates=(e,t)=>{if(!t)throw Error("Requested mouse position without a ref.");const{x:a,y:n,width:l,height:i}=t.getBoundingClientRect();return{x:(e.x-window.scrollX-a)/l,y:(e.y-window.scrollY-n)/i}},t.useMediaLarge=()=>s.useMediaQuery(s.useTheme().breakpoints.up("sm")),t.useMediaEvent=(e,a,n,l)=>i.default.useMemo((()=>{const n=l&&0!==l?o.default(e,l):e;return(e,...l)=>n(t.convertCoordinates({x:e.nativeEvent.pageX,y:e.nativeEvent.pageY},a.current),e,...l)}),[...n||[],a]),t.useKeyboardEvent=(e,t)=>{const{hasFocus:a}=i.default.useContext(c.default),n=i.default.useCallback((t=>{var n,l;const i=!(!t.target||!t.target.closest(".react-image-labeler-input-target")),o=null===(n=t.target)||void 0===n?void 0:n.nodeName,s="true"===(null===(l=t.target)||void 0===l?void 0:l.contentEditable);a&&"TEXTAREA"!==o&&("INPUT"!==o||i&&a)&&!s&&e(t)}),(t||[]).concat([e,a]));i.default.useEffect((()=>(document.addEventListener("keydown",n,!1),()=>{document.removeEventListener("keydown",n,!1)})),[n])},t.delay=e=>new Promise((t=>setTimeout(t,e))),t.simulateClick=(e,a)=>new Promise((n=>{if(!e)return;e.focus({preventScroll:!0}),e.classList.add("active");const{x:l,y:i}=e.getBoundingClientRect(),o=Object.assign({bubbles:!0,cancelable:!0},a?{clientX:l+a.x,clientY:i+a.y}:{});e.dispatchEvent(new MouseEvent("mousedown",o)),e.dispatchEvent(new MouseEvent("mouseup",o)),t.delay(100).then((()=>{e.dispatchEvent(new MouseEvent("click",o)),e.classList.remove("active"),e.blur(),n()}))})),t.simulateScroll=(e,t,a)=>n(void 0,void 0,void 0,(function*(){e&&e.dispatchEvent(new WheelEvent("wheel",{deltaX:t.x,deltaY:t.y,ctrlKey:a}))})),t.simulateHover=(e,t)=>{if(!e)return;const{x:a,y:n}=e.getBoundingClientRect();null==e||e.dispatchEvent(new MouseEvent("mousemove",Object.assign({bubbles:!0,cancelable:!0},t?{clientX:a+t.x,clientY:n+t.y}:{})))};const m=()=>{};t.useInterval=(e,t,a,n)=>{const l=i.default.useRef(m);i.default.useEffect((()=>{l.current=e})),i.default.useEffect((()=>{a&&null!==t&&!1!==t&&l.current()}),[a]),i.default.useEffect((()=>{if(null===t||!1===t)return;const e=setInterval((()=>l.current()),t);return()=>clearInterval(e)}),[t].concat(n||[]))},t.useLoader=(e,a)=>{const{setToast:n}=i.default.useContext(c.default),[l,o]=i.default.useState({disableControls:!1,disableContents:!!a,timestamp:(new Date).getTime(),mediaState:void 0}),[s,r]=i.default.useState(a);return i.default.useEffect((()=>{a!==s&&(o({disableControls:!1,disableContents:!!a,timestamp:(new Date).getTime(),mediaState:l.mediaState}),r(a))}),[a]),t.useInterval((()=>l.disableContents&&!l.disableControls&&(new Date).getTime()-l.timestamp>250?o(Object.assign(Object.assign({},l),{disableControls:!0})):null),100,!0),{visibleSource:s,mediaState:l.mediaState,disableControls:l.disableControls,disableContents:l.disableContents,loader:i.default.useCallback((t=>{e(t).then((e=>o({mediaState:e,timestamp:(new Date).getTime(),disableControls:!1,disableContents:!1})),(e=>n(e)))}),[e,s])}},t.useDraftLabelState=(e,t)=>{const[a,n]=i.default.useState({labels:r.labels2draft(e||{}),dirty:!1,canvas:null,cursor:{radius:5,threshold:1,coords:void 0},drawing:{mode:"boxes"}}),l=i.default.useCallback((()=>n(Object.assign(Object.assign({},a),{labels:r.labels2draft(e||{}),dirty:!1,canvas:null,drawing:"masks"===a.drawing.mode?{mode:"masks",flood:a.drawing.flood}:{mode:a.drawing.mode}}))),[e,a]);return i.default.useEffect((()=>{l()}),[e].concat(t||[])),{draft:a,setDraft:n,resetDraft:l}},t.useMediaMouseCallbacks=(e,a,n,l,o)=>{const{setFocus:s,setToast:r}=i.default.useContext(c.default);return{onClick:t.useMediaEvent(((t,i,u,c)=>{if(s(),l&&n.source.current&&n.canvas.current)try{a(d.handleMediaClick(e,t,n,i.altKey,u,o,c))}catch(e){r(e)}}),n.source,[e]),onMouseMove:t.useMediaEvent((t=>{l&&n.source.current&&a(Object.assign(Object.assign({},e),{cursor:u.snapPolygonCoords(Object.assign(Object.assign({},e.cursor),{coords:t}),e.drawing,{width:n.source.current.clientWidth,height:n.source.current.clientHeight})}))}),n.source,[e],0)}};const f=(e,t)=>e&&e.filter((e=>e.timestamp===t))[0]||{timestamp:t,end:void 0,labels:{}};t.usePlaybackState=(e,a)=>{const{setFocus:n}=i.default.useContext(c.default),[l,o]=i.default.useState(Object.assign({paused:!0,playbackRate:0,muted:!1},f(a,0)));i.default.useEffect((()=>{e.main.current&&o(Object.assign(Object.assign({},l),f(a,e.main.current.currentTime)))}),[a]),t.useInterval((()=>{!e.main.current||e.main.current.paused===l.paused&&e.main.current.currentTime===l.timestamp&&e.main.current.playbackRate===l.playbackRate||o(Object.assign(Object.assign(Object.assign(Object.assign({},l),{paused:e.main.current.paused,playbackRate:e.main.current.playbackRate}),e.main.current.paused?f(a,e.main.current.currentTime):{end:void 0,labels:{}}),{timestamp:e.main.current.currentTime})),e.secondaryThumbnail.current&&l.end&&e.secondaryThumbnail.current.currentTime!==l.end&&(e.secondaryThumbnail.current.currentTime=l.end),["main","mini"].map((t=>{const a=e[t].current;a&&a&&a.muted!==l.muted&&(a.muted=l.muted)}))}),10,!0);const s=i.default.useCallback((()=>o(Object.assign(Object.assign({},l),{muted:!l.muted}))),[l]),r=i.default.useCallback(((t,a,i)=>{if(e.main.current&&e.mini.current){if(0==t)e.main.current.pause(),e.mini.current.pause();else if(t>0)e.main.current.playbackRate=t,e.mini.current.playbackRate=t,e.main.current.paused&&(e.main.current.play(),e.mini.current.play());else if(t<0)throw"Rewinding is not supported.";void 0!==a&&(e.main.current.currentTime=a,e.mini.current.currentTime=a),void 0!==i&&o(Object.assign(Object.assign({},l),{end:i})),n()}}),[e,l,n]);return{playbackState:l,setPlaybackState:r,toggleMute:s}}},5610:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shortcutify=t.insertOrAppendByTimestamp=t.draft2labels=t.fixBox=t.labels2draft=t.epsilon=t.labels2string=t.copy=t.insertOrAppend=t.pct2css=void 0;const n=a(109);t.pct2css=e=>100*e+"%",t.insertOrAppend=(e,t,a,n)=>(n?[t]:[]).concat(e.slice(0,a>-1?a:void 0).concat(a>-1?e.slice(a+1):[])),t.copy=e=>{try{return JSON.parse(JSON.stringify(e))}catch(t){throw`Failed to copy object: ${e}`}},t.labels2string=e=>Object.keys(e).filter((t=>1==e[t].length)).map((t=>`${t}: ${e[t][0]}`)).join(", "),t.epsilon=1e-4,t.labels2draft=e=>({image:t.copy((null==e?void 0:e.image)||{}),polygons:t.copy((null==e?void 0:e.polygons)||[]),masks:((null==e?void 0:e.masks)||[]).map((e=>Object.assign(Object.assign({},e),{map:{dimensions:e.map.dimensions,values:n.counts2values(e.map.counts)}}))),dimensions:(null==e?void 0:e.dimensions)?t.copy(e.dimensions):void 0,boxes:t.copy((null==e?void 0:e.boxes)||[])}),t.fixBox=e=>{const t=e.pt1,a=e.pt2||e.pt1;return Object.assign(Object.assign({},e),{pt1:{x:Math.min(t.x,a.x),y:Math.min(t.y,a.y)},pt2:{x:Math.max(t.x,a.x),y:Math.max(t.y,a.y)}})},t.draft2labels=e=>Object.assign(Object.assign({},e),{boxes:e.boxes.map(t.fixBox),masks:e.masks.map((e=>Object.assign(Object.assign({},e),{map:{dimensions:e.map.dimensions,counts:n.values2counts(e.map.values)}})))}),t.insertOrAppendByTimestamp=(e,a)=>t.insertOrAppend(a,e,a.findIndex((t=>t.timestamp===e.timestamp)),!0).sort(((e,t)=>e.timestamp>t.timestamp?1:-1)),t.shortcutify=e=>{let t=e.reduce(((e,t)=>t.options?e.concat(t.options.filter((e=>e.shortcut)).map((e=>e.shortcut))):e),[]);return e.map((e=>Object.assign(Object.assign({},e),{options:e.options?e.options.map((e=>{let a=e.shortcut;return a||(a=[...e.name.toLowerCase()].find((e=>-1==t.indexOf(e))),a&&t.push(a)),Object.assign(Object.assign({},e),{shortcut:a})})):void 0})))}},4741:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Demonstrator=t.Labeler=t.BatchImageLabeler=t.VideoLabeler=t.ImageLabeler=t.MediaIndex=void 0;const l=n(a(284));t.ImageLabeler=l.default;const i=n(a(3673));t.VideoLabeler=i.default;const o=n(a(2428));t.BatchImageLabeler=o.default;const s=n(a(8800));t.Labeler=s.default;const r=n(a(6951));t.Demonstrator=r.default;const d=n(a(8847));t.MediaIndex=d.default},8657:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const n=a(4147);t.MODULE_VERSION=n.version,t.MODULE_NAME=n.name},4147:e=>{e.exports=JSON.parse('{"name":"qslwidgets","version":"0.0.25","description":"Widgets for the QSL image labeling package.","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com/faustomorales/qsl","bugs":{"url":"https://github.com/faustomorales/qsl/issues"},"license":"MIT","author":{"name":"Fausto Morales","email":"fausto@robinbay.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/faustomorales/qsl"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension:dev","build:prod":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:nbextension":"webpack","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf qsl/labextension","clean:nbextension":"rimraf qsl/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","format":"prettier --write src","prepack":"yarn run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch .","storybook":"start-storybook -p 6006","build-storybook":"build-storybook"},"dependencies":{"@emotion/react":"^11.8.1","@emotion/styled":"^11.8.1","@jupyter-widgets/base":"^1.1.10 || ^2.0.0 || ^3.0.0 || ^4.0.0","@mui/icons-material":"^5.6.1","@mui/material":"^5.6.1","@mui/x-data-grid":"^5.11.0","lodash.debounce":"^4.0.8","react":"^17.0.2","react-dom":"^17.0.2","react-highlight":"^0.14.0"},"devDependencies":{"@babel/core":"^7.14.5","@babel/preset-env":"^7.14.5","@babel/preset-react":"^7.14.5","@babel/preset-typescript":"^7.14.5","@jupyterlab/builder":"^3.0.0","@phosphor/application":"^1.6.0","@phosphor/widgets":"^1.6.0","@storybook/addon-actions":"^6.4.22","@storybook/addon-essentials":"^6.4.22","@storybook/addon-interactions":"^6.4.22","@storybook/addon-links":"^6.4.22","@storybook/react":"^6.4.22","@storybook/testing-library":"^0.0.11","@types/jest":"^26.0.0","@types/lodash.debounce":"^4.0.7","@types/react":"^17.0.11","@types/react-dom":"^17.0.8","@types/react-highlight":"^0.12.5","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","babel-loader":"^8.2.2","css-loader":"^6.7.1","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","html-webpack-plugin":"^5.5.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","source-map-loader":"^1.1.3","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.0.0","webpack-cli":"^4.0.0"},"babel":{"presets":["@babel/preset-env","@babel/preset-react","@babel/preset-typescript"]},"jupyterlab":{"extension":"lib/plugin","outputDir":"../qsl/ui/labextension/","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);