import{_ as e,cK as t,e as i,t as s,g as n,i as r}from"./main-ac83c92b.js";import{aG as a,a$ as o,aE as l,b0 as d}from"./c.3e14cfd3.js";import"./c.027db416.js";import"./c.8cbd7110.js";const h=(e,t)=>{var i;const s=t.operator||"==",n=null!==(i=t.value)&&void 0!==i?i:t,r=t.attribute?e.attributes[t.attribute]:e.state;switch(s){case"==":return r===n;case"<=":return r<=n;case"<":return r<n;case">=":return r>=n;case">":return r>n;case"!=":return r!==n;case"in":return!(!Array.isArray(n)&&"string"!=typeof n)&&n.includes(r);case"not in":return!(!Array.isArray(n)&&"string"!=typeof n)&&!n.includes(r);case"regex":return null!==r&&"object"==typeof r?RegExp(n).test(JSON.stringify(r)):RegExp(n).test(r);default:return!1}};let f=e(null,(function(e,t){class f extends t{constructor(...t){super(...t),e(this)}}return{F:f,d:[{kind:"method",static:!0,key:"getStubConfig",value:function(e,t,i){const s=a(e,3,t,i,["light","switch","sensor"]);return{type:"entity-filter",entities:s,state_filter:[s[0]?e.states[s[0]].state:""],card:{type:"entities"}}}},{kind:"field",decorators:[i({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[i()],key:"isPanel",value:()=>!1},{kind:"field",decorators:[i()],key:"editMode",value:()=>!1},{kind:"field",decorators:[s()],key:"_config",value:void 0},{kind:"field",key:"_element",value:void 0},{kind:"field",key:"_configEntities",value:void 0},{kind:"field",key:"_baseCardConfig",value:void 0},{kind:"field",key:"_oldEntities",value:void 0},{kind:"method",key:"getCardSize",value:function(){return this._element?o(this._element):1}},{kind:"method",key:"setConfig",value:function(e){if(!e.entities.length||!Array.isArray(e.entities))throw new Error("Entities must be specified");if(!(e.state_filter&&Array.isArray(e.state_filter)||e.entities.every((e=>"object"==typeof e&&e.state_filter&&Array.isArray(e.state_filter)))))throw new Error("Incorrect filter config");this._configEntities=l(e.entities),this._config=e,this._baseCardConfig={type:"entities",entities:[],...this._config.card},this.lastChild&&this.removeChild(this.lastChild),this._element=this._createCardElement(this._baseCardConfig)}},{kind:"method",key:"createRenderRoot",value:function(){return this}},{kind:"method",key:"shouldUpdate",value:function(e){return this._element&&(this._element.hass=this.hass,this._element.editMode=this.editMode,this._element.isPanel=this.isPanel),!!e.has("_config")||!!e.has("hass")&&this._haveEntitiesChanged(e.get("hass"))}},{kind:"method",key:"update",value:function(e){if(n(r(f.prototype),"update",this).call(this,e),!(this.hass&&this._config&&this._configEntities&&this._element))return;const t=this._configEntities.filter((e=>{const t=this.hass.states[e.entity];if(!t)return!1;if(e.state_filter){for(const i of e.state_filter)if(h(t,i))return!0}else for(const e of this._config.state_filter)if(h(t,e))return!0;return!1}));if(0!==t.length||!1!==this._config.show_empty){if(this.lastChild){if("HUI-ERROR-CARD"!==this._element.tagName){this._oldEntities&&t.length===this._oldEntities.length&&t.every(((e,t)=>e===this._oldEntities[t]))||(this._oldEntities=t,this._element.setConfig({...this._baseCardConfig,entities:t}))}}else this._element.setConfig({...this._baseCardConfig,entities:t}),this._oldEntities=t;this.lastChild||this.appendChild(this._element),this.style.display="block"}else this.style.display="none"}},{kind:"method",key:"_haveEntitiesChanged",value:function(e){if(!this.hass||!e)return!0;if(!this._configEntities)return!0;if(this.hass.localize!==e.localize)return!0;for(const t of this._configEntities)if(this.hass.states[t.entity]!==e.states[t.entity])return!0;return!1}},{kind:"method",key:"_createCardElement",value:function(e){const t=d(e);return this.hass&&(t.hass=this.hass),t.isPanel=this.isPanel,t.editMode=this.editMode,t.addEventListener("ll-rebuild",(i=>{i.stopPropagation(),this._rebuildCard(t,e)}),{once:!0}),t}},{kind:"method",key:"_rebuildCard",value:function(e,t){const i=this._createCardElement(t);e.parentElement&&e.parentElement.replaceChild(i,e),this._element=i}}]}}),t);customElements.define("hui-entity-filter-card",f);
