{"version":3,"sources":["style.module.scss","GetGeometry.tsx","index.tsx"],"names":["module","exports","Platform","GetGeometry","props","render","className","styles","poButton","onClick","_onClicked","disabled","onFocus","_onFocus","onBlur","_onBlur","style","margin","src","process","alt","state","buttonText","Boolean","args","_setStateNow","newState","setState","prevState","geometry","identifier","isPollinationModel","syncToken","platform","Streamlit","setComponentValue","console","log","_rubyRun","window","parent","sketchup","message","get_model","hb_model","get_geometry","geometries","Geometry","Identifier","toLowerCase","_dotNetRun","selection","chrome","webview","hostObjects","sync","hbjson","PassPollinationModel","PassJsonGeometry","rhino","isFocused","initialState","this","stateIdentifiers","JSON","parse","id","split","includes","StreamlitComponentBase","withStreamlitConnection","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.30f34c48.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"poButton\":\"style_poButton__3x8Ka\"};","import {\n  ComponentProps,\n  withStreamlitConnection,\n  StreamlitComponentBase,\n  Streamlit,\n} from 'streamlit-component-lib'\nimport React, { ReactNode } from 'react'\n\nimport styles from './style.module.scss';\n\n// Define here the available hosts\nenum Platform {\n  sketchup,\n  rhino,\n  revit\n}\n\ninterface State {\n  geometry: string\n  identifier: string\n  isPollinationModel: boolean\n  isFocused: boolean\n  syncToken: string\n  platform: string\n  buttonText: string\n}\n\ndeclare global {\n  interface Window {\n    chrome: any;\n    sketchup: any;\n  }\n}\n\nclass GetGeometry extends StreamlitComponentBase<State> {\n\n  public constructor(props: ComponentProps) {\n    super(props)\n\n    // Values from user input\n    const isPollinationModel = this.props.args['isPollinationModel'] as boolean;\n    const platform = this.props.args['platform'] as string;\n    const buttonText = this.props.args['buttonText'] as string;\n    // const syncToken = this.props.args['syncToken'] as string\n    \n    let btn_txt = '';\n    if (buttonText) {\n      btn_txt = buttonText;\n    } else {\n      btn_txt = isPollinationModel ? 'Get Pollination Model' : 'Get Geometry'\n    }\n    \n    const initialState = { \n      geometry: '', \n      identifier: '',\n      isPollinationModel: isPollinationModel,\n      buttonText: btn_txt,\n      platform: platform.toLowerCase()\n    } as State\n\n    this.state = {\n      ...initialState\n    }\n  }\n\n  public render = (): ReactNode => {\n\n    const imgStyle = {\n      margin: '0px 3px 2px 0px'\n    }\n\n    return (\n      <span>\n        <button\n          className={styles.poButton}\n          onClick={this._onClicked}\n          disabled={this.props.disabled}\n          onFocus={this._onFocus}\n          onBlur={this._onBlur}\n        >\n          <span>\n            <img style={imgStyle} \n            src={process.env.PUBLIC_URL + '/img/pollination.png'} \n            alt='logo' />\n          </span>{ this.state.buttonText } \n            { Boolean(this.props.args['syncToken']) && \n            ' (Sync)' }\n        </button>\n      </span>\n    )\n  }\n\n  componentDidUpdate() {\n    // Empty identifier is not allowed\n    if (this.state.identifier === '')\n      return;\n    \n    // Same synctoken is not allowed\n    if (this.props.args['syncToken'] \n      === this.state.syncToken )\n      return;\n\n    // Try get array GUIDs\n    const stateIdentifiers = JSON\n      .parse(this.state.identifier) as Array<string>;\n\n    // Empty GUIDs\n    if (!stateIdentifiers)\n      return;\n    \n    // Try get the key GUID as trigger\n    const id = this.props.args['syncToken']\n      .split(':', 1)[0];\n    \n    if (stateIdentifiers.includes(id)\n      && this.state.syncToken \n      !== this.props.args['syncToken'])\n    {\n      let newState = {} as State;\n      if (this.state.platform == Platform[Platform.rhino])\n      {\n        newState = this._dotNetRun();\n      }\n      this._setStateNow(newState);\n      console.log('[POLLINATION-DEBUG]: auto-update.');\n    }\n  }\n\n  private _setStateNow = (newState: State): \n    void => {\n    this.setState(\n      (prevState) => ({ \n        ...prevState, \n        geometry: newState.geometry,\n        identifier: newState.identifier,\n        isPollinationModel: newState.isPollinationModel,\n        syncToken: newState.syncToken,\n        platform: newState.platform\n      }),\n      () => Streamlit.setComponentValue(this.state.geometry)\n    );\n    console.log('[POLLINATION-DEBUG]: JSON string sent.');\n  }\n\n  private _rubyRun = (): State => {\n    if (typeof window.parent.sketchup != 'undefined') \n    {\n      // ruby invoke\n      let message = null;\n      if (this.props.args['isPollinationModel']) {\n        window.parent.sketchup.get_model();\n        message = window.parent.sketchup.hb_model;\n      } else {\n        // TODO: pass selection\n        window.parent.sketchup.get_geometry();\n        message = window.parent.sketchup.geometries;\n      }\n\n      if (message == null)\n        return this.state;\n\n      console.log(message)\n      const platform = this.props.args['platform'] as string;\n\n      var newState = {\n        geometry: message.Geometry, // model json\n        identifier: message.Identifier, // model id\n        isPollinationModel: this.props.args['isPollinationModel'],\n        syncToken: this.props.args['syncToken'],\n        platform: platform.toLowerCase()\n      } as State;\n  \n      return newState;\n    }\n    else {\n      console.log('[POLLINATION-DEBUG]: sketchup not found.');\n      return this.state;\n    }\n  }\n\n  private _dotNetRun = (selection: boolean = false): State => {\n    if (typeof window.parent.chrome != 'undefined') {\n      if (typeof window.parent.chrome.webview == 'undefined')\n      {\n        console.log('[POLLINATION-DEBUG]: webview not found.');\n        return this.state;\n      }\n\n      // DotNet invoke\n      let message = null;\n      if (!this.props.args['isPollinationModel']) {\n        message = window.parent.chrome.webview\n        .hostObjects.sync.geometry.PassJsonGeometry(\n          this.props.args['key'], \n          selection);\n      } else {\n        message = window.parent.chrome.webview\n        .hostObjects.sync.hbjson.PassPollinationModel(\n          selection);\n      }\n      if (message == null)\n        return this.state;\n\n      const platform = this.props.args['platform'] as string;\n  \n      var newState = {\n        geometry: message.Geometry,\n        identifier: message.Identifier,\n        isPollinationModel: this.props.args['isPollinationModel'],\n        syncToken: this.props.args['syncToken'],\n        platform: platform.toLowerCase()\n      } as State;\n  \n      return newState;\n    }\n    else\n    {\n      console.log('[POLLINATION-DEBUG]: chrome not found.');\n      return this.state;\n    }\n  }\n\n  private _onClicked = (): void => {\n    // Run with selection enabled\n    // Geometries, list of GUIDs saved on runtime\n    // Pollination Model, Model GUID\n    const platform = this.props.args['platform'] as string;\n    let newState = { platform: platform.toLowerCase() } as State;\n    if (platform.toLowerCase() == Platform[Platform.rhino]\n      ) { \n      newState = this._dotNetRun(true); \n    } else if (platform.toLowerCase() == Platform[Platform.sketchup]) {\n      newState = this._rubyRun(); \n    }\n    this._setStateNow(newState);\n  }\n\n  private _onFocus = (): void => {\n    this.setState({ isFocused: true })\n  }\n\n  private _onBlur = (): void => {\n    this.setState({ isFocused: false })\n  }\n}\n\nexport default withStreamlitConnection(GetGeometry)\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport GetGeometry from \"./GetGeometry\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <GetGeometry />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}