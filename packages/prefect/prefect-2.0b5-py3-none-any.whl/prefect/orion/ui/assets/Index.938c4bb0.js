import{d as U,c as C,e as n,O as w,P as b,L as B,$ as le,o as u,l as A,u as ae,a0 as re,y as $,h as m,p as t,i as r,w as c,j as e,W as ue,a1 as Z,a2 as z,a3 as ie,H as R,Y as v,a4 as ce,a5 as _e,a6 as de,a7 as pe,N as fe,Q as me,M as ve,a8 as he,F as ge,Z as ye,a9 as we,aa as J,ab as be,V as k,ac as K}from"./index.435faa1e.js";import{R as xe,M as ke}from"./Radar.95a4e667.js";import{T as Re}from"./Timeline.9c842bcf.js";const $e=U({props:{id:null},setup(F){const h=F,g=C(new xe),p=n(()=>({id:h.id})),f={radar:w.query({endpoint:b.radar,body:p,options:{pollInterval:5e3}})};return B(()=>{var l;return(l=f.radar.response)==null?void 0:l.value},l=>{l&&g.value.items(l)}),le(()=>{g.value.id("id").dependencies("upstream_dependencies").items([])}),(l,D)=>(u(),A(ke,{id:F.id,radar:g.value,"hide-viewport":"","disable-interactions":""},null,8,["id","radar"]))}});const Fe={class:"flow-run-logs-tabs-content"},Te={class:"flow-run-logs-tabs-content__header"},Ie=v(" Copy Logs "),Le={class:"flow-run-logs-tab-content__table"},Ne=ce('<div class="flow-run-logs-tab-content__table-header"><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--level"> Level </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--time"> Time </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--message"> Message </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column-run"> Run name </span></div>',1),Se={class:"flow-run_logs-tab-content__empty"},qe=v(" No logs to show. "),Ce=v(" Try clearing your filter "),Be={key:0,class:"flow-run-logs-tabs-content__loading"},De=U({props:{flowRunId:{type:String,required:!0},running:{type:Boolean}},setup(F){const h=F,g=C(),p=[{label:"Critical only",value:50},{label:"Error and above",value:40},{label:"Warning and above",value:30},{label:"Info and above",value:20},{label:"Debug and above",value:10},{label:"All log levels",value:0}],f=C(0),l=n(()=>({logs:{flow_run_id:{any_:[h.flowRunId]},level:{ge_:f.value}}})),D={interval:h.running?5e3:void 0},_=ae(re.getLogs,[l],D),V=n(()=>{var o;return(o=_.response)!=null?o:[]}),T=n(()=>{var o;return(o=_.loading)!=null?o:!0}),L=()=>{f.value=0},H=()=>{if(!g.value)return;const o=g.value,y=o.scrollTop>0,x=o.scrollTop+o.offsetHeight===o.scrollHeight;y&&x&&_e(()=>{o.scrollTop=o.scrollHeight})},M=()=>V.value.map(o=>{const y=de(o.level),x=pe(o.timestamp);return`${y}	${x}	${o.message}`}).join(`
`);return B(()=>h.running,()=>_.unsubscribe()),B(()=>_.response,()=>H()),(o,y)=>{const x=$("m-select"),a=$("m-button"),N=$("m-loader");return u(),m("div",Fe,[t("div",Te,[r(x,{modelValue:f.value,"onUpdate:modelValue":y[0]||(y[0]=E=>f.value=E),options:p,class:"flow-run-logs-tabs-content__filter"},null,8,["modelValue"]),r(e(ue),{text:"",value:M,class:"flow-run-logs__copy",toast:"Logs copied to clipboard"},{default:c(()=>[Ie]),_:1})]),t("div",Le,[Ne,t("div",{ref_key:"logsRef",ref:g,class:"flow-run-logs-tab-content__logs"},[r(e(ie),{logs:e(V)},{empty:c(()=>[t("p",Se,[qe,Z(r(a,{class:"ml-2",onClick:L},{default:c(()=>[Ce]),_:1},512),[[z,f.value]])])]),_:1},8,["logs"]),F.running||e(T)?(u(),m("div",Be,[r(N,{loading:!0,class:"flow-run-logs-tabs-content__loader"}),Z(t("span",null,"Run in progress...",512),[[z,F.running]])])):R("",!0)],512)])])}}});const Ve={class:"main-grid"},Ee={class:"d-flex align-center justify-space-between py-1 px-2"},je={class:"d-inline-flex flex-column"},Ae={class:"flex-grow-0 flex-shrink-1"},He={class:"d-inline-flex align-center text-truncate"},Me={class:"caption font--primary font-weight-semibold text--grey-40 d-flex text-truncate"},Pe={key:0},Ue=v(" Started: "),We={class:"text--grey-80 mr-1 ml--half"},Ge={key:1},Oe=v(" Ended: "),Qe={class:"text--grey-80 mr-1 ml--half"},Ye={class:"caption font--primary font-weight-semibold text--grey-40 mt-1 d-flex text-truncate"},Ze={key:0},ze=v(" Deployment: "),Je={class:"text--grey-80 mr-1 ml--half"},Ke={key:1},Xe=v(" Parent: "),et={class:"text--grey-80"},tt=v(" /"),st={key:2},nt=v(" Results: "),ot={class:"text--grey-80 mr-1 ml--half"},lt={key:3},at=v(" Flow version: "),rt={class:"text--grey-80 mr-1 ml--half"},ut={class:"font--secondary"},it={class:"d-flex align-center justify-space-between py-1 px-2"},ct=t("div",{class:"subheader"}," Timeline ",-1),_t={class:"timeline-content pb-2 px-2 d-flex flex-grow-1"},dt={class:"d-flex align-center justify-space-between py-1 px-2"},pt=t("div",{class:"subheader"}," Radar ",-1),ft={class:"radar-content pb-2 px-2 d-flex flex-grow-1"},mt={class:"flow-run__tab-content"},vt={class:"results-section"},ht={key:1,class:"text-center my-8"},gt=t("h2",null,"No results found",-1),yt=[gt],wt={class:"results-section"},bt={key:1,class:"text-center my-8"},xt=t("h2",null,"No results found",-1),kt=[xt],Rt=t("hr",{class:"results-hr mt-3"},null,-1),It=U({async setup(F){let h,g;const p=ye(),f=C("logs"),l=C(p==null?void 0:p.params.id),D=n(()=>({id:l.value})),_=([h,g]=fe(()=>w.query({endpoint:b.flow_run,body:D,options:{pollInterval:5e3}}).fetch()),h=await h,g(),h),V=n(()=>_.response.value.flow_id),T=n(()=>_.response.value.parent_task_run_id),L=n(()=>_.response.value.deployment_id),H=n(()=>({id:V.value})),M=n(()=>({id:L.value})),o=n(()=>({task_runs:{id:{any_:[T.value]}}})),y=n(()=>({flow_runs:{id:{any_:[l.value]}}})),x=n(()=>({flow_runs:{id:{any_:[l.value]}},task_runs:{subflow_runs:{exists_:!0}}})),a={flow:w.query({endpoint:b.flow,body:H}),deployment:w.query({endpoint:b.deployment,body:M,options:{paused:!L.value}}),parent_flow:w.query({endpoint:b.flows,body:o,options:{paused:!T.value}}),parent_flow_run:w.query({endpoint:b.flow_runs,body:o,options:{paused:!T.value}}),task_runs_count:w.query({endpoint:b.task_runs_count,body:y,options:{pollInterval:1e4}}),task_runs:w.query({endpoint:b.task_runs,body:y,options:{pollInterval:1e4}}),sub_flow_runs_count:w.query({endpoint:b.task_runs_count,body:x,options:{pollInterval:1e4}})},N=n(()=>{var s;return((s=a.deployment.response)==null?void 0:s.value)||{}}),E=n(()=>{var s,i;return((i=(s=a.parent_flow.response)==null?void 0:s.value)==null?void 0:i[0])||{}}),W=n(()=>{var s,i;return((i=(s=a.parent_flow_run.response)==null?void 0:s.value)==null?void 0:i[0])||{}}),G=n(()=>{var s,i;return(i=(s=N.value)==null?void 0:s.flow_data)==null?void 0:i.blob}),d=n(()=>{var s;return((s=_.response)==null?void 0:s.value)||{}}),X=n(()=>d.value.end_time),S=n(()=>{var s;return(s=d.value)==null?void 0:s.state}),ee=n(()=>S.value.type==we.RUNNING),te=n(()=>{var s;return((s=d.value)==null?void 0:s.tags)||[]}),O=n(()=>{var s;return((s=a.task_runs.response)==null?void 0:s.value)||[]}),se=n(()=>{var s,i,j,I;return[{title:"Logs",key:"logs",icon:"pi-logs-fill",count:null},{title:"Task Runs",key:"task_runs",icon:"pi-task",count:(i=(s=a.task_runs_count.response)==null?void 0:s.value)!=null?i:0},{title:"Subflow Runs",key:"sub_flow_runs",icon:"pi-flow-run",count:(I=(j=a.sub_flow_runs_count.response)==null?void 0:j.value)!=null?I:0}]}),ne=n(()=>S.value.type=="PENDING"||S.value.type=="SCHEDULED"?"--":d.value.total_run_time?J(d.value.total_run_time):J(d.value.estimated_run_time));me(()=>{_.stopPolling(),w.queries.delete(_.id)});const oe=B(p,()=>{l.value=p==null?void 0:p.params.id});return ve(()=>{oe()}),B(l,async()=>{!l.value||(await _.fetch(),a.flow.fetch(),a.task_runs_count.fetch(),a.task_runs.fetch(),a.sub_flow_runs_count.fetch(),L.value?a.deployment.fetch():a.deployment.clearResult(),T.value?a.parent_flow.fetch():a.parent_flow.clearResult(),T.value?a.parent_flow_run.fetch():a.parent_flow_run.clearResult(),f.value="task_runs")}),(s,i)=>{const j=$("m-tags"),I=$("router-link"),P=$("m-card"),Q=$("m-icon-button"),Y=$("ResultsList");return u(),m(ge,null,[t("div",Ve,[r(P,{class:"details",shadow:"sm"},{default:c(()=>[t("div",Ee,[t("div",je,[t("div",Ae,[t("span",He,[r(be,{name:e(S).name,type:e(S).type,class:"mr-1"},null,8,["name","type"]),r(j,{tags:e(te),class:"mr-1 caption"},null,8,["tags"]),t("div",Me,[e(d).start_time?(u(),m("span",Pe,[Ue,t("span",We,k(e(K)(e(d).start_time)),1)])):R("",!0),e(d).end_time?(u(),m("span",Ge,[Oe,t("span",Qe,k(e(K)(e(d).end_time)),1)])):R("",!0)])])]),t("div",Ye,[e(N).name?(u(),m("span",Ze,[ze,t("span",Je,k(e(N).name),1)])):R("",!0),e(E).name?(u(),m("span",Ke,[Xe,t("span",et,k(e(E).name),1),tt,r(I,{to:`/flow-run/${e(W).id}`,class:"mr-1 ml--half text--primary"},{default:c(()=>[v(k(e(W).name),1)]),_:1},8,["to"])])):R("",!0),e(G)?(u(),m("span",st,[nt,t("span",ot,k(e(G)),1)])):R("",!0),e(d).flow_version?(u(),m("span",lt,[at,t("span",rt,k(e(d).flow_version),1)])):R("",!0)])]),t("div",ut,k(e(ne)),1)])]),_:1}),r(P,{class:"timeline d-flex flex-column",width:"auto",shadow:"sm"},{header:c(()=>[t("div",it,[ct,r(I,{to:`/flow-run/${l.value}/timeline`},{default:c(()=>[r(Q,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:c(()=>[t("div",_t,[e(O).length?(u(),A(Re,{key:0,items:e(O),"max-end-time":e(X),"hide-header":"","axis-position":"bottom","background-color":"blue-5"},null,8,["items","max-end-time"])):R("",!0)])]),_:1}),r(P,{class:"radar",shadow:"sm"},{header:c(()=>[t("div",dt,[pt,r(I,{to:`/flow-run/${l.value}/radar`},{default:c(()=>[r(Q,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:c(()=>[t("div",ft,[r($e,{id:l.value},null,8,["id"])])]),_:1})]),r(e(he),{value:f.value,"onUpdate:value":i[0]||(i[0]=q=>f.value=q),tabs:e(se),class:"mt-3"},{logs:c(()=>[t("section",mt,[r(De,{"flow-run-id":l.value,running:e(ee)},null,8,["flow-run-id","running"])])]),task_runs:c(({tab:q})=>[t("section",vt,[q.count>0?(u(),A(Y,{key:"task_runs",filter:e(y),component:"ListItemTaskRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):(u(),m("div",ht,yt))])]),sub_flow_runs:c(({tab:q})=>[t("section",wt,[q.count>0?(u(),A(Y,{key:"sub_flow_runs",filter:e(x),component:"ListItemSubFlowRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):(u(),m("div",bt,kt))])]),_:1},8,["value","tabs"]),Rt],64)}}});export{It as default};
