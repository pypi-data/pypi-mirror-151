import{_ as F,d as G,c as b,e as P,L as q,$ as Q,aw as U,o as j,h as B,p as Y,au as J,j as K,H as tt,X as st,ax as et,ak as it,z as nt,A as ot}from"./index.435faa1e.js";const C=Math.PI,L=2*C,z=1e-6,at=L-z;function S(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Z(){return new S}S.prototype=Z.prototype={constructor:S,moveTo:function(a,s){this._+="M"+(this._x0=this._x1=+a)+","+(this._y0=this._y1=+s)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(a,s){this._+="L"+(this._x1=+a)+","+(this._y1=+s)},quadraticCurveTo:function(a,s,t,e){this._+="Q"+ +a+","+ +s+","+(this._x1=+t)+","+(this._y1=+e)},bezierCurveTo:function(a,s,t,e,i,o){this._+="C"+ +a+","+ +s+","+ +t+","+ +e+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(a,s,t,e,i){a=+a,s=+s,t=+t,e=+e,i=+i;var o=this._x1,n=this._y1,r=t-a,d=e-s,l=o-a,p=n-s,h=l*l+p*p;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=a)+","+(this._y1=s);else if(h>z)if(!(Math.abs(p*r-d*l)>z)||!i)this._+="L"+(this._x1=a)+","+(this._y1=s);else{var M=t-o,g=e-n,v=r*r+d*d,m=M*M+g*g,w=Math.sqrt(v),x=Math.sqrt(h),R=i*Math.tan((C-Math.acos((v+h-m)/(2*w*x)))/2),k=R/x,$=R/w;Math.abs(k-1)>z&&(this._+="L"+(a+k*l)+","+(s+k*p)),this._+="A"+i+","+i+",0,0,"+ +(p*M>l*g)+","+(this._x1=a+$*r)+","+(this._y1=s+$*d)}},arc:function(a,s,t,e,i,o){a=+a,s=+s,t=+t,o=!!o;var n=t*Math.cos(e),r=t*Math.sin(e),d=a+n,l=s+r,p=1^o,h=o?e-i:i-e;if(t<0)throw new Error("negative radius: "+t);this._x1===null?this._+="M"+d+","+l:(Math.abs(this._x1-d)>z||Math.abs(this._y1-l)>z)&&(this._+="L"+d+","+l),t&&(h<0&&(h=h%L+L),h>at?this._+="A"+t+","+t+",0,1,"+p+","+(a-n)+","+(s-r)+"A"+t+","+t+",0,1,"+p+","+(this._x1=d)+","+(this._y1=l):h>z&&(this._+="A"+t+","+t+",0,"+ +(h>=C)+","+p+","+(this._x1=a+t*Math.cos(i))+","+(this._y1=s+t*Math.sin(i))))},rect:function(a,s,t,e){this._+="M"+(this._x0=this._x1=+a)+","+(this._y0=this._y1=+s)+"h"+ +t+"v"+ +e+"h"+-t+"Z"},toString:function(){return this._}};const{cos:V}=Math,{max:W}=Math,{sin:E}=Math,{sqrt:H}=Math,{pow:ft}=Math,{floor:X}=Math,{ceil:rt}=Math,_=Math.PI,N=a=>a**2,O=a=>{const s=a.radius,t=100,e=100,i=Z();return i.arc(t,e,s,a.start,a.end,!1),i.toString()},dt=([,a],s)=>{var l,p,h,M,g;const t=[],e=a.radius,o=125*360/(2*_*e||10),n=(90-o)*_/180,r=(90+o)*_/180;let d=((l=a.positions.get(a.positions.size-1))==null?void 0:l.radian)||0;for(const[,v]of a.positions){const m=[...v.nodes.values()],w=(g=(M=(h=(p=m==null?void 0:m[0])==null?void 0:p.data)==null?void 0:h.state)==null?void 0:M.type)==null?void 0:g.toLowerCase();e==0?t.push({start:115*_/180,end:65*_/180,radius:s/4,state:w||null}):v.radian>n&&d<r?(t.push({start:d,end:n,radius:e,state:null}),t.push({start:r,end:v.radian,radius:e,state:w||null})):t.push({start:d,end:v.radian,radius:e,state:w||null}),d=v.radian}return t};const ht=a=>(nt("data-v-07d676a7"),a=a(),ot(),a),ct=ht(()=>Y("g",{class:"mini-radar__ring-container"},null,-1)),lt=[ct],ut=G({props:{radar:null,collapsedTrees:null,transform:{default:()=>({x:0,y:0,k:1})},height:null,width:null,id:null,baseRadius:{default:300},disableInteractions:{type:Boolean,default:!1},hideViewport:{type:Boolean,default:!1}},emits:["drag-viewport","pan-to-location"],setup(a,{emit:s}){const t=a,e=b(),i=b(),o=b(),n=b(),r=b(0),d=b(0),l=b(!1),p=P(()=>{var u;const f=[...((u=t.collapsedTrees)==null?void 0:u.entries())||new Map().entries()];return new Map([...t.radar.nodes.entries()].filter(([,c])=>f.every(([,y])=>!y.get(c.id))).filter(([,c])=>{var T;if(!t.radar.rings.get(c.ring))return;const{position:A}=c;if(!A)return;const I=[...A.nodes.values()];return((T=I==null?void 0:I[0])==null?void 0:T.id)==c.id}))}),h=P(()=>{const f=new Set([...p.value.entries()].map(([,u])=>u.ring));return new Map([...t.radar.rings.entries()].filter(([u])=>f.has(u)))}),M=P(()=>{const f=[...h.value.entries()].map(([,u])=>u.radius);return Math.max(...f,t.baseRadius*2)}),g=P(()=>Math.min(d.value,r.value)/(M.value*2.5)),v=P(()=>({height:`${m.value.height}px`,width:`${m.value.width}px`})),m=P(()=>!t.height||!t.width?{height:0,width:0}:{height:t.height*g.value,width:t.width*g.value}),w=()=>{var u;const f=c=>`radar__arc-segment ${c.state?`${c.state}-stroke`:""}`;(u=n.value)==null||u.style("transform",`scale(${g.value})`).selectAll(".radar__arc-segment-group").data(h.value).join(c=>c.append("g").attr("class","radar__arc-segment-group"),c=>c,c=>c.remove()).selectAll(".radar__arc-segment").data(c=>dt(c,t.baseRadius)).join(c=>c.append("path").attr("class",f).attr("fill","transparent").attr("stroke","rgba(0, 0, 0, 0.1)").attr("stroke-width",80).attr("d",y=>O(y)),c=>c.attr("class",f).attr("d",y=>O(y)),c=>c.remove())},x=f=>{if(!l.value||t.disableInteractions)return;const u=f.movementX*-(1/g.value),c=f.movementY*-(1/g.value);s("drag-viewport",{x:u,y:c})},R=f=>{var I;if(t.disableInteractions)return;const u=(I=f.target)==null?void 0:I.getBoundingClientRect(),c=(f.clientX-u.left-100)/g.value,y=(f.clientY-u.top-100)/g.value,A=et.scale(t.transform.k).translate(-c,-y);s("pan-to-location",A)},k=()=>{var c;if(!e.value)return;const f=e.value.offsetWidth,u=e.value.offsetHeight;d.value=f,r.value=u,(c=o.value)==null||c.attr("viewbox","0, 0, 200, 200").attr("width",f).attr("height",u),w()};q(()=>t.transform,()=>{if(i.value){const f=(1-t.transform.x/t.transform.k)*g.value+100-m.value.width/2,u=(1-t.transform.y/t.transform.k)*g.value+100-m.value.height/2;i.value.style.transform=`translate(${f}px, ${u}px) scale(${1/t.transform.k})`,i.value.style.borderRadius=`${Math.max(4*t.transform.k,4)}px`}}),q(h,()=>requestAnimationFrame(()=>w()));const $=()=>{o.value=it(".mini-radar__canvas"),n.value=o.value.select(".mini-radar__ring-container"),n.value.style("transform",`scale(${g.value})`),k(),w()};return Q(()=>{$(),window.addEventListener("resize",k)}),U(()=>{window.removeEventListener("resize",k)}),(f,u)=>(j(),B("div",{ref_key:"container",ref:e,class:st(["mini-radar position-relative",{"mini-radar--disabled":t.disableInteractions}]),onMousemove:x,onMouseleave:u[2]||(u[2]=c=>l.value=!1)},[Y("svg",{class:"mini-radar__canvas",onClick:R},lt),a.hideViewport?tt("",!0):(j(),B("div",{key:0,ref_key:"viewport",ref:i,class:"mini-radar__viewport position-absolute",style:J(K(v)),onMousedown:u[0]||(u[0]=c=>l.value=!0),onMouseup:u[1]||(u[1]=c=>l.value=!1)},null,36))],34))}});var _t=F(ut,[["__scopeId","data-v-07d676a7"]]);function D(a){return Array.from(a).filter(([,s])=>s.nodes.size==0)}function pt(a){var t;return(t=D(a)[0])==null?void 0:t[0]}class vt{constructor(){return this._id="id",this._dependencies="upstream_ids",this.nodes=new Map,this.positions=new Map,this.links=[],this.rings=new Map,this.expandedRings=[],this.baseRadius=500,this.channelWidth=250,this.width=275,this.height=145,this.cx=0,this.cy=0,this}center([s,t]){return this.cx=s,this.cy=t,this}expandRing(s){if(!this.rings.get(s))throw new Error("Invalid ringId when expanding ring.");if(this.expandedRings.includes(s))throw new Error("Attempted to expand an already expanded ring.");return this.expandedRings.push(s),this.computeRings(),this.computeInitialPositions(),this}collapseRing(s){if(!this.rings.get(s))throw new Error("Invalid ringId when collapsing ring.");const e=this.expandedRings.indexOf(s);if(e==-1)throw new Error("Attempted to collapse an already collapsed ring.");return this.expandedRings.splice(e,1),this.computeRings(),this.computeInitialPositions(),this}id(s){return this._id=s,this}dependencies(s){return this._dependencies=s,this}items(s){return this.update(s),this}traverse(s,t){if(!s)throw new Error("No starting node was provided to the traverse method.");const e=[s];let i;const o=new Map;for(;e.length>0;)if(i=e.shift(),t==null||t(i),!!i.downstreamNodes.size)for(const[n,r]of i.downstreamNodes)e.push(r),o.set(n,i);return o}update(s){this.nodes=new Map,this.rings=new Map,this.links=[],this.computeNodes(s),this.computeLinks(),this.computeNodeRings(),this.computeRings(),this.computeInitialPositions()}computeNodes(s){const t=s.length;for(let e=0;e<t;e++){const i=s[e],o=this.nodes.get(i[this._id]);o?this.nodes.set(i[this._id],{id:i[this._id],cx:o.cx,cy:o.cy,radian:o.radian,data:i,downstreamNodes:new Map,upstreamNodes:new Map,ring:o.ring}):this.nodes.set(i[this._id],{id:i[this._id],cx:0,cy:0,radian:0,data:i,downstreamNodes:new Map,upstreamNodes:new Map,ring:0})}}computeNodeRings(){const s=[...this.rings.entries()];for(const[t,e]of this.nodes){const i=this.distance(e,"up");e.ring=i,this.nodes.set(t,e),s[i]?s[i][1].nodes.set(t,e):s[i]=[i,{radius:0,nodes:new Map([[t,e]]),positions:new Map,links:[]}]}this.rings=new Map(s)}computeLinks(){for(const[s,t]of this.nodes){const e=t.data[this._dependencies],i=e.length;for(let o=0;o<i;o++){const n=this.nodes.get(e[o][this._id]),r={target:t,source:n};t.upstreamNodes.set(e[o][this._id],n),n.downstreamNodes.set(s,t),this.nodes.set(e[o][this._id],n),this.nodes.set(s,t),this.links.push(r)}}}distance(s,t){const e=t=="up"?"upstreamNodes":t=="down"?"downstreamNodes":void 0;if(e==null)throw new Error("Direction wasn't provided; accepted values: 'up' or 'down'.");const i=(o,n=0)=>{if(o[e].size>0){const r=[];n=n+1;for(const[,d]of o[e]){const l=i(d,n);r.push(l)}return W(...r)}return n};return i(s)}computeRings(s=0){var e;const t=[...this.rings.entries()];for(let i=s;i<t.length;i++){const o=t[0][1].nodes.size,{size:n}=t[i][1].nodes,r=(e=t[i-1])==null?void 0:e[1];let d;if(r?d=r.radius+this.baseRadius:d=o===1?i*this.baseRadius:(i+1)*this.baseRadius,this.expandedRings.includes(i)&&n>1){const p=H(N(this.height)+N(this.width));d=W(rt(n*p/(_*2)),d)}const l=this.computeRingPositions(d);t[i][1].radius=d,t[i][1].positions=l;for(let p=0;p<l.size;p++){const h=l.get(p);!h||this.positions.set(h.id,h)}}this.rings=new Map(t),this.links.forEach(i=>{const o=this.rings.get(i.source.ring);o&&(o.links.push(i),this.rings.set(i.source.ring,o))})}computeInitialPositions(){if(this.rings.size===0)return;let s;for(const[t,e]of this.rings){let i=0;for(const[o,n]of e.nodes){const r=this.getNodePosition(n,t,s,i);n.cx=this.cx+e.radius*V(r.radian),n.cy=this.cy+e.radius*E(r.radian),n.radian=r.radian,n.position=r,r.nodes.set(n.id,n),e.positions.set(r.id,r),this.rings.set(t,e),this.nodes.set(o,n),++i}s=e}this.nodes=new Map([...this.nodes].sort(([,t],[,e])=>!t.position||!e.position?0:t.ring==e.ring?t.position.id-e.position.id:t.ring-e.ring))}computeRingPositions(s){const t=new Map;if(s<=0)return t.set(0,{id:0,radian:0,nodes:new Map,radius:s}),t;let e=0,i=0;const o=[0],n=_/2-this.width*.8/2/s;for(;e<n;){const r=1.25-.3*E(e),d=H(N(this.height)*N(V(i))+N(this.width)*N(E(i))),l=r*d/s;i+=l,e+=l,e<n&&(e<s/(this.channelWidth+this.width/2)&&(o.push(e%(2*_)),o.push((3*_-e)%(2*_))),o.push((_+e)%(2*_)),o.push((2*_-e)%(2*_)))}return o.push(_),o.sort().forEach((r,d)=>t.set(d,{id:d,radian:r,nodes:new Map,radius:s})),t}getNodePosition(s,t,e,i=0){var l,p;const n=this.rings.get(t).positions;let r;if([...n.values()].every(h=>h.nodes.size>0))return n.get(n.size-1);if(s.upstreamNodes.size===0||t==0||t==1){const h=D(n);i===0||i%2===0?r=n.get((l=h[0])==null?void 0:l[0]):r=n.get((p=h[X(h.length/2)])==null?void 0:p[0])}else{const h=s.upstreamNodes.entries();for(;!r;){const[,M]=h.next().value||[null,null];if(!M)break;const g=X(M.position/e.positions.size*n.size),v=n.get(g);if(v&&v.nodes.size===0){r=v;break}let m=g-1==0?n.size-1:g-1,w=g+1;for(;m>=0||w<=n.size;){const x=n.get(m);if(x&&x.nodes.size===0){r=x;break}const R=n.get(w);if(R&&R.nodes.size===0){r=R;break}m--,w++}}}if(!r){const h=pt(n);r=typeof h!="undefined"?n.get(h):n.get(n.size-1)}return r}}export{_t as M,vt as R,Z as a,_ as b,V as c,E as d,ft as p,H as s};
