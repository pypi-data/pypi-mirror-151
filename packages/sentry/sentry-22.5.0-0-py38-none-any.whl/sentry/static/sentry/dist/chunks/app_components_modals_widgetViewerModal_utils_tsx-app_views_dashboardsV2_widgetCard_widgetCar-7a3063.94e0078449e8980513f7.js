"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_modals_widgetViewerModal_utils_tsx-app_views_dashboardsV2_widgetCard_widgetCar-7a3063"],{"./app/components/charts/simpleTableChart.tsx":(e,t,s)=>{s.d(t,{p:()=>R,Z:()=>j});var i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("../node_modules/react/index.js"),n=s("./app/components/links/link.tsx"),o=s("./app/components/panels/panelTable.tsx"),a=s("./app/components/tooltip.tsx"),l=s("./app/components/truncate.tsx"),d=s("./app/locale.tsx"),u=s("./app/styles/space.tsx"),c=s("./app/utils/discover/fieldRenderers.tsx"),p=s("./app/utils/discover/fields.tsx"),g=s("./app/utils/discover/urls.tsx"),m=s("./app/utils/withOrganization.tsx"),h=s("./app/views/eventsV2/table/topResultsIndicator.tsx"),v=s("./app/views/eventsV2/utils.tsx"),f=s("./app/views/performance/traceDetails/utils.tsx"),y=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function b(e){let{className:t,loading:s,eventView:i,fields:o,metadata:l,data:u,title:m,fieldHeaderMap:b,stickyHeaders:j,getCustomFieldRenderer:_,organization:q,topResultsIndicators:S,location:F,fieldAliases:E,loader:M}=e;const C=null!=l?l:{},O=(0,v.Hg)(o.map(((e,t)=>({field:e,alias:E[t]}))));return(0,y.BX)(r.Fragment,{children:[m&&(0,y.tZ)("h4",{children:m}),(0,y.tZ)(x,{className:t,isLoading:s,loader:M,headers:O.map(((e,t)=>{var s;const i=(0,p.qG)(e.name,e.type,C),r=e.column.alias||(null!==(s=null==b?void 0:b[e.key])&&void 0!==s?s:e.name);return(0,y.tZ)(Z,{align:i,children:(0,y.tZ)(a.ZP,{title:r,children:(0,y.tZ)(w,{value:r,maxLength:30,expandable:!1})})},t)})),isEmpty:!(null!=u&&u.length),stickyHeaders:j,disablePadding:!0,children:null==u?void 0:u.map(((e,t)=>function(e,t,s,r){return r.map(((r,o)=>{var l;let u=(null!==(l=null==_?void 0:_(r.key,s))&&void 0!==l?l:(0,c.Js)(r.key,s))(t,{organization:q,location:F});if("id"===r.key){const e=(0,g.JE)(t),s=(0,g.eQ)({orgSlug:q.slug,eventSlug:e,eventView:i});u=(0,y.tZ)(a.ZP,{title:(0,d.t)("View Event"),children:(0,y.tZ)(n.Z,{"data-test-id":"view-event",to:s,children:u})})}else if("trace"===r.key){const e=i.normalizeDateSelection(F);if(t.trace){const s=(0,f.YA)(q,String(t.trace),e,{});u=(0,y.tZ)(a.ZP,{title:(0,d.t)("View Trace"),children:(0,y.tZ)(n.Z,{"data-test-id":"view-trace",to:s,children:u})})}}return(0,y.BX)(R,{children:[S&&0===o&&(0,y.tZ)(h.Z,{count:S,index:e}),u]},`${e}-${o}:${r.name}`)}))}(t,e,C,O)))})]})}b.displayName="SimpleTableChart";const w=(0,i.Z)(l.Z,{target:"e3tr8vk3"})({name:"1bmnxg7",styles:"white-space:nowrap"}),x=(0,i.Z)(o.Z,{target:"e3tr8vk2"})("border-radius:0;border-left:0;border-right:0;border-bottom:0;margin:0;",o.z,"{height:min-content;}"),Z=(0,i.Z)("div",{target:"e3tr8vk1"})((e=>e.align?`text-align: ${e.align};`:"")," padding:",(0,u.Z)(1)," ",(0,u.Z)(3),";"),R=(0,i.Z)("div",{target:"e3tr8vk0"})("padding:",(0,u.Z)(1)," ",(0,u.Z)(3),";"),j=(0,m.Z)(b)},"./app/components/modals/widgetViewerModal/utils.tsx":(e,t,s)=>{let i;function r(e){return e.match(/\/widget\/[0-9]+\/$/)}s.d(t,{R:()=>i,X:()=>r}),function(e){e.SORT="sort",e.QUERY="query",e.LEGEND="legend",e.PAGE="page",e.CURSOR="cursor",e.WIDTH="width",e.START="viewerStart",e.END="viewerEnd"}(i||(i={}))},"./app/utils/dashboards/issueFieldRenderers.tsx":(e,t,s)=>{s.d(t,{N:()=>x,O:()=>M});var i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("../node_modules/react/index.js"),n=s("./app/components/assigneeSelector.tsx"),o=s("./app/components/count.tsx"),a=s("./app/components/links/link.tsx"),l=s("./app/components/organizations/timeRangeSelector/utils.tsx"),d=s("./app/components/tooltip.tsx"),u=s("./app/constants/index.tsx"),c=s("./app/locale.tsx"),p=s("./app/stores/memberListStore.tsx"),g=s("./app/styles/space.tsx"),m=s("./app/utils/discover/eventView.tsx"),h=s("./app/views/dashboardsV2/widgetBuilder/issueWidget/fields.tsx"),v=s("./app/utils/discover/styles.tsx"),f=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const y={issue:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;const i=e["issue.id"];if(!i)return(0,f.tZ)(v.W2,{children:(0,f.tZ)(v.PV,{shortId:`${e.issue}`})});const r={pathname:`/organizations/${s.slug}/issues/${i}/`};return(0,f.tZ)(v.W2,{children:(0,f.tZ)(v.Jo,{to:r,"aria-label":i,children:(0,f.tZ)(v.PV,{shortId:`${e.issue}`})})})}},assignee:{sortField:null,renderFunc:e=>{const t=p.Z.getAll();return(0,f.tZ)(F,{children:(0,f.tZ)(n.Z,{id:e.id,memberList:t,noDropdown:!0})})}},lifetimeEvents:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"lifetimeEvents")}},lifetimeUsers:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"lifetimeUsers")}},events:{sortField:"freq",renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"events")}},users:{sortField:"user",renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"users")}},lifetimeCount:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"lifetimeEvents")}},lifetimeUserCount:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"lifetimeUsers")}},count:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"events")}},userCount:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"users")}},links:{sortField:null,renderFunc:e=>{let{links:t}=e;return(0,f.tZ)(E,{dangerouslySetInnerHTML:{__html:t}})}}},b=(e,t,s)=>{const{start:i,end:n,period:a}=e,p=!!/user/i.exec(s.toLowerCase()),g=e[s],m=e[p?"users":"events"],h=e[p?"lifetimeUsers":"lifetimeEvents"],y=e[p?"filteredUsers":"filteredEvents"],b=w(e,t),x=w(e,t,!0),Z=i&&n?"time range":(0,l.T)(a||u.GY).toLowerCase();return(0,f.tZ)(v.W2,{children:(0,f.tZ)(d.ZP,{isHoverable:!0,skipWrapper:!0,popperStyle:{padding:0},title:(0,f.BX)("div",{children:[y?(0,f.BX)(r.Fragment,{children:[(0,f.BX)(j,{to:x,children:[(0,c.t)("Matching search filters"),(0,f.tZ)(q,{value:y})]}),(0,f.tZ)(S,{})]}):null,(0,f.BX)(j,{to:b,children:[(0,c.t)(`Total in ${Z}`),(0,f.tZ)(q,{value:m})]}),(0,f.tZ)(S,{}),(0,f.BX)(R,{children:[(0,c.t)("Since issue began"),(0,f.tZ)(q,{value:h})]})]}),children:(0,f.tZ)("span",{children:["events","users"].includes(s)&&y?(0,f.BX)(r.Fragment,{children:[(0,f.tZ)(o.Z,{value:y}),(0,f.tZ)(_,{value:g})]}):(0,f.tZ)(o.Z,{value:g})})})})};b.displayName="issuesCountRenderer";const w=(e,t,s)=>{const i={projects:[Number(e.projectId)]};return m.ZP.fromSavedQuery({...i,id:void 0,start:e.start,end:e.end,range:e.period,name:e.title,fields:["title","release","environment","user","timestamp"],orderby:"-timestamp",query:`issue.id:${e.id}${s?e.discoverSearchQuery:""}`,version:2}).getResultsViewUrlTarget(t.slug)};function x(e){if(y.hasOwnProperty(e))return y[e].sortField;switch(e){case h.Sh.LAST_SEEN:return"date";case h.Sh.FIRST_SEEN:return"new";default:return null}}const Z={name:"s5gdgx",styles:"width:100%;justify-content:space-between;display:flex;padding:6px 10px"},R=(0,i.Z)("div",{target:"e1va53iy6"})(Z,";"),j=(0,i.Z)(a.Z,{target:"e1va53iy5"})(Z,";color:",(e=>e.theme.gray400),";&:hover{color:",(e=>e.theme.gray400),";background:",(e=>e.theme.hover),";}"),_=(0,i.Z)(o.Z,{target:"e1va53iy4"})(":before{content:'/';padding-left:",(0,g.Z)(.25),";padding-right:2px;}"),q=(0,i.Z)((e=>{let{value:t,...s}=e;return(0,f.tZ)("div",{...s,children:(0,f.tZ)(o.Z,{value:t})})}),{target:"e1va53iy3"})("text-align:right;font-weight:bold;font-variant-numeric:tabular-nums;padding-left:",(0,g.Z)(2),";color:",(e=>e.theme.subText),";"),S=(0,i.Z)("div",{target:"e1va53iy2"})("height:1px;overflow:hidden;background-color:",(e=>e.theme.innerBorder),";"),F=(0,i.Z)("div",{target:"e1va53iy1"})({name:"1sl6pdq",styles:"display:flex;justify-content:left;margin-left:18px;height:24px;:hover{cursor:default;}"}),E=(0,i.Z)("span",{target:"e1va53iy0"})({name:"1bmnxg7",styles:"white-space:nowrap"});function M(e){return y.hasOwnProperty(e)?y[e].renderFunc:null}},"./app/utils/discover/charts.tsx":(e,t,s)=>{s.d(t,{CX:()=>a,gu:()=>l});var i=s("./app/locale.tsx"),r=s("./app/utils.tsx"),n=s("./app/utils/discover/fields.tsx"),o=s("./app/utils/formatters.tsx");function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!(0,r.ri)(e))return"—";switch((0,n.Px)(t)){case"integer":case"number":return e.toLocaleString();case"percentage":return(0,o.rl)(e,2);case"duration":return(0,o.g9)(e/1e3,2,!0);default:return e.toString()}}function l(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch((0,n.Px)(t)){case"integer":case"number":return s?(0,o.Du)(e):e.toLocaleString();case"percentage":return(0,o.rl)(e,0);case"duration":return d(e);default:return e.toString()}}function d(e){if(0===e)return"0";if(e>=o.ps){const t=(e/o.ps).toFixed(0);return(0,i.t)("%swk",t)}if(e>=o.x4){const t=(e/o.x4).toFixed(0);return(0,i.t)("%sd",t)}if(e>=o.kr){const t=(e/o.kr).toFixed(0);return(0,i.t)("%shr",t)}if(e>=o.EB){const t=(e/o.EB).toFixed(0);return(0,i.t)("%smin",t)}if(e>=o.sh){const t=(e/o.sh).toFixed(0);return(0,i.t)("%ss",t)}const t=e.toFixed(0);return(0,i.t)("%sms",t)}},"./app/views/dashboardsV2/utils.tsx":(e,t,s)=>{s.d(t,{qk:()=>Z,tT:()=>R,y1:()=>_,DW:()=>q,s:()=>S,Mf:()=>F,z1:()=>E,hS:()=>M,Tk:()=>C,Gl:()=>O,yd:()=>T}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var i=s("../node_modules/lodash/cloneDeep.js"),r=s.n(i),n=s("../node_modules/lodash/pick.js"),o=s.n(n),a=s("../node_modules/query-string/index.js"),l=s("./images/dashboard/widget-area.svg"),d=s("./images/dashboard/widget-bar.svg"),u=s("./images/dashboard/widget-big-number.svg"),c=s("./images/dashboard/widget-line-1.svg"),p=s("./images/dashboard/widget-table.svg"),g=s("./images/dashboard/widget-world-map.svg"),m=s("./app/components/arithmeticInput/parser.tsx"),h=s("./app/components/charts/utils.tsx"),v=s("./app/utils.tsx"),f=s("./app/utils/dates.tsx"),y=s("./app/utils/discover/eventView.tsx"),b=s("./app/utils/discover/fields.tsx"),w=s("./app/utils/discover/types.tsx"),x=s("./app/views/dashboardsV2/types.tsx");function Z(e){return r()(e)}function R(e,t,s,i){const{start:r,end:n,period:o}=s.datetime,{projects:a,environments:l}=s,d=i!==x.FO.WORLD_MAP||t.columns.includes("geo.country_code")?[...t.columns,...t.aggregates]:["geo.country_code",...t.columns,...t.aggregates],u=i!==x.FO.WORLD_MAP||t.conditions.includes("has:geo.country_code")?t.conditions:`${t.conditions} has:geo.country_code`.trim();return y.ZP.fromSavedQuery({id:void 0,name:e,version:2,fields:d,query:u,orderby:t.orderby,projects:a,range:null!=o?o:void 0,start:r?(0,f.v5)(r):void 0,end:n?(0,f.v5)(n):void 0,environment:l})}function j(e){return"string"==typeof e?[e]:e}function _(e){if(e){const t=j(e.queryNames),s=j(e.queryConditions),i=j(e.queryFields),r=[];if(s&&t&&i&&"string"==typeof e.queryOrderby){const{columns:n,aggregates:o}=(0,b.n0)(i);s.forEach(((s,a)=>{r.push({name:t[a],conditions:s,fields:i,columns:n,aggregates:o,orderby:e.queryOrderby})}))}if(e.title&&e.displayType&&e.interval&&r.length>0)return{...o()(e,["title","displayType","interval"]),widgetType:x.l9.DISCOVER,queries:r}}}function q(e){switch(e){case x.FO.BAR:return d;case x.FO.AREA:case x.FO.TOP_N:return l;case x.FO.BIG_NUMBER:return u;case x.FO.TABLE:return p;case x.FO.WORLD_MAP:return g;case x.FO.LINE:default:return c}}function S(e,t){let s="bar"===e.displayType?"1d":e.interval;s||(s="5m");const i=(0,f.YJ)(s);if((0,h.Nm)(t)/(60*i)>66){const e=(0,h.ZS)(t,"high");if(i<(0,f.YJ)(e))return e}return s}function F(e){const t=new Set;return e.filter(b.GO).forEach((e=>{const s=(0,m.W9)((0,b.bQ)(e)).tc;s.fields.forEach((e=>{let{term:s}=e;return t.add(s)})),s.functions.forEach((e=>{let{term:s}=e;return t.add(s)}))})),Array.from(t)}function E(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=R(e.title,e.queries[i],t,e.displayType),n=r.getResultsViewUrlTarget(s.slug),o=r.getYAxisOptions().map((e=>{let{value:t}=e;return t}));switch(n.query.yAxis=[...new Set(e.queries[0].aggregates.filter((e=>o.includes(e))))].slice(0,3),e.displayType){case x.FO.WORLD_MAP:n.query.display=w.DC.WORLDMAP;break;case x.FO.BAR:n.query.display=w.DC.BAR;break;case x.FO.TOP_N:n.query.display=w.DC.TOP5;const t=e.queries[0].aggregates;n.query.yAxis=t[t.length-1],t.slice(0,-1).includes(t[t.length-1])&&(n.query.field=t.slice(0,-1))}const l=n.query.field,d=e.queries[0],u=(0,v.ri)(d.fields)?d.fields:[...d.columns,...d.aggregates],c=F(u);c.forEach((e=>{Array.isArray(l)&&!l.includes(e)&&l.unshift(e)}));const p=`${n.pathname}?${a.stringify({...n.query})}`;return p}function M(e,t,s){var i,r,n,o;const{start:l,end:d,utc:u,period:c}=t.datetime,p=l&&d?{start:(0,f.v5)(l),end:(0,f.v5)(d),utc:u}:{statsPeriod:c};return`/organizations/${s.slug}/issues/?${a.stringify({query:null===(i=e.queries)||void 0===i||null===(r=i[0])||void 0===r?void 0:r.conditions,sort:null===(n=e.queries)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.orderby,...p})}`}function C(e,t){return"string"==typeof e?t.error=e:Object.keys(e).forEach((s=>{const i=e[s];"string"!=typeof i?Array.isArray(i)&&"string"==typeof i[0]?t[s]=i[0]:Array.isArray(i)&&"object"==typeof i[0]?i.map((e=>C(e,t))):C(i,t):t[s]=i})),t}function O(e){return e?{dataset:"metricsEnhanced"}:{}}function T(e){return e.filter(b.GO).length}},"./app/views/dashboardsV2/widgetCard/chart.tsx":(e,t,s)=>{s.d(t,{R:()=>T,Z:()=>D});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),o=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),a=s("../node_modules/lodash/isEqual.js"),l=s.n(a),d=s("../node_modules/lodash/omit.js"),u=s.n(d),c=s("./app/components/charts/areaChart.tsx"),p=s("./app/components/charts/barChart.tsx"),g=s("./app/components/charts/chartZoom.tsx"),m=s("./app/components/charts/errorPanel.tsx"),h=s("./app/components/charts/lineChart.tsx"),v=s("./app/components/charts/simpleTableChart.tsx"),f=s("./app/components/charts/transitionChart.tsx"),y=s("./app/components/charts/transparentLoadingMask.tsx"),b=s("./app/components/charts/utils.tsx"),w=s("./app/components/charts/worldMapChart.tsx"),x=s("./app/components/loadingIndicator.tsx"),Z=s("./app/components/placeholder.tsx"),R=s("./app/components/tooltip.tsx"),j=s("./app/icons/index.tsx"),_=s("./app/styles/space.tsx"),q=s("./app/utils/discover/charts.tsx"),S=s("./app/utils/discover/fieldRenderers.tsx"),F=s("./app/utils/discover/fields.tsx"),E=s("./app/utils/getDynamicText.tsx"),M=s("./app/views/dashboardsV2/utils.tsx"),C=s("./app/views/dashboardsV2/types.tsx"),O=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const T=60;class k extends n.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{containerHeight:0})}shouldComponentUpdate(e,t){var s,i;if(this.props.widget.displayType===C.FO.BIG_NUMBER&&e.widget.displayType===C.FO.BIG_NUMBER&&(this.props.windowWidth!==e.windowWidth||!l()(null===(s=this.props.widget)||void 0===s?void 0:s.layout,null===(i=e.widget)||void 0===i?void 0:i.layout)))return!0;const r={...u()(this.props,["windowWidth"]),widget:{...this.props.widget,title:""}};return e={...u()(e,["windowWidth"]),widget:{...e.widget,title:""}},!l()(r,e)||!l()(this.state,t)}tableResultComponent(e){let{loading:t,errorMessage:s,tableResults:i}=e;const{location:r,widget:n,organization:o,selection:a}=this.props;return s?(0,O.tZ)(N,{children:(0,O.tZ)(j.FC,{color:"gray500",size:"lg"})}):void 0===i?(0,O.tZ)(A,{}):i.map(((e,s)=>{var l,d,u,c,p;const g=null!==(l=null===(d=n.queries[s])||void 0===d||null===(u=d.fields)||void 0===u?void 0:u.map(F.hr))&&void 0!==l?l:[],m=null!==(c=null===(p=n.queries[s])||void 0===p?void 0:p.fieldAliases)&&void 0!==c?c:[],h=(0,M.tT)(n.title,n.queries[0],a,n.displayType);return(0,O.tZ)(I,{eventView:h,fieldAliases:m,location:r,fields:g,title:i.length>1?e.title:"",loading:t,loader:(0,O.tZ)(A,{}),metadata:e.meta,data:e.data,organization:o,stickyHeaders:!0,getCustomFieldRenderer:(e,t)=>(0,S.Js)(e,t,n.widgetType!==C.l9.RELEASE)},`table:${e.title}`)}))}bigNumberComponent(e){let{loading:t,errorMessage:s,tableResults:i}=e;if(s)return(0,O.tZ)(N,{children:(0,O.tZ)(j.FC,{color:"gray500",size:"lg"})});if(void 0===i||t)return(0,O.tZ)($,{children:"—"});const{containerHeight:r}=this.state,{organization:n,widget:o,isMobile:a,expandNumbers:l}=this.props;return i.map((e=>{const t={...e.meta},s=Object.keys(t)[0],i=!!l&&"integer"===t[s];if(i&&(t[s]="string"),!s||!e.data.length)return(0,O.tZ)($,{children:"—"},`big_number:${e.title}`);const d=e.data[0],u=(0,S.fK)(s,t,o.widgetType!==C.l9.RELEASE)(i?{[s]:d[s].toLocaleString()}:d),c=!(o.id||o.tempId);if(!n.features.includes("dashboard-grid-layout")||c||a)return(0,O.tZ)($,{children:u},`big_number:${e.title}`);const p=l?`max(min(8vw, 90px), ${(0,_.Z)(4)})`:r-parseInt((0,_.Z)(1),10)-parseInt((0,_.Z)(3),10);return(0,O.tZ)($,{style:{fontSize:p,...l?{padding:`${(0,_.Z)(1)} ${(0,_.Z)(3)} 0 ${(0,_.Z)(3)}`}:{}},children:(0,O.tZ)(R.ZP,{title:u,showOnlyOnOverflow:!0,children:u})},`big_number:${e.title}`)}))}chartComponent(e){const{organization:t,widget:s}=this.props,i=t.features.includes("new-widget-builder-experience-design")&&s.queries[0].columns.length>0;switch(s.displayType){case"bar":return(0,O.tZ)(p.v,{...e,stacked:i});case"area":case"top_n":return(0,O.tZ)(c.T,{stacked:!0,...e});case"world_map":return(0,O.tZ)(w.y,{...e});default:return(0,O.tZ)(h.w,{...e})}}render(){var e,t,s;const{theme:i,tableResults:r,timeseriesResults:n,errorMessage:o,loading:a,widget:l,organization:d,onZoom:u,legendOptions:c,expandNumbers:p,showSlider:m,noPadding:h,chartZoomOptions:v}=this.props;if("table"===l.displayType)return(0,E.Z)({value:(0,O.BX)(f.Z,{loading:a,reloading:a,children:[(0,O.tZ)(z,{loading:a}),this.tableResultComponent({tableResults:r,loading:a,errorMessage:o})]}),fixed:(0,O.tZ)(Z.Z,{height:"200px",testId:"skeleton-ui"})});if("big_number"===l.displayType)return(0,O.BX)(f.Z,{loading:a,reloading:a,children:[(0,O.tZ)(z,{loading:a}),(0,O.tZ)(L,{ref:e=>{if(null!==e&&!p){const{height:t}=e.getBoundingClientRect();t!==this.state.containerHeight&&this.setState({containerHeight:t})}},children:this.bigNumberComponent({tableResults:r,loading:a,errorMessage:o})})]});if(o)return(0,O.tZ)(N,{children:(0,O.tZ)(j.FC,{color:"gray500",size:"lg"})});const{location:y,router:w,selection:x,onLegendSelectChanged:R}=this.props,{start:_,end:S,period:M,utc:C}=x.datetime,k=Boolean(d.features.includes("dashboard-grid-layout")&&(l.id||l.tempId));if("world_map"===l.displayType){const{data:e,title:t}=(0,b.JT)(r),s=[{seriesName:t,data:e}];return(0,O.BX)(f.Z,{loading:a,reloading:a,children:[(0,O.tZ)(z,{loading:a}),(0,O.tZ)(B,{autoHeightResize:k,children:(0,E.Z)({value:this.chartComponent({series:s,autoHeightResize:k}),fixed:(0,O.tZ)(Z.Z,{height:"200px",testId:"skeleton-ui"})})})]})}const D={left:0,top:0,selected:(0,b.RI)(y),formatter:e=>{const t=(0,F.hW)(e);if(null!==t){const s=(0,F.b8)(t);null!==s&&(e=s.toUpperCase())}return(0,F.by)(e)&&(e=(0,F.bQ)(e)),e},...c},P=null!==(e=null===(t=l.queries[0])||void 0===t||null===(s=t.aggregates)||void 0===s?void 0:s[0])&&void 0!==e?e:"count()",A=(0,F.GO)(P)?(0,F.vp)(P):P,$={autoHeightResize:k,grid:{left:0,right:4,top:"40px",bottom:m?T:0},seriesOptions:{showSymbol:!1},tooltip:{trigger:"axis",valueFormatter:q.CX},yAxis:{axisLabel:{color:i.chartLabel,formatter:e=>(0,q.gu)(e,A)}}};return(0,O.tZ)(g.Z,{router:w,period:M,start:_,end:S,utc:C,showSlider:m,chartZoomOptions:v,children:e=>{var t,s,r,d;if(o)return(0,O.tZ)(N,{children:(0,O.tZ)(j.FC,{color:"gray500",size:"lg"})});const c="top_n"===l.displayType&&n&&n.length>5,p=n?i.charts.getColorPalette(n.length-(c?3:2)):[];c&&(p[p.length]=i.chartOther);const g=n?n.map(((e,t)=>{let s="";return void 0!==e.seriesName&&(s=(0,F.GO)(e.seriesName)?(0,F.vp)(e.seriesName):e.seriesName),{...e,seriesName:s,color:p[t]}})):[],m=null===(t=g[0])||void 0===t||null===(s=t.data[0])||void 0===s?void 0:s.name,v=null===(r=g[0])||void 0===r||null===(d=r.data[g[0].data.length-1])||void 0===d?void 0:d.name;return(0,O.BX)(f.Z,{loading:a,reloading:a,children:[(0,O.tZ)(z,{loading:a}),(0,O.tZ)(B,{autoHeightResize:k,noPadding:h,children:(0,E.Z)({value:this.chartComponent({...e,...$,...u?{onDataZoom:(e,t)=>u({...e,seriesStart:m,seriesEnd:v},t)}:{},legend:D,series:g,onLegendSelectChanged:R}),fixed:(0,O.tZ)(Z.Z,{height:"200px",testId:"skeleton-ui"})})})]})}})}}k.displayName="WidgetCardChart";const D=(0,o.b)(k),P=(0,r.Z)((e=>(0,O.tZ)(y.Z,{...e,maskBackgroundColor:"transparent"})),{target:"eb7j3e6"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),z=e=>{let{loading:t}=e;return t?(0,O.tZ)(P,{visible:t,children:(0,O.tZ)(x.Z,{mini:!0})}):null};z.displayName="LoadingScreen";const A=(0,r.Z)((e=>{let{className:t}=e;return(0,O.tZ)(Z.Z,{height:"200px",className:t})}),{target:"eb7j3e5"})("background-color:",(e=>e.theme.surface200),";"),L=(0,r.Z)("div",{target:"eb7j3e4"})({name:"af8mp8",styles:"height:100%;width:100%;overflow:hidden"}),$=(0,r.Z)("div",{target:"eb7j3e3"})("line-height:1;display:inline-flex;flex:1;width:100%;min-height:0;font-size:32px;color:",(e=>e.theme.headingColor),";padding:",(0,_.Z)(1)," ",(0,_.Z)(3)," ",(0,_.Z)(3)," ",(0,_.Z)(3),";*{text-align:left!important;}"),B=(0,r.Z)("div",{target:"eb7j3e2"})((e=>e.autoHeightResize&&"height: 100%;")," padding:",(e=>e.noPadding?"0":`0 ${(0,_.Z)(3)} ${(0,_.Z)(3)}`),";"),I=(0,r.Z)(v.Z,{target:"eb7j3e1"})("margin-top:",(0,_.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;"),N=(0,r.Z)(m.Z,{target:"eb7j3e0"})("padding:",(0,_.Z)(2),";")},"./app/views/dashboardsV2/widgetCard/dashboardsMEPContext.tsx":(e,t,s)=>{s.d(t,{HH:()=>l,KC:()=>u,k:()=>d,XA:()=>a}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var i=s("../node_modules/react/index.js"),r=s("./app/utils/performance/contexts/utils.tsx"),n=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const[o,a,l]=(0,r.n)({name:"DashboardsMEPContext"}),d=l.Consumer;function u(e){let{children:t}=e;const[s,r]=(0,i.useState)(void 0);return(0,n.tZ)(o,{value:{isMetricsData:s,setIsMetricsData:r},children:t})}u.displayName="DashboardsMEPProvider"},"./app/views/dashboardsV2/widgetCard/issueWidgetQueries.tsx":(e,t,s)=>{s.d(t,{Z:()=>w});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("../node_modules/lodash/isEqual.js"),o=s.n(n),a=s("./app/components/organizations/pageFilters/utils.tsx"),l=s("./app/locale.tsx"),d=s("./app/stores/groupStore.tsx"),u=s("./app/stores/memberListStore.tsx"),c=s("./app/utils/dates.tsx"),p=s("./app/utils/getDynamicText.tsx"),g=s("./app/utils/stream.tsx"),m=s("./app/views/issueList/utils.tsx"),h=s("./app/views/dashboardsV2/types.tsx"),v=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const f=m.qh.DATE,y=["owners"];class b extends r.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{loading:!0,errorMessage:void 0,tableResults:[],memberListStoreLoaded:u.Z.isLoaded(),totalCount:null,pageLinks:null}),(0,i.Z)(this,"unlisteners",[u.Z.listen((()=>{this.setState({memberListStoreLoaded:u.Z.isLoaded()})}),void 0)])}componentDidMount(){this.fetchData()}componentDidUpdate(e){const{selection:t,widget:s,cursor:i}=this.props,[r]=e.widget.queries.reduce(((e,t)=>{let[s,i]=e,{name:r,...n}=t;return s.push(n),i.push(r),[s,i]}),[[],[]]),[n]=s.queries.reduce(((e,t)=>{let[s,i]=e,{name:r,...n}=t;return s.push(n),i.push(r),[s,i]}),[[],[]]);o()(s.displayType,e.widget.displayType)&&o()(s.interval,e.widget.interval)&&o()(n,r)&&(0,a.WO)(t,e.selection)&&i===e.cursor||this.fetchData()}componentWillUnmount(){this.unlisteners.forEach((e=>null==e?void 0:e()))}transformTableResults(e){const{selection:t,widget:s}=this.props;d.Z.add(e);const i=[];return e.forEach((e=>{let{id:r,shortId:n,title:o,lifetime:a,filtered:l,count:d,userCount:u,project:p,annotations:h,...v}=e;const f={};Object.keys(v).filter((e=>["number","string"].includes(typeof v[e]))).forEach((e=>{f[e]=v[e]}));const y={...f,events:d,users:u,id:r,"issue.id":r,issue:n,title:o,project:p.slug,links:null==h?void 0:h.join(", ")};a&&(y.lifetimeEvents=null==a?void 0:a.count,y.lifetimeUsers=null==a?void 0:a.userCount),l&&(y.filteredEvents=null==l?void 0:l.count,y.filteredUsers=null==l?void 0:l.userCount);const b=s.queries[0].conditions,w=[];if("string"==typeof b){const e=(0,g.w)(b);for(const t in e)if(!m.QL.includes(t)){const s=e[t].includes(" ")?`"${e[t]}"`:e[t];w.push(`${t}:${s}`)}e.__text&&w.push(e.__text)}y.discoverSearchQuery=(w.length?" ":"")+w.join(" "),y.projectId=p.id;const{period:x,start:Z,end:R}=t.datetime||{};Z&&R&&(y.start=(0,c.v5)(Z),y.end=(0,c.v5)(R)),y.period=null!=x?x:"",i.push(y)})),i}async fetchIssuesData(){const{selection:e,api:t,organization:s,widget:i,limit:r,cursor:n,onDataFetched:o}=this.props;this.setState({tableResults:[]});const a=i.queries[0],d=`/organizations/${s.slug}/issues/`,u={project:e.projects,environment:e.environments,query:a.conditions,sort:a.orderby||f,expand:y,limit:null!=r?r:h.$V,cursor:n};e.datetime.period&&(u.statsPeriod=e.datetime.period),e.datetime.end&&(u.end=(0,c.v5)(e.datetime.end)),e.datetime.start&&(u.start=(0,c.v5)(e.datetime.start)),e.datetime.utc&&(u.utc=e.datetime.utc);try{var p,g;const[e,s,i]=await t.requestPromise(d,{includeAllArgs:!0,method:"GET",data:{...u}}),r=this.transformTableResults(e),n=null!==(p=null==i?void 0:i.getResponseHeader("X-Hits"))&&void 0!==p?p:null,a=null!==(g=null==i?void 0:i.getResponseHeader("Link"))&&void 0!==g?g:null;this.setState({loading:!1,errorMessage:void 0,tableResults:r,totalCount:n,pageLinks:a}),null==o||o({issuesResults:r,totalIssuesCount:null!=n?n:void 0,pageLinks:null!=a?a:void 0})}catch(e){var m,v;const t=null!==(m=null==e||null===(v=e.responseJSON)||void 0===v?void 0:v.detail)&&void 0!==m?m:null;this.setState({loading:!1,errorMessage:null!=t?t:(0,l.t)("Unable to load Widget"),tableResults:[]})}}fetchData(){this.setState({loading:!0,errorMessage:void 0}),this.fetchIssuesData()}render(){const{children:e}=this.props,{tableResults:t,loading:s,errorMessage:i,memberListStoreLoaded:r,pageLinks:n,totalCount:o}=this.state;return(0,p.Z)({value:e({loading:s||!r,transformedResults:t,errorMessage:i,pageLinks:n,totalCount:null!=o?o:void 0}),fixed:(0,v.tZ)("div",{})})}}b.displayName="IssueWidgetQueries";const w=b},"./app/views/dashboardsV2/widgetCard/releaseWidgetQueries.tsx":(e,t,s)=>{s.d(t,{Z:()=>C,n:()=>F});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("../node_modules/lodash/cloneDeep.js"),o=s.n(n),a=s("../node_modules/lodash/isEqual.js"),l=s.n(a),d=s("../node_modules/lodash/omit.js"),u=s.n(d),c=s("../node_modules/lodash/trimStart.js"),p=s.n(c),g=s("./app/components/charts/utils.tsx"),m=s("./app/components/organizations/pageFilters/parse.tsx"),h=s("./app/utils.tsx"),v=s("./app/components/organizations/pageFilters/utils.tsx"),f=s("./app/locale.tsx"),y=s("./app/utils/discover/fields.tsx"),b=s("./app/utils/discover/types.tsx"),w=s("./app/views/dashboardsV2/types.tsx"),x=s("./app/views/dashboardsV2/utils.tsx"),Z=s("./app/views/dashboardsV2/widgetBuilder/releaseWidget/fields.tsx");function R(e,t,s){const i=Object.entries(t.by).map((e=>{let[t,s]=e;return`${s}`})).join(", ");return`${s?`${s} > `:""}${i?`${i} : ${F(e)}`:F(e)}`}function j(e,t,s,i){if(null===e)return[];const r=[];return e.groups.forEach((n=>{Object.keys(n.series).forEach((t=>{s.includes(F(t))||r.push({seriesName:R(t,n,i),data:e.intervals.map(((e,s)=>{var i;return{name:e,value:null!==(i=n.series[t][s])&&void 0!==i?i:0}}))})})),t.length&&(0,h.ri)(n.by["session.status"])&&t.forEach((t=>{const s=t.match(Z.$4);if(s){let o;n.by["session.status"]===s[1]&&("session"===s[2]?o="sum(session)":"user"===s[2]&&(o="count_unique(user)")),r.push({seriesName:R(t,n,i),data:e.intervals.map(((e,t)=>{var s;return{name:e,value:o&&null!==(s=n.series[o][t])&&void 0!==s?s:0}}))})}}))})),r}function _(e){const t={};for(const[s,i]of Object.entries(e))t[F(s)]=i;return t}function q(e,t,s){const i={};return s.length?(void 0===e["session.status"]||s.forEach((s=>{const r=s.match(Z.$4);r&&(e["session.status"]===r[1]?"session"===r[2]?i[s]=t["sum(session)"]:"user"===r[2]&&(i[s]=t["count_unique(user)"]):i[s]=0)})),i):i}function S(e){var t;return null!==(t=Z.wg[e])&&void 0!==t?t:e}function F(e){var t;return null!==(t=Z.Mg[e])&&void 0!==t?t:e}function E(e,t){const s=e.map(y.hr),i=s.filter((e=>Object.values(Z.Xg).includes(e))),r=[];return t?(i.forEach((e=>{const t=e.match(Z.$4);t&&("user"!==t[2]||s.includes("count_unique(user)")||(r.push("count_unique(user)"),s.push("count_unique(user)")),"session"!==t[2]||s.includes("sum(session)")||(r.push("sum(session)"),s.push("sum(session)")))})),{aggregates:s,derivedStatusFields:i,injectedFields:r}):{aggregates:s,derivedStatusFields:i,injectedFields:r}}class M extends r.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0}),(0,i.Z)(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,this.fetchData()}componentDidUpdate(e){const{loading:t,rawResults:s}=this.state,{selection:i,widget:r,organization:n,limit:o,cursor:a}=this.props,d=["queries","title","id","layout","tempId","widgetType"],c=["name","fields","aggregates","columns"],p=r.queries.map((e=>e.name)),g=e.widget.queries.map((e=>e.name));if(!(o===e.limit&&n.slug===e.organization.slug&&(0,v.WO)(i,e.selection)&&l()(u()(r,d),u()(e.widget,d))&&l()(r.queries.map((e=>u()(e,c))),e.widget.queries.map((e=>u()(e,c))))&&l()(r.queries.flatMap((e=>{var t;return null===(t=e.fields)||void 0===t?void 0:t.filter((e=>!!e))})),e.widget.queries.flatMap((e=>{var t;return null===(t=e.fields)||void 0===t?void 0:t.filter((e=>!!e))})))&&l()(r.queries.flatMap((e=>e.aggregates.filter((e=>!!e)))),e.widget.queries.flatMap((e=>e.aggregates.filter((e=>!!e)))))&&l()(r.queries.flatMap((e=>e.columns.filter((e=>!!e)))),e.widget.queries.flatMap((e=>e.columns.filter((e=>!!e)))))&&a===e.cursor))return void this.fetchData();const m=r.queries[0].columns.includes("session.status");if(!t&&!l()(p,g)&&(null==s?void 0:s.length)===r.queries.length){const{derivedStatusFields:e,injectedFields:t}=E(r.queries[0].aggregates,m);this.setState((s=>{var i;return{...s,timeseriesResults:null===(i=s.rawResults)||void 0===i?void 0:i.flatMap(((s,i)=>j(s,e,t,r.queries[i].name)))}}))}}componentWillUnmount(){this._isMounted=!1}get limit(){const{limit:e}=this.props;switch(this.props.widget.displayType){case w.FO.TOP_N:return b.hY;case w.FO.TABLE:return null!=e?e:w.$V;case w.FO.BIG_NUMBER:return 1;default:return null!=e?e:20}}fetchData(){const{selection:e,api:t,organization:s,widget:i,includeAllArgs:r,cursor:n,onDataFetched:a}=this.props;if(i.displayType===w.FO.WORLD_MAP)return void this.setState({errorMessage:(0,f.t)("World Map is not supported by metrics.")});const l=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,timeseriesResults:[],rawResults:[],tableResults:[],queryFetchID:l});const{environments:d,projects:c,datetime:v}=e,{start:b,end:R,period:F}=v,M=(0,x.s)(i,{start:b,end:R,period:F}),C=[],O=i.queries[0].columns.includes("session.status"),T=i.queries[0].orderby.startsWith("-"),k=p()(i.queries[0].orderby,"-"),D=Z.d2.includes(k)||O,{aggregates:P,derivedStatusFields:z,injectedFields:A}=E(i.queries[0].aggregates,O);i.queries.forEach((e=>{if(O){const i={field:P.filter((e=>!Object.values(Z.Xg).includes(e))),orgSlug:s.slug,end:R,environment:d,groupBy:e.columns,limit:void 0,orderBy:"",interval:M,project:c,query:e.conditions,start:b,statsPeriod:F,includeAllArgs:r,cursor:n};C.push(((e,t)=>{let{field:s,orgSlug:i,cursor:r,environment:n,groupBy:o,interval:a,project:l,orderBy:d,query:u,includeAllArgs:c=!1,statsPeriodStart:p,statsPeriodEnd:v,limit:f,...y}=t;const{start:b,end:w,statsPeriod:x}=(0,m.fK)(y,{allowEmptyPeriod:!0}),Z=Object.fromEntries(Object.entries({field:s.filter((e=>!!e)),cursor:r,end:w,environment:n,groupBy:null==o?void 0:o.filter((e=>!!e)),interval:a||(0,g.ZS)({start:b,end:w,period:x}),orderBy:d,per_page:f,query:u||void 0,project:l,start:b,statsPeriod:x,statsPeriodStart:p,statsPeriodEnd:v}).filter((e=>{let[,t]=e;return(0,h.ri)(t)&&""!==t})));return e.requestPromise(`/organizations/${i}/sessions/`,{includeAllArgs:c,query:Z})})(t,i))}else{const i={field:P.map(S),orgSlug:s.slug,end:R,environment:d,groupBy:e.columns.map(S),limit:D||""===k?void 0:this.limit,orderBy:D?"":T?`-${S(k)}`:S(k),interval:M,project:c,query:e.conditions,start:b,statsPeriod:F,includeAllArgs:r,cursor:n};C.push(((e,t)=>{let{field:s,orgSlug:i,cursor:r,environment:n,groupBy:o,interval:a,limit:l,orderBy:d,project:u,query:c,includeAllArgs:p=!1,statsPeriodStart:v,statsPeriodEnd:f,...y}=t;const{start:b,end:w,statsPeriod:x}=(0,m.fK)(y,{allowEmptyPeriod:!0}),Z=Object.fromEntries(Object.entries({field:s.filter((e=>!!e)),cursor:r,end:w,environment:n,groupBy:null==o?void 0:o.filter((e=>!!e)),interval:a||(0,g.ZS)({start:b,end:w,period:x}),query:c||void 0,per_page:l,project:u,orderBy:d,start:b,statsPeriod:x,statsPeriodStart:v,statsPeriodEnd:f}).filter((e=>{let[,t]=e;return(0,h.ri)(t)&&""!==t}))),R=`/organizations/${i}/metrics/data/`;return e.requestPromise(R,{includeAllArgs:p,query:Z})})(t,i))}}));let L=0;C.forEach((async(e,t)=>{try{const s=await e;let r,n;if(Array.isArray(s)?(r=s[0],n=s[2]):r=s,!this._isMounted)return;this.setState((e=>{var s,d,c,p,g,m,h;if(e.queryFetchID!==l)return e;const v=function(e,t,s){var i;const r=null!==(i=null==e?void 0:e.groups.map(((e,i)=>({id:String(i),..._(e.by),...u()(_(e.totals),s),...q(e.by,e.totals,t)}))))&&void 0!==i?i:[],n=r[0];var o;return{meta:{...(o=u()(n,"id"),Object.keys(null!=o?o:{}).reduce(((e,t)=>(e[t]=Z.ve.includes(t)?"string":(0,y.Px)(t),e)),{}))},data:r}}(r,z,A);v.title=null!==(s=null===(d=i.queries[t])||void 0===d?void 0:d.name)&&void 0!==s?s:"";const f=[...null!==(c=e.tableResults)&&void 0!==c?c:[],v],b=[...null!==(p=e.timeseriesResults)&&void 0!==p?p:[]],x=j(r,z,A,i.queries[t].name);var R,S;if(x.forEach(((e,s)=>{b[t*x.length+s]=e})),null==a||a({timeseriesResults:b,tableResults:f}),[w.FO.TABLE,w.FO.BIG_NUMBER].includes(i.displayType))return{...e,errorMessage:void 0,tableResults:f,pageLinks:null!==(R=null===(S=n)||void 0===S?void 0:S.getResponseHeader("link"))&&void 0!==R?R:void 0};const F=o()(null!==(g=e.rawResults)&&void 0!==g?g:[]);return F[t]=r,{...e,errorMessage:void 0,timeseriesResults:b,rawResults:F,pageLinks:null!==(m=null===(h=n)||void 0===h?void 0:h.getResponseHeader("link"))&&void 0!==m?m:void 0}}))}catch(e){var s;const t=(null==e||null===(s=e.responseJSON)||void 0===s?void 0:s.detail)||(0,f.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(L++,!this._isMounted)return;this.setState((e=>e.queryFetchID!==l?e:{...e,loading:L!==C.length}))}}))}render(){const{children:e}=this.props,{loading:t,timeseriesResults:s,tableResults:i,errorMessage:r,pageLinks:n}=this.state;return e({loading:t,timeseriesResults:s,tableResults:i,errorMessage:r,pageLinks:n})}}M.displayName="ReleaseWidgetQueries";const C=M},"./app/views/dashboardsV2/widgetCard/widgetCardChartContainer.tsx":(e,t,s)=>{s.d(t,{b:()=>q,Z:()=>S});var i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("../node_modules/react/index.js"),n=s("../node_modules/react-router/es/index.js"),o=s("./app/components/charts/transparentLoadingMask.tsx"),a=s("./app/components/loadingIndicator.tsx"),l=s("./app/views/dashboardsV2/types.tsx"),d=s("./app/views/dashboardsV2/widgetCard/chart.tsx"),u=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("./app/components/charts/errorPanel.tsx")),c=s("./app/components/charts/simpleTableChart.tsx"),p=s("./app/components/placeholder.tsx"),g=s("./app/icons/index.tsx"),m=s("./app/styles/space.tsx"),h=s("./app/utils.tsx"),v=s("./app/utils/dashboards/issueFieldRenderers.tsx"),f=s("./app/views/dashboardsV2/utils.tsx"),y=s("./app/views/dashboardsV2/widgetBuilder/issueWidget/fields.tsx"),b=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function w(e){var t;let{organization:s,selection:i,widget:r,errorMessage:n,loading:o,transformedResults:a,location:l}=e;if(n)return(0,b.tZ)(u.Z,{children:(0,b.tZ)(g.FC,{color:"gray500",size:"lg"})});if(o)return(0,b.tZ)(x,{height:"200px"});const d=r.queries[0],c=(0,h.ri)(d.fields)?d.fields:[...d.columns,...d.aggregates],p=null!==(t=d.fieldAliases)&&void 0!==t?t:[],m=(0,f.tT)(r.title,r.queries[0],i,r.displayType);return(0,b.tZ)(Z,{location:l,title:"",eventView:m,fields:c,fieldAliases:p,loading:o,metadata:y.$L,data:a,organization:s,getCustomFieldRenderer:v.O,fieldHeaderMap:y.kh,stickyHeaders:!0})}w.displayName="IssueWidgetCard";const x=(0,i.Z)(p.Z,{target:"e11eoa721"})("background-color:",(e=>e.theme.surface200),";"),Z=(0,i.Z)(c.Z,{target:"e11eoa720"})("margin-top:",(0,m.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;");var R=s("./app/views/dashboardsV2/widgetCard/issueWidgetQueries.tsx"),j=s("./app/views/dashboardsV2/widgetCard/releaseWidgetQueries.tsx"),_=s("./app/views/dashboardsV2/widgetCard/widgetQueries.tsx");function q(e){let{location:t,router:s,api:i,organization:n,selection:o,widget:a,isMobile:u,renderErrorMessage:c,tableItemLimit:p,windowWidth:g,onZoom:m,onLegendSelectChanged:h,legendOptions:v,expandNumbers:f,onDataFetched:y,showSlider:x,noPadding:Z,chartZoomOptions:q}=e;return a.widgetType===l.l9.ISSUE?(0,b.tZ)(R.Z,{api:i,organization:n,widget:a,selection:o,limit:p,onDataFetched:y,children:e=>{let{transformedResults:s,errorMessage:i,loading:l}=e;return(0,b.BX)(r.Fragment,{children:["function"==typeof c?c(i):null,(0,b.tZ)(E,{loading:l}),(0,b.tZ)(w,{transformedResults:s,loading:l,errorMessage:i,widget:a,organization:n,location:t,selection:o})]})}}):a.widgetType===l.l9.RELEASE?(0,b.tZ)(j.Z,{api:i,organization:n,widget:a,selection:o,limit:null!==(S=a.limit)&&void 0!==S?S:p,onDataFetched:y,children:e=>{let{tableResults:i,timeseriesResults:l,errorMessage:p,loading:h}=e;return(0,b.BX)(r.Fragment,{children:["function"==typeof c?c(p):null,(0,b.tZ)(d.Z,{timeseriesResults:l,tableResults:i,errorMessage:p,loading:h,location:t,widget:a,selection:o,router:s,organization:n,isMobile:u,windowWidth:g,expandNumbers:f,onZoom:m,showSlider:x,noPadding:Z,chartZoomOptions:q})]})}}):(0,b.tZ)(_.Z,{api:i,organization:n,widget:a,selection:o,limit:p,onDataFetched:y,children:e=>{let{tableResults:i,timeseriesResults:l,errorMessage:p,loading:y}=e;return(0,b.BX)(r.Fragment,{children:["function"==typeof c?c(p):null,(0,b.tZ)(d.Z,{timeseriesResults:l,tableResults:i,errorMessage:p,loading:y,location:t,widget:a,selection:o,router:s,organization:n,isMobile:u,windowWidth:g,onZoom:m,onLegendSelectChanged:h,legendOptions:v,expandNumbers:f,showSlider:x,noPadding:Z,chartZoomOptions:q})]})}});var S}q.displayName="WidgetCardChartContainer";const S=(0,n.withRouter)(q),F=(0,i.Z)((e=>(0,b.tZ)(o.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e14ay5ol0"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),E=e=>{let{loading:t}=e;return t?(0,b.tZ)(F,{visible:t,children:(0,b.tZ)(a.Z,{mini:!0})}):null};E.displayName="LoadingScreen"},"./app/views/dashboardsV2/widgetCard/widgetQueries.tsx":(e,t,s)=>{s.d(t,{Z:()=>S});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("../node_modules/lodash/cloneDeep.js"),o=s.n(n),a=s("../node_modules/lodash/isEqual.js"),l=s.n(a),d=s("../node_modules/lodash/omit.js"),u=s.n(d),c=s("../node_modules/lodash/trimStart.js"),p=s.n(c),g=s("./app/actionCreators/events.tsx"),m=s("./app/components/charts/utils.tsx"),h=s("./app/components/organizations/pageFilters/utils.tsx"),v=s("./app/locale.tsx"),f=s("./app/utils/discover/fields.tsx"),y=s("./app/utils/discover/genericDiscoverQuery.tsx"),b=s("./app/utils/discover/types.tsx"),w=s("./app/views/dashboardsV2/types.tsx"),x=s("./app/views/dashboardsV2/utils.tsx"),Z=s("./app/views/dashboardsV2/widgetCard/dashboardsMEPContext.tsx");function R(e,t){var s,i;return{seriesName:t,data:null!==(s=null==e||null===(i=e.data)||void 0===i?void 0:i.map((e=>{let[t,s]=e;return{name:1e3*t,value:s.reduce(((e,t)=>{let{count:s}=t;return e+s}),0)}})))&&void 0!==s?s:[]}}function j(e,t){const s=[];return Object.keys(e).forEach((i=>{Object.keys(u()(e[i],"order")).forEach((r=>{const n=`${i} : ${r}`,o=t?`${t} > ${n}`:n,a=e[i][r];s.push([e[i].order||0,R(a,o)])}))})),s}function _(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=[];const n=e.name;if((0,m.Xe)(t)){let o=[];const a=e.aggregates.length>1&&e.columns.length;o=i&&s!==w.FO.TOP_N&&a?j(t,n):Object.keys(t).map((e=>{const s=n?`${n} : ${e}`:e,i=t[e];return[i.order||0,R(i,s)]})),r=[...o.sort().map((e=>e[1]))]}else{const s=e.aggregates[0],i=R(t,n?`${n} : ${s}`:s);r.push(i)}return r}class q extends r.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0,pageLinks:void 0}),(0,i.Z)(this,"context",void 0),(0,i.Z)(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,this.fetchData()}componentDidUpdate(e){var t;const{selection:s,widget:i,cursor:r,organization:n}=this.props,o=n.features.includes("new-widget-builder-experience-design"),[a,d]=e.widget.queries.map((e=>(e.aggregates=e.aggregates.filter((e=>!!e)),e.columns=e.columns.filter((e=>!!e)),e))).reduce(((e,t)=>{let[s,i]=e,{name:r,...n}=t;return s.push(r),i.push(n),[s,i]}),[[],[]]),[u,c]=i.queries.map((e=>(e.aggregates=e.aggregates.filter((e=>!!e&&"equation|"!==e)),e.columns=e.columns.filter((e=>!!e&&"equation|"!==e)),e))).reduce(((e,t)=>{let[s,i]=e,{name:r,...n}=t;return s.push(r),i.push(n),[s,i]}),[[],[]]);i.limit===e.widget.limit&&l()(i.displayType,e.widget.displayType)&&l()(i.interval,e.widget.interval)&&l()(c,d)&&(0,h.WO)(s,e.selection)&&r===e.cursor?this.state.loading||l()(a,u)||(null===(t=this.state.rawResults)||void 0===t?void 0:t.length)!==i.queries.length||this.setState((e=>{const t=i.queries.reduce(((t,s,r)=>t.concat(_(s,e.rawResults[r],i.displayType,o))),[]);return{...e,timeseriesResults:t}})):this.fetchData()}componentWillUnmount(){this._isMounted=!1}get isMEPEnabled(){return this.props.organization.features.includes("dashboards-mep")}fetchEventData(e){const{selection:t,api:s,organization:i,widget:r,limit:n,cursor:o,onDataFetched:a}=this.props;let l=[];const d=r.queries.map((e=>{const a=(0,x.tT)(r.title,e,t);let l="";const d={per_page:null!=n?n:w.$V,cursor:o,...(0,x.Gl)(this.isMEPEnabled)};if(e.orderby&&(d.sort="string"==typeof e.orderby?[e.orderby]:e.orderby),"table"===r.displayType)l=`/organizations/${i.slug}/eventsv2/`,d.referrer="api.dashboards.tablewidget";else if("big_number"===r.displayType)l=`/organizations/${i.slug}/eventsv2/`,d.per_page=1,d.referrer="api.dashboards.bignumberwidget";else{if("world_map"!==r.displayType)throw Error("Expected widget displayType to be either big_number, table or world_map");l=`/organizations/${i.slug}/events-geo/`,delete d.per_page,d.referrer="api.dashboards.worldmapwidget"}return(0,y.AA)(s,l,{...a.generateQueryStringObject(),...d})}));let u,c=0;d.forEach((async(t,s)=>{try{var i,n,o;const[p,m,h]=await t;u=!1!==u&&(null===(i=p.meta)||void 0===i?void 0:i.isMetricsData);const v=p;if(v.title=null!==(n=null===(o=r.queries[s])||void 0===o?void 0:o.name)&&void 0!==n?n:"",l=[...l,v],!this._isMounted)return;const f=null==h?void 0:h.getResponseHeader("Link");null==a||a({tableResults:l,pageLinks:null!=f?f:void 0}),this.setState((t=>t.queryFetchID!==e?t:{...t,tableResults:l,pageLinks:f}))}catch(e){var p;const t=(null==e||null===(p=e.responseJSON)||void 0===p?void 0:p.detail)||(0,v.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{var g;if(c++,!this._isMounted)return;null===(g=this.context)||void 0===g||g.setIsMetricsData(u),this.setState((t=>t.queryFetchID!==e?t:{...t,loading:c!==d.length}))}}))}fetchTimeseriesData(e,t){const{selection:s,api:i,organization:r,widget:n,onDataFetched:a}=this.props,l=r.features.includes("new-widget-builder-experience-design");this.setState({timeseriesResults:[],rawResults:[]});const{environments:d,projects:u}=s,{start:c,end:h,period:y}=s.datetime,Z=(0,x.s)(n,{start:c,end:h,period:y}),R=n.queries.map((e=>{let s;var o;if("top_n"===n.displayType)s={organization:r,interval:Z,start:c,end:h,project:u,environment:d,period:y,query:e.conditions,yAxis:e.aggregates[e.aggregates.length-1],includePrevious:!1,referrer:`api.dashboards.widget.${t}-chart`,partial:!0,topEvents:b.hY,field:[...e.columns,...e.aggregates],queryExtras:(0,x.Gl)(this.isMEPEnabled)},e.orderby&&(s.orderby=e.orderby);else if(s={organization:r,interval:Z,start:c,end:h,project:u,environment:d,period:y,query:e.conditions,yAxis:e.aggregates,orderby:e.orderby,includePrevious:!1,referrer:`api.dashboards.widget.${t}-chart`,partial:!0,queryExtras:(0,x.Gl)(this.isMEPEnabled)},r.features.includes("new-widget-builder-experience-design")&&[w.FO.AREA,w.FO.BAR,w.FO.LINE].includes(t)&&0!==(null===(o=e.columns)||void 0===o?void 0:o.length)){var a;s.topEvents=null!==(a=n.limit)&&void 0!==a?a:b.hY,s.field=[...e.columns,...e.aggregates];const t=p()(e.orderby,"-");if(!e.orderby||(0,f.uI)(t)||s.field.includes(t)||s.field.push(t),s.excludeOther=1!==e.aggregates.length||1!==n.queries.length,(0,f.GO)(p()(e.orderby,"-"))){const t=(0,x.yd)(e.aggregates),i=e.orderby.startsWith("-")?"-":"";s.orderby=`${i}equation[${t}]`,s.field=[...e.columns,...e.aggregates,p()(e.orderby,"-")]}}return(0,g.lI)(i,s)}));let j,q=0;R.forEach((async(t,s)=>{try{const i=await t;if(!this._isMounted)return;j=!1!==j&&function(e){const t=Object.values(e).map((e=>{let{isMetricsData:t}=e;return t})).reduce(((e,t)=>!1!==e&&t),void 0);return(0,m.Xe)(e)?t:e.isMetricsData}(i),this.setState((t=>{var r,d;if(t.queryFetchID!==e)return t;const u=[...null!==(r=t.timeseriesResults)&&void 0!==r?r:[]],c=_(n.queries[s],i,n.displayType,l);c.forEach(((e,t)=>{u[s*c.length+t]=e}));const p=o()(null!==(d=t.rawResults)&&void 0!==d?d:[]);return p[s]=i,null==a||a({timeseriesResults:u}),{...t,timeseriesResults:u,rawResults:p}}))}catch(e){var i;const t=(null==e||null===(i=e.responseJSON)||void 0===i?void 0:i.detail)||(0,v.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{var r;if(q++,!this._isMounted)return;null===(r=this.context)||void 0===r||r.setIsMetricsData(j),this.setState((t=>t.queryFetchID!==e?t:{...t,loading:q!==R.length}))}}))}fetchData(){const{widget:e}=this.props,t=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,queryFetchID:t}),["table","world_map","big_number"].includes(e.displayType)?this.fetchEventData(t):this.fetchTimeseriesData(t,e.displayType)}render(){const{children:e}=this.props,{loading:t,timeseriesResults:s,tableResults:i,errorMessage:r,pageLinks:n}=this.state;return e({loading:t,timeseriesResults:null==s?void 0:s.filter((e=>!!e)),tableResults:i,errorMessage:r,pageLinks:n})}}q.displayName="WidgetQueries",(0,i.Z)(q,"contextType",Z.HH);const S=q}}]);
//# sourceMappingURL=../sourcemaps/app_components_modals_widgetViewerModal_utils_tsx-app_views_dashboardsV2_widgetCard_widgetCar-7a3063.d7e2c0c4407dcd4d6a12a189fca4c8d9.js.map