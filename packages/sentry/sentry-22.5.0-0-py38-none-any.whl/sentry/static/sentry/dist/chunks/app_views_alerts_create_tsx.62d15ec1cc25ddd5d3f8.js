"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_alerts_create_tsx"],{"./app/views/alerts/create.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>D});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.string.replace.js"),s("../node_modules/react/index.js")),o=s("./app/components/layouts/thirds.tsx"),n=s("./app/components/loadingIndicator.tsx"),l=s("./app/components/sentryDocumentTitle.tsx"),u=s("./app/locale.tsx"),p=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),d=s("./app/utils/discover/eventView.tsx"),c=s("./app/utils/guid.tsx"),m=s("./app/utils/teams.tsx"),g=s("./app/views/alerts/builder/builderBreadCrumbs.tsx"),h=s("./app/utils/analytics.tsx"),v=s("./app/views/alerts/incidentRules/constants.tsx"),I=s("./app/views/alerts/incidentRules/ruleForm/index.tsx"),w=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function y(e){var t;const{project:s,eventView:r,wizardTemplate:a,sessionId:i,userTeamIds:o,...n}=e,l=r?(0,v.H9)(r):a?(0,v.Q6)(a):(0,v.ep)(),u=new Set(s.teams.map((e=>{let{id:t}=e;return t}))),p=null!==(t=o.find((e=>u.has(e))))&&void 0!==t?t:null;return l.owner=p&&`team:${p}`,(0,w.tZ)(I.Z,{onSubmitSuccess:function(t){const{router:s,project:r}=e,{orgId:a}=e.params,i=t?t.id:void 0;h.oF.endTransaction({name:"saveAlertRule"}),s.push(i?{pathname:`/organizations/${a}/alerts/rules/details/${i}/`}:{pathname:`/organizations/${a}/alerts/rules/`,query:{project:r.id}})},rule:{...l,projects:[s.slug]},sessionId:i,project:s,userTeamIds:o,...n})}y.displayName="IncidentRulesCreate";const T=y;var j=s("../node_modules/lodash/pick.js"),x=s.n(j),Z=s("./app/views/asyncView.tsx");class b extends Z.Z{constructor(){super(...arguments),(0,r.Z)(this,"handleSubmitSuccess",(e=>{const{router:t,project:s,params:{orgId:r}}=this.props,a=e?e.id:void 0;t.push(a?{pathname:`/organizations/${r}/alerts/rules/details/${a}/`}:{pathname:`/organizations/${r}/alerts/rules/`,query:{project:s.id}})}))}getEndpoints(){const{params:{orgId:e},location:{query:t}}=this.props;return[["duplicateTargetRule",`/organizations/${e}/alert-rules/${t.duplicateRuleId}/`]]}renderBody(){const{project:e,sessionId:t,userTeamIds:s,...r}=this.props,{duplicateTargetRule:a}=this.state;return a?(0,w.tZ)(I.Z,{onSubmitSuccess:this.handleSubmitSuccess,rule:{...x()(a,v.bp),triggers:a.triggers.map((e=>({...x()(e,v.XU),actions:e.actions.map((e=>({inputChannelId:null,integrationId:void 0,options:null,sentryAppId:void 0,unsavedId:(0,c.E)(),unsavedDateCreated:(new Date).toISOString(),...x()(e,v.rQ)})))}))),name:a.name+" copy"},sessionId:t,project:e,userTeamIds:s,isDuplicateRule:!0,...r}):this.renderLoading()}}const z=b;var S=s("./app/views/alerts/issueRuleEditor/index.tsx"),R=s("./app/views/alerts/types.tsx"),C=s("./app/views/alerts/wizard/options.tsx"),_=s("./app/views/alerts/wizard/utils.tsx");class k extends i.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",this.getInitialState()),(0,r.Z)(this,"sessionId",(0,c.E)())}getInitialState(){var e;const{organization:t,location:s,project:r,params:a,router:i}=this.props,{createFromDiscover:o,createFromWizard:n,aggregate:l,dataset:u,eventTypes:p,createFromDuplicate:d}=null!==(e=null==s?void 0:s.query)&&void 0!==e?e:{};let c=R.ok.ISSUE;return t.features.includes("alert-wizard-v3")?(c=a.alertType||R.ok.METRIC,c!==R.ok.METRIC||l&&u&&p||d||i.replace({...s,pathname:`/organizations/${t.slug}/alerts/new/${c}`,query:{...s.query,...C.F4,project:r.slug}})):o?c=R.ok.METRIC:n?c=l&&u&&p?R.ok.METRIC:R.ok.ISSUE:i.replace(`/organizations/${t.slug}/alerts/${r.slug}/wizard`),{alertType:c}}componentDidMount(){const{organization:e,project:t}=this.props;(0,p.Z)("new_alert_rule.viewed",{organization:e,project_id:t.id,session_id:this.sessionId,alert_type:this.state.alertType,duplicate_rule:this.isDuplicateRule?"true":"false"})}get isDuplicateRule(){const{location:e,organization:t}=this.props,s="true"===(null==e?void 0:e.query.createFromDuplicate);return t.features.includes("duplicate-alert-rule")&&s&&(null==e?void 0:e.query.duplicateRuleId)}render(){var e;const{hasMetricAlerts:t,organization:s,project:r,location:a,routes:p}=this.props,{alertType:c}=this.state,{aggregate:h,dataset:v,eventTypes:I,createFromWizard:y,createFromDiscover:j}=null!==(e=null==a?void 0:a.query)&&void 0!==e?e:{},x={aggregate:null!=h?h:C.F4.aggregate,dataset:null!=v?v:C.F4.dataset,eventTypes:null!=I?I:C.F4.eventTypes},Z=j?d.ZP.fromLocation(a):void 0;let b;y&&c===R.ok.METRIC&&(b=x?(0,_.k)(x):"issues");const k=(0,u.t)("New Alert Rule");return(0,w.BX)(i.Fragment,{children:[(0,w.tZ)(l.Z,{title:k,projectSlug:r.slug}),(0,w.tZ)(o.h4,{children:(0,w.BX)(F,{children:[(0,w.tZ)(g.Z,{organization:s,alertName:(0,u.t)("Set Conditions"),title:b?(0,u.t)("Select Alert"):k,projectSlug:r.slug,alertType:c,routes:p,location:a,canChangeProject:!0}),(0,w.tZ)(o.Dx,{children:b?`${(0,u.t)("Set Conditions for")} ${C.gb[b]}`:k})]})}),(0,w.tZ)(o.uT,{children:(0,w.tZ)($,{fullWidth:!0,children:(0,w.tZ)(m.Z,{provideUserTeams:!0,children:e=>{let{teams:s,initiallyLoaded:a}=e;return a?(0,w.BX)(i.Fragment,{children:[(!t||"issue"===c)&&(0,w.tZ)(S.Z,{...this.props,project:r,userTeamIds:s.map((e=>{let{id:t}=e;return t}))}),t&&c===R.ok.METRIC&&(this.isDuplicateRule?(0,w.tZ)(z,{...this.props,eventView:Z,wizardTemplate:x,sessionId:this.sessionId,project:r,userTeamIds:s.map((e=>{let{id:t}=e;return t}))}):(0,w.tZ)(T,{...this.props,eventView:Z,wizardTemplate:x,sessionId:this.sessionId,project:r,userTeamIds:s.map((e=>{let{id:t}=e;return t}))}))]}):(0,w.tZ)(n.Z,{})}})})})]})}}k.displayName="Create";const $=(0,a.Z)(o.or,{target:"ew02uqt1"})({name:"1rxb0gn",styles:"max-width:1000px"}),F=(0,a.Z)(o.oB,{target:"ew02uqt0"})({name:"1h8nup8",styles:"overflow:visible"}),D=k}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_create_tsx.15b65435a360e87ae2b075a94798cddc.js.map