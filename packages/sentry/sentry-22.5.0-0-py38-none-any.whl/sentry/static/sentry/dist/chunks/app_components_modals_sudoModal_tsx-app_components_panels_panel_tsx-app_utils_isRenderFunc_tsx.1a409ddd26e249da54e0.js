"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_modals_sudoModal_tsx-app_components_panels_panel_tsx-app_utils_isRenderFunc_tsx","U2fSign"],{"./app/actionCreators/account.tsx":(e,t,s)=>{s.d(t,{C6:()=>a,Nq:()=>i,kS:()=>d,Hb:()=>l});var n=s("./app/actionCreators/indicator.tsx"),r=s("./app/api.tsx"),o=s("./app/stores/configStore.tsx");async function a(e,t){const s=new r.KU;try{await s.requestPromise(`/users/me/user-identities/${e.category}/${e.id}/`,{method:"DELETE"})}catch{return void(0,n.Iw)("Error disconnecting identity")}(0,n.S9)(`Disconnected ${e.provider.name}`),t()}function i(e){o.Z.get("user").options.theme!==e.options.theme&&"system"!==e.options.theme&&o.Z.set("theme",e.options.theme),o.Z.set("user",e)}function d(e){return e.requestPromise("/auth/",{method:"DELETE"})}function l(e,t,s){return e.requestPromise(`/users/${t}/authenticators/${s}/`,{method:"DELETE"})}},"./app/components/hook.tsx":(e,t,s)=>{s.d(t,{Z:()=>d});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),o=s("./app/stores/hookStore.tsx"),a=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e){let{name:t,...s}=e;class i extends r.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{hooks:o.Z.get(t).map((e=>e(s)))}),(0,n.Z)(this,"unsubscribe",o.Z.listen(((e,t)=>this.handleHooks(e,t)),void 0))}componentWillUnmount(){this.unsubscribe()}handleHooks(e,n){e===t&&this.setState({hooks:n.map((e=>e(s)))})}render(){const{children:e}=s;return this.state.hooks&&this.state.hooks.length?"function"==typeof e?e({hooks:this.state.hooks}):this.state.hooks:null}}return i.displayName="HookComponent",(0,n.Z)(i,"displayName",`Hook(${t})`),(0,a.tZ)(i,{})}i.displayName="Hook";const d=i},"./app/components/modals/sudoModal.tsx":(e,t,s)=>{s.r(t),s.d(t,{SudoModal:()=>x,default:()=>E});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.string.replace.js"),s("../node_modules/react/index.js")),a=s("../node_modules/react-router/es/index.js"),i=s("./app/actionCreators/account.tsx"),d=s("./app/components/alert.tsx"),l=s("./app/components/button.tsx"),p=s("./app/components/forms/form.tsx"),u=s("./app/components/forms/inputField.tsx"),c=s("./app/components/hook.tsx"),h=s("./app/components/u2f/u2fsign.tsx"),m=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function g(e){let{className:t,authenticators:s,...n}=e;return s.length?(0,m.tZ)("div",{className:t,children:s.map((e=>"u2f"===e.id&&e.challenge?(0,m.tZ)(h.default,{...n,challengeData:e.challenge},e.id):null))}):null}g.displayName="U2fContainer";const y=g;var f=s("./app/constants/superuserAccessErrors.tsx"),b=s("./app/locale.tsx"),S=s("./app/stores/configStore.tsx"),w=s("./app/styles/space.tsx"),v=s("./app/utils/withApi.tsx"),Z=s("./app/views/settings/components/text/textBlock.tsx");class x extends o.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{error:!1,errorType:"",busy:!1,superuserAccessCategory:"",superuserReason:"",authenticators:[]}),(0,n.Z)(this,"handleSubmit",(async()=>{const{api:e,isSuperuser:t}=this.props,s={isSuperuserModal:t,superuserAccessCategory:"cops_csm",superuserReason:"COPS and CSM use"};try{await e.requestPromise("/auth/",{method:"PUT",data:s}),this.handleSuccess()}catch(e){this.handleError(e)}})),(0,n.Z)(this,"handleSuccess",(()=>{const{closeModal:e,isSuperuser:t,location:s,needsReload:n,router:r,retryRequest:o}=this.props;if(o)return t?(r.replace({pathname:s.pathname,state:{forceUpdate:new Date}}),void(n&&window.location.reload())):void this.setState({busy:!0},(()=>{o().then((()=>{this.setState({busy:!1},e)}))}));e()})),(0,n.Z)(this,"handleError",(e=>{let t="";t=403===e.status?f.S.invalidPassword:401===e.status?f.S.invalidSSOSession:400===e.status?f.S.invalidAccessCategory:f.S.unknownError,this.setState({busy:!1,error:!0,errorType:t})})),(0,n.Z)(this,"handleU2fTap",(async e=>{this.setState({busy:!0});const{api:t,isSuperuser:s}=this.props;try{e.isSuperuserModal=s,e.superuserAccessCategory=this.state.superuserAccessCategory,e.superuserReason=this.state.superuserReason,await t.requestPromise("/auth/",{method:"PUT",data:e}),this.handleSuccess()}catch(e){throw this.setState({busy:!1}),e}})),(0,n.Z)(this,"handleLogout",(async()=>{const{api:e}=this.props;try{await(0,i.kS)(e)}catch{}window.location.assign(`/auth/login/?next=${encodeURIComponent(location.pathname)}`)}))}componentDidMount(){this.getAuthenticators()}async getAuthenticators(){const{api:e}=this.props;try{const t=await e.requestPromise("/authenticators/");this.setState({authenticators:null!=t?t:[]})}catch{}}renderBodyContent(){const{isSuperuser:e}=this.props,{authenticators:t,error:s,errorType:n}=this.state,r=S.Z.get("user"),a=S.Z.get("isSelfHosted");return n===f.S.invalidSSOSession?(this.handleLogout(),null):!r.hasPasswordAuth&&0===t.length||e&&!a?(0,m.BX)(o.Fragment,{children:[(0,m.tZ)(C,{children:e?(0,b.t)("You are attempting to access a resource that requires superuser access, please re-authenticate as a superuser."):(0,b.t)("You will need to reauthenticate to continue")}),s&&(0,m.tZ)(A,{type:"error",showIcon:!0,children:(0,b.t)(n)}),e?(0,m.tZ)(p.Z,{apiMethod:"PUT",apiEndpoint:"/auth/",submitLabel:(0,b.t)("Re-authenticate"),onSubmitSuccess:this.handleSuccess,onSubmitError:this.handleError,initialData:{isSuperuserModal:e},extraButton:(0,m.tZ)(j,{children:(0,m.tZ)(l.ZP,{onClick:this.handleSubmit,children:(0,b.t)("COPS/CSM")})}),resetOnError:!0,children:!a&&(0,m.tZ)(c.Z,{name:"component:superuser-access-category"})}):(0,m.tZ)(l.ZP,{priority:"primary",href:`/auth/login/?next=${encodeURIComponent(location.pathname)}`,children:(0,b.t)("Continue")})]}):(0,m.BX)(o.Fragment,{children:[(0,m.tZ)(C,{children:e?(0,b.t)("You are attempting to access a resource that requires superuser access, please re-authenticate as a superuser."):(0,b.t)("Help us keep your account safe by confirming your identity.")}),s&&(0,m.tZ)(A,{type:"error",showIcon:!0,children:(0,b.t)(n)}),(0,m.BX)(p.Z,{apiMethod:"PUT",apiEndpoint:"/auth/",submitLabel:(0,b.t)("Confirm Password"),onSubmitSuccess:this.handleSuccess,onSubmitError:this.handleError,hideFooter:!r.hasPasswordAuth&&0===t.length,initialData:{isSuperuserModal:e},resetOnError:!0,children:[r.hasPasswordAuth&&(0,m.tZ)(_,{type:"password",inline:!1,label:(0,b.t)("Password"),name:"password",autoFocus:!0,flexibleControlStateSize:!0}),(0,m.tZ)(y,{authenticators:t,displayMode:"sudo",onTap:this.handleU2fTap})]})]})}render(){const{Header:e,Body:t}=this.props;return(0,m.BX)(o.Fragment,{children:[(0,m.tZ)(e,{closeButton:!0,children:(0,b.t)("Confirm Password to Continue")}),(0,m.tZ)(t,{children:this.renderBodyContent()})]})}}x.displayName="SudoModal";const E=(0,a.withRouter)((0,v.Z)(x)),C=(0,r.Z)(Z.Z,{target:"egngqnr3"})("margin-bottom:",(0,w.Z)(1),";"),_=(0,r.Z)(u.Z,{target:"egngqnr2"})({name:"1408f10",styles:"padding-left:0"}),A=(0,r.Z)(d.Z,{target:"egngqnr1"})({name:"1ykowef",styles:"margin-bottom:0"}),j=(0,r.Z)("div",{target:"egngqnr0"})("width:100%;margin-left:",(0,w.Z)(4),";")},"./app/components/panels/panel.tsx":(e,t,s)=>{s.d(t,{Z:()=>o});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("./app/styles/space.tsx");const o=(0,n.Z)("div",{target:"edxrl2k0"})("background:",(e=>e.dashedBorder?e.theme.backgroundSecondary:e.theme.background),";border-radius:",(e=>e.theme.borderRadius),";border:1px ",(e=>e.dashedBorder?"dashed"+e.theme.gray300:"solid "+e.theme.border),";box-shadow:",(e=>e.dashedBorder?"none":e.theme.dropShadowLight),";margin-bottom:",(0,r.Z)(2),";position:relative;")},"./app/components/u2f/u2fsign.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/react/index.js"),o=s("./app/locale.tsx"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/@sentry/minimal/esm/index.js")),i=s("../node_modules/cbor-web/dist/cbor.js");function d(e){const t="==".slice(0,(4-e.length%4)%4),s=e.replace(/-/g,"+").replace(/_/g,"/")+t,n=atob(s),r=new ArrayBuffer(n.length),o=new Uint8Array(r);for(let e=0;e<n.length;e++)o[e]=n.charCodeAt(e);return r}function l(e){const t=new Uint8Array(e);let s="";for(const e of t)s+=String.fromCharCode(e);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}s("../node_modules/core-js/modules/es.string.replace.js"),s("../node_modules/core-js/modules/es.typed-array.uint8-array.js"),s("../node_modules/core-js/modules/esnext.typed-array.at.js"),s("../node_modules/core-js/modules/es.typed-array.set.js"),s("../node_modules/core-js/modules/es.typed-array.sort.js");var p=s("./app/stores/configStore.tsx"),u=s("./app/utils/withOrganization.tsx"),c=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h extends r.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isSupported:null,formElement:null,challengeElement:null,hasBeenTapped:!1,deviceFailure:null,responseElement:null,isSafari:!1,failCount:0}),(0,n.Z)(this,"onTryAgain",(()=>{this.setState({hasBeenTapped:!1,deviceFailure:null},(()=>{this.invokeU2fFlow()}))})),(0,n.Z)(this,"bindChallengeElement",(e=>{this.setState({challengeElement:e,formElement:e&&e.form}),e&&(e.value=JSON.stringify(this.props.challengeData))})),(0,n.Z)(this,"bindResponseElement",(e=>this.setState({responseElement:e}))),(0,n.Z)(this,"renderSafariWebAuthn",(()=>(0,c.tZ)("a",{onClick:this.onTryAgain,className:"btn btn-primary",children:"enroll"===this.props.flowMode?(0,o.t)("Enroll with WebAuthn"):(0,o.t)("Sign in with WebAuthn")}))),(0,n.Z)(this,"renderFailure",(()=>{const{deviceFailure:e}=this.state,t=p.Z.get("supportEmail"),s=t?(0,c.tZ)("a",{href:"mailto:"+t,children:t}):(0,c.tZ)("span",{children:(0,o.t)("Support")});return this.state.isSafari&&0===this.state.failCount?this.renderSafariWebAuthn():(0,c.BX)("div",{className:"failure-message",children:[(0,c.BX)("div",{children:[(0,c.tZ)("strong",{children:(0,o.t)("Error: ")})," ",{UNKNOWN_ERROR:(0,o.t)("There was an unknown problem, please try again"),DEVICE_ERROR:(0,o.t)("Your U2F device reported an error."),DUPLICATE_DEVICE:(0,o.t)("This device is already registered with Sentry."),UNKNOWN_DEVICE:(0,o.t)("The device you used for sign-in is unknown."),BAD_APPID:(0,o._N)("[p1:The Sentry server administrator modified the device registrations.][p2:You need to remove and re-add the device to continue using your U2F device. Use a different sign-in method or contact [support] for assistance.]",{p1:(0,c.tZ)("p",{}),p2:(0,c.tZ)("p",{}),support:s})}[e||""]]}),this.canTryAgain&&(0,c.tZ)("div",{style:{marginTop:18},children:(0,c.tZ)("a",{onClick:this.onTryAgain,className:"btn btn-primary",children:(0,o.t)("Try Again")})})]})}))}async componentDidMount(){const e=!!window.PublicKeyCredential;this.setState({isSupported:e});const t=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome");t&&this.setState({deviceFailure:"safari: requires interaction",isSafari:t,hasBeenTapped:!1}),e&&!t&&this.invokeU2fFlow()}getU2FResponse(e){if(!e.response)return JSON.stringify(e);if("sign"===this.props.flowMode){const t={keyHandle:e.id,clientData:l(e.response.clientDataJSON),signatureData:l(e.response.signature),authenticatorData:l(e.response.authenticatorData)};return JSON.stringify(t)}if("enroll"===this.props.flowMode){const t={id:e.id,rawId:l(e.rawId),response:{attestationObject:l(e.response.attestationObject),clientDataJSON:l(e.response.clientDataJSON)},type:l(e.type)};return JSON.stringify(t)}throw new Error(`Unsupported flow mode '${this.props.flowMode}'`)}submitU2fResponse(e){e.then((e=>{this.setState({hasBeenTapped:!0},(()=>{const t=this.getU2FResponse(e),s=JSON.stringify(this.props.challengeData);var n;this.state.responseElement&&(this.state.responseElement.value=t),this.props.onTap?this.props.onTap({response:t,challenge:s}).catch((()=>{this.setState({deviceFailure:"UNKNOWN_ERROR",hasBeenTapped:!1})})):null===(n=this.state.formElement)||void 0===n||n.submit()}))})).catch((e=>{let t="DEVICE_ERROR";e.metaData&&("DEVICE_INELIGIBLE"===e.metaData.type?t="enroll"===this.props.flowMode?"DUPLICATE_DEVICE":"UNKNOWN_DEVICE":"BAD_REQUEST"===e.metaData.type&&(t="BAD_APPID")),a.Tb(e),this.setState({deviceFailure:t,hasBeenTapped:!1,failCount:this.state.failCount+1})}))}webAuthnSignIn(e){const t=navigator.credentials.get({publicKey:e});this.submitU2fResponse(t)}webAuthnRegister(e){const t=navigator.credentials.create({publicKey:e});this.submitU2fResponse(t)}invokeU2fFlow(){if("sign"===this.props.flowMode){const e=d(this.props.challengeData.webAuthnAuthenticationData);i.decodeFirst(e).then((e=>{this.webAuthnSignIn(e)})).catch((e=>{a.Tb(e),this.setState({deviceFailure:"DEVICE_ERROR",hasBeenTapped:!1})}))}else{if("enroll"!==this.props.flowMode)throw new Error(`Unsupported flow mode '${this.props.flowMode}'`);{const e=d(this.props.challengeData.webAuthnRegisterData);i.decodeFirst(e).then((e=>{this.webAuthnRegister(e.publicKey)})).catch((e=>{a.Tb(e),this.setState({deviceFailure:"DEVICE_ERROR",hasBeenTapped:!1})}))}}}renderUnsupported(){return this.props.silentIfUnsupported?null:(0,c.tZ)("div",{className:"u2f-box",children:(0,c.tZ)("div",{className:"inner",children:(0,c.tZ)("p",{className:"error",children:(0,o.t)("\n             Unfortunately your browser does not support U2F. You need to use\n             a different two-factor method or switch to a browser that supports\n             it (Google Chrome or Microsoft Edge).")})})})}get canTryAgain(){return"BAD_APPID"!==this.state.deviceFailure}renderBody(){return this.state.deviceFailure?this.renderFailure():this.props.children}renderPrompt(){const{style:e}=this.props;return(0,c.BX)("div",{style:e,className:"u2f-box"+(this.state.hasBeenTapped?" tapped":"")+(this.state.deviceFailure?0===this.state.failCount&&this.state.isSafari?" loading-dots":" device-failure":""),children:[(0,c.BX)("div",{className:"device-animation-frame",children:[(0,c.tZ)("div",{className:"device-failed"}),(0,c.tZ)("div",{className:"device-animation"}),(0,c.BX)("div",{className:"loading-dots",children:[(0,c.tZ)("span",{className:"dot"}),(0,c.tZ)("span",{className:"dot"}),(0,c.tZ)("span",{className:"dot"})]})]}),(0,c.tZ)("input",{type:"hidden",name:"challenge",ref:this.bindChallengeElement}),(0,c.tZ)("input",{type:"hidden",name:"response",ref:this.bindResponseElement}),(0,c.tZ)("div",{className:"inner",children:this.renderBody()})]})}render(){const{isSupported:e}=this.state;return null===e?null:e?this.renderPrompt():this.renderUnsupported()}}h.displayName="U2fInterface";const m=(0,u.Z)(h),g={signin:(0,o.t)("Insert your U2F device or tap the button on it to confirm the sign-in request."),sudo:(0,o.t)("Alternatively you can use your U2F device to confirm the action."),enroll:(0,o.t)("To enroll your U2F device insert it now or tap the button on it to activate it.")};class y extends r.Component{render(){const{displayMode:e,...t}=this.props,s="enroll"===e?"enroll":"sign";return(0,c.tZ)(m,{...t,silentIfUnsupported:"sudo"===e,flowMode:s,children:(0,c.tZ)("p",{children:g[e]||null})})}}y.displayName="U2fSign",(0,n.Z)(y,"defaultProps",{displayMode:"signin"});const f=y},"./app/constants/superuserAccessErrors.tsx":(e,t,s)=>{let n;s.d(t,{S:()=>n}),function(e){e.invalidPassword="Incorrect password",e.invalidSSOSession="Your SSO Session has expired, please reauthenticate",e.invalidAccessCategory="Please fill out the access category and reason correctly",e.unknownError="An error ocurred, please try again"}(n||(n={}))},"./app/sentryTypes.tsx":(e,t,s)=>{s.d(t,{Z:()=>l});var n=s("../node_modules/prop-types/index.js");const r=n.shape({avatarType:n.oneOf(["letter_avatar","upload","gravatar"]),avatarUuid:n.string}),o=n.shape({avatar:r,avatarUrl:n.string,dateJoined:n.string,email:n.string,emails:n.arrayOf(n.shape({is_verified:n.bool,id:n.string,email:n.string})),has2fa:n.bool,hasPasswordAuth:n.bool,id:n.string,identities:n.array,isActive:n.bool,isManaged:n.bool,lastActive:n.string,lastLogin:n.string,username:n.string}),a=n.shape({id:n.string.isRequired,annotations:n.array,assignedTo:o,count:n.string,culprit:n.string,firstSeen:n.string,hasSeen:n.bool,isBookmarked:n.bool,isPublic:n.bool,isSubscribed:n.bool,lastSeen:n.string,level:n.string,logger:n.string,metadata:n.shape({value:n.string,message:n.string,directive:n.string,type:n.string,title:n.string,uri:n.string}),numComments:n.number,permalink:n.string,project:n.shape({name:n.string,slug:n.string}),shareId:n.string,shortId:n.string,status:n.string,statusDetails:n.object,title:n.string,type:n.oneOf(["error","csp","hpkp","expectct","expectstaple","default","transaction"]),userCount:n.number}),i=n.shape({id:n.string.isRequired,slug:n.string.isRequired}),d=n.shape({id:n.oneOfType([n.string,n.number]).isRequired,slug:n.string.isRequired,teams:n.arrayOf(i),name:n.string,isBookmarked:n.bool,status:n.string}),l={Group:a,Organization:n.shape({id:n.string.isRequired}),Project:d}},"./app/utils/getDisplayName.tsx":(e,t,s)=>{function n(e){return e.displayName||e.name||"Component"}s.d(t,{Z:()=>n})},"./app/utils/isRenderFunc.tsx":(e,t,s)=>{function n(e){return"function"==typeof e}s.d(t,{l:()=>n})},"./app/utils/useApi.tsx":(e,t,s)=>{s.d(t,{Z:()=>o});var n=s("../node_modules/react/index.js"),r=s("./app/api.tsx");const o=function(){let{persistInFlight:e,api:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=(0,n.useRef)();void 0===s.current&&void 0===t&&(s.current=new r.KU);const o=null!=t?t:s.current,a=(0,n.useCallback)((()=>{e||o.clear()}),[o,e]);return(0,n.useEffect)((()=>a),[a]),o}},"./app/utils/withApi.tsx":(e,t,s)=>{s.d(t,{Z:()=>a});var n=s("./app/utils/getDisplayName.tsx"),r=s("./app/utils/useApi.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=s=>{let{api:n,...a}=s;const i=(0,r.Z)({api:n,...t});return(0,o.tZ)(e,{...a,api:i})};return s.displayName=`withApi(${(0,n.Z)(e)})`,s}},"./app/utils/withOrganization.tsx":(e,t,s)=>{s.d(t,{Z:()=>d});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/react/index.js"),o=s("./app/sentryTypes.tsx"),a=s("./app/utils/getDisplayName.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const d=e=>{var t;return t=class extends r.Component{render(){const{organization:t,...s}=this.props;return(0,i.tZ)(e,{organization:null!=t?t:this.context.organization,...s})}},(0,n.Z)(t,"displayName",`withOrganization(${(0,a.Z)(e)})`),(0,n.Z)(t,"contextTypes",{organization:o.Z.Organization}),t}},"./app/views/settings/components/text/textBlock.tsx":(e,t,s)=>{s.d(t,{Z:()=>o});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("./app/styles/space.tsx");const o=(0,n.Z)("div",{target:"ezm48a60"})("line-height:1.5;",(e=>e.noMargin?"":"margin-bottom:"+(0,r.Z)(3)),";")}}]);
//# sourceMappingURL=../sourcemaps/app_components_modals_sudoModal_tsx-app_components_panels_panel_tsx-app_utils_isRenderFunc_tsx.af7c4f27fe101484b5d105d7025b767b.js.map