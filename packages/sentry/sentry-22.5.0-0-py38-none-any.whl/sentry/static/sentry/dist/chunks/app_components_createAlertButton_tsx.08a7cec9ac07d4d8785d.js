"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_createAlertButton_tsx"],{"./app/components/createAlertButton.tsx":(e,t,r)=>{r.d(t,{K:()=>x,Z:()=>A});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/react/index.js")),a=r("../node_modules/react-router/es/index.js"),s=r("./app/actionCreators/indicator.tsx"),i=r("./app/actionCreators/navigation.tsx"),l=r("./app/components/acl/access.tsx"),c=r("./app/components/alert.tsx"),u=r("./app/components/assistant/guideAnchor.tsx"),d=r("./app/components/button.tsx"),p=r("./app/components/links/link.tsx"),g=r("./app/icons/index.tsx"),m=r("./app/locale.tsx"),y=r("./app/utils/discover/fields.tsx"),v=r("./app/utils/useApi.tsx"),h=r("./app/views/alerts/incidentRules/constants.tsx"),f=r("./app/views/alerts/utils/index.tsx"),b=r("./app/views/alerts/wizard/options.tsx"),j=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function Z(e){let{incompatibleQuery:t,eventView:r,orgId:n,onClose:a}=e;const{hasProjectError:s,hasEnvironmentError:i,hasEventTypeError:l,hasYAxisError:c}=t,u=Object.values(t).filter((e=>e)).length,y=r.clone();y.query+=" event.type:error";const v=r.clone();v.query+=" event.type:transaction";const h=r.clone();h.query+=" event.type:default";const f=r.clone();f.query+=" event.type:error or event.type:default";const b=`/organizations/${n}/discover/results/`,Z={error:(0,j.tZ)(p.Z,{to:{pathname:b,query:y.generateQueryStringObject()}}),default:(0,j.tZ)(p.Z,{to:{pathname:b,query:h.generateQueryStringObject()}}),transaction:(0,j.tZ)(p.Z,{to:{pathname:b,query:v.generateQueryStringObject()}}),errorDefault:(0,j.tZ)(p.Z,{to:{pathname:b,query:f.generateQueryStringObject()}})};return(0,j.BX)(z,{type:"warning",showIcon:!0,trailingItems:(0,j.tZ)(d.ZP,{icon:(0,j.tZ)(g.bM,{size:"sm"}),"aria-label":(0,m.t)("Close"),size:"zero",onClick:a,borderless:!0}),children:[1===u&&(0,j.BX)(o.Fragment,{children:[s&&(0,m.t)("An alert can use data from only one Project. Select one and try again."),i&&(0,m.t)("An alert supports data from a single Environment or All Environments. Pick one try again."),l&&(0,m._N)("An alert needs a filter of [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)]. Use one of these and try again.",Z),c&&(0,m._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,j.tZ)(_,{children:r.getYAxis()})})]}),u>1&&(0,j.BX)(o.Fragment,{children:[(0,m.t)("Yikes! That button didn’t work. Please fix the following problems:"),(0,j.BX)(k,{children:[s&&(0,j.tZ)("li",{children:(0,m.t)("Select one Project.")}),i&&(0,j.tZ)("li",{children:(0,m.t)("Select a single Environment or All Environments.")}),l&&(0,j.tZ)("li",{children:(0,m._N)("Use the filter [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)].",Z)}),c&&(0,j.tZ)("li",{children:(0,m._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,j.tZ)(_,{children:r.getYAxis()})})})]})]})]})}function x(e){var t;let{projects:r,eventView:n,organization:o,referrer:a,onIncompatibleQuery:s,onSuccess:i,useAlertWizardV3:l,alertType:c,...u}=e;const d=1!==n.project.length||-1===n.project[0],p=n.environment.length>1,g=null===(0,f.A4)(n.query),v=function(e){var t;const r=(0,y.nr)(e.getYAxis());if("field"===r.kind||"equation"===r.kind||"calculatedField"===r.kind)return!0;const n=e.query.match(/event\.type:(transaction|error)/);if(!n)return!1;const o="error"===n[1]?h.yq:h.Yp,a=!o.aggregations.includes(r.function[0]),s=y.lx[r.function[0]];if(!s)return!1;const i=s.parameters.some((e=>"value"===e.kind&&"number"===e.dataType)),l=["",...o.fields,...null!==(t=o.measurementKeys)&&void 0!==t?t:[]],c=!i&&!l.includes(r.function[1]);return a||c}(n),x={hasProjectError:d,hasEnvironmentError:p,hasEventTypeError:g,hasYAxisError:v},A=r.find((e=>e.id===`${n.project[0]}`)),z=n.generateQueryStringObject();null!==(t=z.query)&&void 0!==t&&t.includes(`project:${null==A?void 0:A.slug}`)&&(z.query=z.query.replace(`project:${null==A?void 0:A.slug}`,""));const k=Object.values(x).some((e=>e)),_=k?void 0:{pathname:l?`/organizations/${o.slug}/alerts/new/metric/`:`/organizations/${o.slug}/alerts/${null==A?void 0:A.slug}/new/`,query:{...z,createFromDiscover:!0,referrer:a,...l?{project:null==A?void 0:A.slug,...c?b.FZ[c]:b.F4}:{}}};return(0,j.tZ)(w,{organization:o,onClick:e=>{if(k)return e.preventDefault(),void s((e=>(0,j.tZ)(Z,{incompatibleQuery:x,eventView:n,orgId:o.slug,onClose:e})),x);i()},to:_,"aria-label":(0,m.t)("Create Alert"),...u})}Z.displayName="IncompatibleQueryAlert",x.displayName="CreateAlertFromViewButton";const w=(0,a.withRouter)((e=>{let{organization:t,projectSlug:r,iconProps:n,referrer:o,router:a,hideIcon:c,showPermissionGuide:y,...h}=e;const f=(0,v.Z)(),b=e=>{const r=t.features.includes("alert-wizard-v3"),n=r?`/organizations/${t.slug}/alerts`:`/organizations/${t.slug}/alerts/${e}`,a=[o?`referrer=${o}`:"",r&&e&&":projectId"!==e?`project=${e}`:""].filter((e=>""!==e));return`${n}/wizard/${a.length?"?":""}${a.join("&")}`};function Z(e){e.preventDefault(),(0,i.T)(b(":projectId"),a)}async function x(){const e=`/organizations/${t.slug}/`;(0,s.E3)();try{await f.requestPromise(e,{method:"PUT",data:{alertsMemberWrite:!0}}),(0,s.S9)((0,m.t)("Successfully updated organization settings"))}catch(e){(0,s.Iw)((0,m.t)("Unable to update organization settings"))}}const w=(0,m._N)("Ask your organization owner or manager to [settingsLink:enable alerts access] for you.",{settingsLink:(0,j.tZ)(p.Z,{to:`/settings/${t.slug}`})}),A=e=>{var t;return(0,j.tZ)(d.ZP,{disabled:!e,title:e?void 0:w,icon:!c&&(0,j.tZ)(g.vr,{...n}),to:r?b(r):void 0,tooltipProps:{isHoverable:!0,position:"top",popperStyle:{maxWidth:"270px"}},onClick:r?void 0:Z,...h,children:null!==(t=h.children)&&void 0!==t?t:(0,m.t)("Create Alert")})},z=!t.alertsMemberWrite&&!!y;return(0,j.tZ)(l.Z,{organization:t,access:["alerts:write"],children:e=>{let{hasAccess:r}=e;return z?(0,j.tZ)(l.Z,{organization:t,access:["org:write"],children:e=>{let{hasAccess:t}=e;return(0,j.tZ)(u.Z,{target:t?"alerts_write_owner":"alerts_write_member",onFinish:t?x:void 0,children:A(r)})}}):A(r)}})})),A=w,z=(0,n.Z)(c.Z,{target:"e173ycuj2"})("color:",(e=>e.theme.textColor),";margin-bottom:0;"),k=(0,n.Z)("ul",{target:"e173ycuj1"})({name:"1ykowef",styles:"margin-bottom:0"}),_=(0,n.Z)("code",{target:"e173ycuj0"})({name:"1imza1v",styles:"background-color:transparent;padding:0"})}}]);
//# sourceMappingURL=../sourcemaps/app_components_createAlertButton_tsx.e14afd5f741b969525474ce4f532d6c8.js.map