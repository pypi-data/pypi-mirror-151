"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_alerts_rules_index_tsx"],{"./app/components/alertBadge.tsx":(e,t,s)=>{s.d(t,{Z:()=>c});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("./app/icons/index.tsx"),i=s("./app/locale.tsx"),n=s("./app/styles/space.tsx"),o=s("./app/views/alerts/types.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{status:t,hideText:s=!1,isIssue:a}=e,n=(0,i.t)("Resolved"),d=r.DL,c="green300";return a?(n=(0,i.t)("Issue"),d=r.XI,c="gray300"):t===o.vt.CRITICAL?(n=(0,i.t)("Critical"),d=r.zC,c="red300"):t===o.vt.WARNING&&(n=(0,i.t)("Warning"),d=r.qV,c="yellow300"),(0,l.BX)(p,{"data-test-id":"alert-badge",children:[(0,l.BX)(u,{color:c,icon:d,children:[(0,l.tZ)(m,{color:c}),(0,l.tZ)(d,{color:"white"})]}),!s&&(0,l.tZ)(h,{color:c,children:n})]})}d.displayName="AlertBadge";const c=d,p=(0,a.Z)("div",{target:"ef4c9wd3"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),u=(0,a.Z)("div",{target:"ef4c9wd2"})("width:36px;height:36px;position:relative;svg:last-child{width:",(e=>e.icon===r.XI?"13px":"16px"),";z-index:2;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;}"),m=(0,a.Z)(r.Sq,{target:"ef4c9wd1"})({name:"bgbjt4",styles:"width:36px;height:36px"}),h=(0,a.Z)("div",{target:"ef4c9wd0"})("margin-left:",(0,n.Z)(1),";")},"./app/views/alerts/rules/index.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>ae});var a=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("./app/actionCreators/indicator.tsx"),o=s("./app/components/asyncComponent.tsx"),l=s("./app/components/layouts/thirds.tsx"),d=s("./app/components/links/link.tsx"),c=s("./app/components/organizations/pageFilters/container.tsx"),p=s("./app/components/pagination.tsx"),u=s("./app/components/panels/index.tsx"),m=s("./app/components/sentryDocumentTitle.tsx"),h=s("./app/icons/index.tsx"),g=s("./app/locale.tsx"),x=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),Z=s("./app/utils/projects.tsx"),v=s("./app/utils/teams.tsx"),y=s("./app/utils/withPageFilters.tsx"),w=s("./app/views/alerts/filterBar.tsx"),f=s("./app/views/alerts/list/header.tsx"),I=s("./app/views/alerts/types.tsx"),b=s("./app/views/alerts/utils/index.tsx"),C=s("../node_modules/lodash/memoize.js"),A=s.n(C),T=s("./app/components/acl/access.tsx"),q=s("./app/components/alertBadge.tsx"),j=s("./app/components/avatar/actorAvatar.tsx"),L=s("./app/components/confirm.tsx"),R=s("./app/components/dateTime.tsx"),B=s("./app/components/dropdownMenuControlV2.tsx"),_=s("./app/components/errorBoundary.tsx"),z=s("./app/components/idBadge/index.tsx"),D=s("./app/components/timeSince.tsx"),S=s("./app/components/tooltip.tsx"),k=s("./app/styles/overflowEllipsis.tsx"),$=s("./app/styles/space.tsx"),E=s("./app/utils/getDynamicText.tsx"),N=s("./app/views/alerts/incidentRules/types.tsx"),X=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const G=A()(((e,t)=>t.find((t=>t.slug===e))));function F(e){var t,s,a,r,i;let{rule:n,projectsLoaded:o,projects:l,orgId:c,onDelete:p,userTeams:u,hasDuplicateAlertRules:m}=e;const x=void 0!==(null===(t=n.latestIncident)||void 0===t?void 0:t.status)&&[I.vt.CRITICAL,I.vt.WARNING].includes(n.latestIncident.status),Z=n.projects[0],v=`/organizations/${c}/alerts/${(0,b.Gm)(n)?"rules":"metric-rules"}/${Z}/${n.id}/`,y={pathname:`/organizations/${c}/alerts/new/${n.type===I.XO.METRIC?"metric":"issue"}/`,query:{project:Z,duplicateRuleId:n.id,createFromDuplicate:!0,referrer:"alert_stream"}},w=`/organizations/${c}/alerts/rules/details/${n.id}/`,f=null===(s=n.owner)||void 0===s?void 0:s.split(":")[1],C=f?{type:"team",id:f,name:""}:null,A=!f||u.has(f),R=(0,b.Gm)(n)?(0,X.tZ)(d.Z,{to:`/organizations/${c}/alerts/rules/${n.projects[0]}/${n.id}/details/`,children:n.name}):(0,X.tZ)(V,{to:(0,b.Gm)(n)?v:w,children:n.name}),z={[I.vt.CRITICAL]:(0,g.t)("Critical"),[I.vt.WARNING]:(0,g.t)("Warning"),[I.vt.CLOSED]:(0,g.t)("Resolved"),[I.vt.OPENED]:(0,g.t)("Resolved")},k=[{key:"edit",label:(0,g.t)("Edit"),to:v},{key:"duplicate",label:(0,g.t)("Duplicate"),to:y,hidden:!m},{key:"delete",label:(0,g.t)("Delete"),priority:"danger",onAction:()=>{(0,L._)({onConfirm:()=>p(Z,n),header:(0,g.t)("Delete Alert Rule?"),message:(0,g._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:n.name}),confirmText:(0,g.t)("Delete Rule"),priority:"danger"})}}];return(0,X.BX)(_.Z,{children:[(0,X.BX)(P,{isIssueAlert:(0,b.Gm)(n),children:[(0,X.tZ)(O,{children:(0,X.tZ)(S.ZP,{title:(0,b.Gm)(n)?(0,g.t)("Issue Alert"):(0,g._N)("Metric Alert Status: [status]",{status:z[null!==(a=null==n||null===(r=n.latestIncident)||void 0===r?void 0:r.status)&&void 0!==a?a:I.vt.CLOSED]}),children:(0,X.tZ)(q.Z,{status:null==n||null===(i=n.latestIncident)||void 0===i?void 0:i.status,isIssue:(0,b.Gm)(n),hideText:!0})})}),(0,X.BX)(W,{children:[(0,X.tZ)(M,{children:R}),(0,X.tZ)(U,{children:(0,b.Gm)(n)?n.lastTriggered?(0,X.BX)("div",{children:[(0,g.t)("Triggered "),(0,X.tZ)(D.Z,{date:n.lastTriggered})]}):"-":n.latestIncident?x?(0,X.BX)("div",{children:[(0,g.t)("Triggered "),(0,X.tZ)(D.Z,{date:n.latestIncident.dateCreated})]}):(0,X.BX)("div",{children:[(0,g.t)("Resolved "),(0,X.tZ)(D.Z,{date:n.latestIncident.dateClosed})]}):"-"})]})]}),(0,X.tZ)(O,{children:function(){var e,t;if((0,b.Gm)(n))return null;const s=n.triggers.find((e=>{let{label:t}=e;return t===N.F4.CRITICAL})),a=n.triggers.find((e=>{let{label:t}=e;return t===N.F4.WARNING})),r=n.resolveThreshold,i=x&&(null===(e=n.latestIncident)||void 0===e?void 0:e.status)===I.vt.CRITICAL?s:null!=a?a:s;let o,l="green300",d=x&&n.thresholdType===N.lT.ABOVE?(0,g.t)("Above"):(0,g.t)("Below");return x?(l=(null==i?void 0:i.label)===N.F4.CRITICAL?"red300":(null==i?void 0:i.label)===N.F4.WARNING?"yellow300":"green300",o=n.thresholdType===N.lT.ABOVE?"up":"down"):(o=n.thresholdType===N.lT.ABOVE?"down":"up",d=n.thresholdType===N.lT.ABOVE?(0,g.t)("Below"):(0,g.t)("Above")),(0,X.BX)(O,{children:[(0,X.tZ)(h.CC,{color:l,direction:o}),(0,X.tZ)(J,{children:`${d} ${n.latestIncident||!n.latestIncident&&!r?null==i||null===(t=i.alertThreshold)||void 0===t?void 0:t.toLocaleString():null==r?void 0:r.toLocaleString()}`})]})}()}),(0,X.tZ)(O,{children:(0,X.tZ)(K,{children:(0,X.tZ)(Y,{avatarSize:18,project:o?G(Z,l):{slug:Z}})})}),(0,X.tZ)(O,{children:C?(0,X.tZ)(j.Z,{actor:C,size:24}):"-"}),(0,X.tZ)(O,{children:(0,X.tZ)(H,{date:(0,E.Z)({value:n.dateCreated,fixed:new Date("2021-04-20")}),format:"ll"})}),(0,X.tZ)(Q,{children:(0,X.tZ)(T.Z,{access:["alerts:write"],children:e=>{let{hasAccess:t}=e;return(0,X.tZ)(B.Z,{items:k,placement:"bottom right",triggerProps:{"aria-label":(0,g.t)("Show more"),"data-test-id":"alert-row-actions",size:"xsmall",icon:(0,X.tZ)(h.YR,{size:"xs"}),showChevron:!1},disabledKeys:t&&A?[]:["delete"]})}})})]})}F.displayName="RuleListRow";const V=(0,r.Z)(d.Z,{target:"e1f6xqs310"})(k.Z,";"),O=(0,r.Z)("div",{target:"e1f6xqs39"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),P=(0,r.Z)(O,{target:"e1f6xqs38"})("position:relative;",(e=>e.isIssueAlert&&`padding: ${(0,$.Z)(3)} ${(0,$.Z)(2)}; line-height: 2.4;`),";"),W=(0,r.Z)("div",{target:"e1f6xqs37"})(k.Z," margin-left:",(0,$.Z)(2),";line-height:1.35;"),M=(0,r.Z)("div",{target:"e1f6xqs36"})(k.Z," font-size:",(e=>e.theme.fontSizeLarge),";@media (max-width: ",(e=>e.theme.breakpoints[3]),"){max-width:300px;}@media (max-width: ",(e=>e.theme.breakpoints[2]),"){max-width:165px;}@media (max-width: ",(e=>e.theme.breakpoints[1]),"){max-width:100px;}"),U=(0,r.Z)("div",{target:"e1f6xqs35"})("color:",(e=>e.theme.gray300),";"),K=(0,r.Z)("div",{target:"e1f6xqs34"})({name:"1d3w5wq",styles:"width:100%"}),Y=(0,r.Z)(z.Z,{target:"e1f6xqs33"})({name:"ozd7xs",styles:"flex-shrink:0"}),H=(0,r.Z)(R.Z,{target:"e1f6xqs32"})("font-variant-numeric:tabular-nums;color:",(e=>e.theme.gray300),";"),J=(0,r.Z)("div",{target:"e1f6xqs31"})("margin-left:",(0,$.Z)(1),";white-space:nowrap;font-variant-numeric:tabular-nums;"),Q=(0,r.Z)(O,{target:"e1f6xqs30"})("justify-content:center;padding:",(0,$.Z)(1),";"),ee=F;class te extends o.Z{constructor(){super(...arguments),(0,a.Z)(this,"handleChangeFilter",(e=>{const{router:t,location:s}=this.props,{cursor:a,page:r,...i}=s.query,n=[...e];t.push({pathname:s.pathname,query:{...i,team:n.length?n:""}})})),(0,a.Z)(this,"handleChangeSearch",(e=>{const{router:t,location:s}=this.props,{cursor:a,page:r,...i}=s.query;t.push({pathname:s.pathname,query:{...i,name:e}})})),(0,a.Z)(this,"handleDeleteRule",(async(e,t)=>{const{params:s}=this.props,{orgId:a}=s,r=(0,b.Gm)(t)?"rules":"alert-rules";try{await this.api.requestPromise(`/projects/${a}/${e}/${r}/${t.id}/`,{method:"DELETE"}),this.reloadData()}catch(e){(0,n.Iw)((0,g.t)("Error deleting rule"))}}))}getEndpoints(){const{params:e,location:t}=this.props,{query:s}=t;return s.expand=["latestIncident","lastTriggered"],s.team=(0,b.LI)(s.team),s.sort||(s.sort=["incident_status","date_triggered"]),[["ruleList",`/organizations/${e&&e.orgId}/combined-rules/`,{query:s}]]}get projectsFromIncidents(){const{ruleList:e=[]}=this.state;return[...new Set(null==e?void 0:e.map((e=>{let{projects:t}=e;return t})).flat())]}renderLoading(){return this.renderBody()}renderList(){const{params:{orgId:e},location:t,organization:s,router:a}=this.props,{loading:r,ruleList:i=[],ruleListPageLinks:n}=this.state,{query:o}=t,d={asc:"1"===o.asc,field:o.sort||"date_added"},{cursor:c,page:u,...m}=o,x=d.field.includes("incident_status")||d.field.includes("date_triggered"),y=(0,X.tZ)(h.CC,{color:"gray300",size:"xs",direction:d.asc?"up":"down"});return(0,X.tZ)(l.uT,{children:(0,X.BX)(l.or,{fullWidth:!0,children:[(0,X.tZ)(w.Z,{location:t,onChangeFilter:this.handleChangeFilter,onChangeSearch:this.handleChangeSearch}),(0,X.tZ)(v.Z,{provideUserTeams:!0,children:a=>{let{initiallyLoaded:n,teams:o}=a;return(0,X.tZ)(ie,{headers:[(0,X.BX)(re,{role:"columnheader","aria-sort":"name"!==d.field?"none":d.asc?"ascending":"descending",to:{pathname:t.pathname,query:{...m,asc:"name"===d.field&&d.asc?void 0:"1",sort:"name"}},children:[(0,g.t)("Alert Rule")," ","name"===d.field&&y]},"name"),(0,X.BX)(re,{role:"columnheader","aria-sort":x?d.asc?"ascending":"descending":"none",to:{pathname:t.pathname,query:{...m,asc:x&&!d.asc?"1":void 0,sort:["incident_status","date_triggered"]}},children:[(0,g.t)("Status")," ",x&&y]},"status"),(0,g.t)("Project"),(0,g.t)("Team"),(0,X.BX)(re,{role:"columnheader","aria-sort":"date_added"!==d.field?"none":d.asc?"ascending":"descending",to:{pathname:t.pathname,query:{...m,asc:"date_added"!==d.field||d.asc?void 0:"1",sort:"date_added"}},children:[(0,g.t)("Created")," ","date_added"===d.field&&y]},"dateAdded"),(0,g.t)("Actions")],isLoading:r||!n,isEmpty:0===(null==i?void 0:i.length),emptyMessage:(0,g.t)("No alert rules found for the current query."),children:(0,X.tZ)(Z.Z,{orgId:e,slugs:this.projectsFromIncidents,children:t=>{let{initiallyLoaded:a,projects:r}=t;return i.map((t=>(0,X.tZ)(ee,{projectsLoaded:a,projects:r,rule:t,orgId:e,onDelete:this.handleDeleteRule,userTeams:new Set(o.map((e=>e.id))),hasDuplicateAlertRules:s.features.includes("duplicate-alert-rule")},`${(0,b.Gm)(t)?I.ok.METRIC:I.ok.ISSUE}-${t.id}`)))}})})}}),(0,X.tZ)(p.Z,{pageLinks:n,onCursor:(e,t,s)=>{let r=m.team;r&&0!==r.length||(r=""),a.push({pathname:t,query:{...m,team:r,cursor:e}})}})]})})}renderBody(){const{params:e,organization:t,router:s}=this.props,{orgId:a}=e;return(0,X.tZ)(m.Z,{title:(0,g.t)("Alerts"),orgSlug:a,children:(0,X.BX)(c.Z,{organization:t,showDateSelector:!1,showEnvironmentSelector:!1,hideGlobalHeader:!0,children:[(0,X.tZ)(f.Z,{organization:t,router:s,activeTab:"rules",projectSlugs:this.projectsFromIncidents}),this.renderList()]})})}}class se extends i.Component{componentDidMount(){this.trackView()}componentDidUpdate(e){var t,s;const{location:a}=this.props;(null===(t=e.location.query)||void 0===t?void 0:t.sort)!==(null===(s=a.query)||void 0===s?void 0:s.sort)&&this.trackView()}trackView(){const{organization:e,location:t}=this.props;(0,x.Z)("alert_rules.viewed",{organization:e,sort:Array.isArray(t.query.sort)?t.query.sort.join(","):t.query.sort})}render(){return(0,X.tZ)(te,{...this.props})}}se.displayName="AlertRulesListContainer";const ae=(0,y.Z)(se),re=(0,r.Z)(d.Z,{target:"eddauwb1"})({name:"1sbdiq8",styles:"color:inherit;:hover{color:inherit;}"}),ie=(0,r.Z)(u.KB,{target:"eddauwb0"})("position:static;overflow:auto;@media (min-width: ",(e=>e.theme.breakpoints[0]),"){overflow:initial;}grid-template-columns:4fr auto 140px 60px 110px auto;white-space:nowrap;font-size:",(e=>e.theme.fontSizeMedium),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_rules_index_tsx.100c419dcba4f16d90f09e201ce204e2.js.map