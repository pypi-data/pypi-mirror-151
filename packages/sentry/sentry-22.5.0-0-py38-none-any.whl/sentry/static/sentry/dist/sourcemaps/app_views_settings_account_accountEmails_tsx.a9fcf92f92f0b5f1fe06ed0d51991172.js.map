{"version":3,"file":"chunks/app_views_settings_account_accountEmails_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/data/forms/accountEmails.tsx","webpack:///./app/views/asyncView.tsx","webpack:///./app/views/settings/account/accountEmails.tsx"],"sourcesContent":["import {JsonFormObject} from 'sentry/components/forms/type';\n\n// Export route to make these forms searchable by label/help\nexport const route = '/settings/account/emails/';\n\nconst formGroups: JsonFormObject[] = [\n  {\n    // Form \"section\"/\"panel\"\n    title: 'Add Secondary Emails',\n    fields: [\n      {\n        name: 'email',\n        type: 'string',\n\n        // additional data/props that is related to rendering of form field rather than data\n        label: 'Additional Email',\n        placeholder: 'e.g. secondary@example.com',\n        help: 'Designate an alternative email for this account',\n        showReturnButton: true,\n      },\n    ],\n  },\n];\n\nexport default formGroups;\n","import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {Fragment} from 'react';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage} from 'sentry/actionCreators/indicator';\nimport {RequestOptions} from 'sentry/api';\nimport AlertLink from 'sentry/components/alertLink';\nimport AsyncComponent from 'sentry/components/asyncComponent';\nimport Button from 'sentry/components/button';\nimport ButtonBar from 'sentry/components/buttonBar';\nimport Form from 'sentry/components/forms/form';\nimport JsonForm from 'sentry/components/forms/jsonForm';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {Panel, PanelBody, PanelHeader, PanelItem} from 'sentry/components/panels';\nimport Tag from 'sentry/components/tag';\nimport accountEmailsFields from 'sentry/data/forms/accountEmails';\nimport {IconDelete, IconStack} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {UserEmail} from 'sentry/types';\nimport AsyncView from 'sentry/views/asyncView';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\n\nconst ENDPOINT = '/users/me/emails/';\n\ntype Props = AsyncView['props'];\n\ntype State = AsyncView['state'] & {\n  emails: UserEmail[];\n};\n\nclass AccountEmails extends AsyncView<Props, State> {\n  getTitle() {\n    return t('Emails');\n  }\n\n  getEndpoints() {\n    return [];\n  }\n\n  handleSubmitSuccess: Form['props']['onSubmitSuccess'] = (_change, model, id) => {\n    if (id === undefined) {\n      return;\n    }\n    model.setValue(id, '');\n    this.remountComponent();\n  };\n\n  renderBody() {\n    return (\n      <Fragment>\n        <SettingsPageHeader title={t('Email Addresses')} />\n        <EmailAddresses />\n        <Form\n          apiMethod=\"POST\"\n          apiEndpoint={ENDPOINT}\n          saveOnBlur\n          allowUndo={false}\n          onSubmitSuccess={this.handleSubmitSuccess}\n        >\n          <JsonForm forms={accountEmailsFields} />\n        </Form>\n\n        <AlertLink to=\"/settings/account/notifications\" icon={<IconStack />}>\n          {t('Want to change how many emails you get? Use the notifications panel.')}\n        </AlertLink>\n      </Fragment>\n    );\n  }\n}\n\nexport default AccountEmails;\n\nexport class EmailAddresses extends AsyncComponent<Props, State> {\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['emails', ENDPOINT]];\n  }\n  doApiCall(endpoint: string, requestParams: RequestOptions) {\n    this.setState({loading: true, emails: []}, () =>\n      this.api\n        .requestPromise(endpoint, requestParams)\n        .then(() => this.remountComponent())\n        .catch(err => {\n          this.remountComponent();\n\n          if (err?.responseJSON?.email) {\n            addErrorMessage(err.responseJSON.email);\n          }\n        })\n    );\n  }\n  handleSetPrimary = (email: string) =>\n    this.doApiCall(ENDPOINT, {\n      method: 'PUT',\n      data: {email},\n    });\n\n  handleRemove = (email: string) =>\n    this.doApiCall(ENDPOINT, {\n      method: 'DELETE',\n      data: {email},\n    });\n\n  handleVerify = (email: string) =>\n    this.doApiCall(`${ENDPOINT}confirm/`, {\n      method: 'POST',\n      data: {email},\n    });\n\n  render() {\n    const {emails, loading} = this.state;\n    const primary = emails?.find(({isPrimary}) => isPrimary);\n    const secondary = emails?.filter(({isPrimary}) => !isPrimary);\n\n    if (loading) {\n      return (\n        <Panel>\n          <PanelHeader>{t('Email Addresses')}</PanelHeader>\n          <PanelBody>\n            <LoadingIndicator />\n          </PanelBody>\n        </Panel>\n      );\n    }\n    return (\n      <Panel>\n        <PanelHeader>{t('Email Addresses')}</PanelHeader>\n        <PanelBody>\n          {primary && (\n            <EmailRow\n              onRemove={this.handleRemove}\n              onVerify={this.handleVerify}\n              {...primary}\n            />\n          )}\n\n          {secondary?.map(emailObj => (\n            <EmailRow\n              key={emailObj.email}\n              onSetPrimary={this.handleSetPrimary}\n              onRemove={this.handleRemove}\n              onVerify={this.handleVerify}\n              {...emailObj}\n            />\n          ))}\n        </PanelBody>\n      </Panel>\n    );\n  }\n}\n\ntype EmailRowProps = {\n  email: string;\n  onRemove: (email: string, e: React.MouseEvent) => void;\n  onVerify: (email: string, e: React.MouseEvent) => void;\n  hideRemove?: boolean;\n  isPrimary?: boolean;\n  isVerified?: boolean;\n  onSetPrimary?: (email: string, e: React.MouseEvent) => void;\n};\n\nconst EmailRow = ({\n  email,\n  onRemove,\n  onVerify,\n  onSetPrimary,\n  isVerified,\n  isPrimary,\n  hideRemove,\n}: EmailRowProps) => (\n  <EmailItem>\n    <EmailTags>\n      {email}\n      {!isVerified && <Tag type=\"warning\">{t('Unverified')}</Tag>}\n      {isPrimary && <Tag type=\"success\">{t('Primary')}</Tag>}\n    </EmailTags>\n    <ButtonBar gap={1}>\n      {!isPrimary && isVerified && (\n        <Button size=\"small\" onClick={e => onSetPrimary?.(email, e)}>\n          {t('Set as primary')}\n        </Button>\n      )}\n      {!isVerified && (\n        <Button size=\"small\" onClick={e => onVerify(email, e)}>\n          {t('Resend verification')}\n        </Button>\n      )}\n      {!hideRemove && !isPrimary && (\n        <Button\n          aria-label={t('Remove email')}\n          data-test-id=\"remove\"\n          priority=\"danger\"\n          size=\"small\"\n          icon={<IconDelete />}\n          onClick={e => onRemove(email, e)}\n        />\n      )}\n    </ButtonBar>\n  </EmailItem>\n);\n\nconst EmailTags = styled('div')`\n  display: grid;\n  grid-auto-flow: column;\n  gap: ${space(1)};\n  align-items: center;\n`;\n\nconst EmailItem = styled(PanelItem)`\n  justify-content: space-between;\n`;\n"],"names":["route","title","fields","name","type","label","placeholder","help","showReturnButton","AsyncView","AsyncComponent","getTitle","render","this","renderComponent","ENDPOINT","AccountEmails","_change","model","id","undefined","setValue","remountComponent","t","getEndpoints","renderBody","Fragment","EmailAddresses","apiMethod","apiEndpoint","saveOnBlur","allowUndo","onSubmitSuccess","handleSubmitSuccess","forms","accountEmailsFields","to","icon","email","doApiCall","method","data","endpoint","requestParams","setState","loading","emails","api","requestPromise","then","catch","err","responseJSON","addErrorMessage","state","primary","find","isPrimary","secondary","filter","EmailRow","onRemove","handleRemove","onVerify","handleVerify","map","emailObj","onSetPrimary","handleSetPrimary","isVerified","hideRemove","EmailItem","EmailTags","gap","size","onClick","e","priority","space","PanelItem"],"sourceRoot":""}